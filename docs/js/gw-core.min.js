!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).GW=t.GW||{})}(this,(function(t){"use strict";const n=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,-1],[-1,1]],r=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];function e(t){return t}function i(t,n,r){return t<n?n:t>r?r:t}function o(t){return t.x||t[0]||0}function s(t){return t.y||t[1]||0}function h(t,n,r,e){const i=Math.abs(t-r),o=Math.abs(n-e);return i+o-.6*Math.min(i,o)}function u(t,n,r,e){let i=r-t,o=e-n;if(i&&o){const t=Math.abs(i),n=Math.abs(o);t>=2*n?o=0:n>=2*t&&(i=0)}return[Math.sign(i),Math.sign(o)]}function f(t,n,r=null){let e;Object.keys(n).forEach((i=>{const o=i;let s=n[i];e=t;const h=i.split(".");for(;h.length>1;)i=h.shift(),void 0===e[i]?e=e[i]={}:"object"!=typeof e[i]?a("Trying to set default member on non-object config item: "+o):e=e[i];i=h.shift();let u=e[i];r&&r(e,i,u,s)||void 0===u&&(null===s?e[i]=null:Array.isArray(s)?e[i]=s.slice():e[i]=s)}))}function a(t){throw new Error(t)}var c={__proto__:null,DIRS:n,NO_DIRECTION:-1,UP:0,RIGHT:1,DOWN:2,LEFT:3,RIGHT_UP:4,RIGHT_DOWN:5,LEFT_DOWN:6,LEFT_UP:7,CLOCK_DIRS:r,NOOP:function(){},TRUE:function(){return!0},FALSE:function(){return!1},ONE:function(){return 1},ZERO:function(){return 0},IDENTITY:e,clamp:i,x:o,y:s,copyXY:function(t,n){t.x=o(n),t.y=s(n)},addXY:function(t,n){t.x+=o(n),t.y+=s(n)},equalsXY:function(t,n){return t.x==o(n)&&t.y==s(n)},lerpXY:function(t,n,r){r>1&&(r/=100),r=i(r,0,1);const e=o(n)-o(t),h=s(n)-s(t);return[o(t)+Math.floor(e*r),s(t)+Math.floor(h*r)]},distanceBetween:h,distanceFromTo:function(t,n){return h(o(t),s(t),o(n),s(n))},calcRadius:function(t,n){return h(0,0,t,n)},dirBetween:u,dirFromTo:function(t,n){return u(o(t),s(t),o(n),s(n))},dirIndex:function(t){const r=o(t),e=s(t);return n.findIndex((t=>t[0]==r&&t[1]==e))},isOppositeDir:function(t,n){return t[0]+n[0]==0&&t[1]+n[1]==0},isSameDir:function(t,n){return t[0]==n[0]&&t[1]==n[1]},dirSpread:function(t){const n=[t];return 0==t[0]?(n.push([1,t[1]]),n.push([-1,t[1]])):0==t[1]?(n.push([t[0],1]),n.push([t[0],-1])):(n.push([t[0],0]),n.push([0,t[1]])),n},stepFromTo:function(t,n,r){const e=o(t),i=s(t),h=[o(n)-e,s(n)-i],u=Math.abs(h[0])+Math.abs(h[1]),f=[0,0],a=[99999,99999];for(let t=0;t<=u;++t)f[0]=e+Math.floor(h[0]*t/u),f[1]=i+Math.floor(h[1]*t/u),f[0]==a[0]&&f[1]==a[1]||r(f[0],f[1]),a[0]=f[0],a[1]=f[1]},smoothHiliteGradient:function(t,n){return Math.floor(100*Math.sin(Math.PI*t/n))},assignOmitting:function(t,n,r){"string"==typeof t&&(t=t.split(/[,|]/g).map((t=>t.trim()))),Object.keys(r).forEach((e=>{t.includes(e)||function(t,n,r){const e=t[r],i=n[r];e&&e.copy&&i?e.copy(i):e&&e.clear&&!i?e.clear():e&&e.nullify&&!i?e.nullify():i&&i.clone?t[r]=i.clone():i&&Array.isArray(i)?t[r]=i.slice():e&&Array.isArray(e)?e.length=0:t[r]=i}(n,r,e)}))},setDefault:function(t,n,r){void 0===t[n]&&(t[n]=r)},setDefaults:f,kindDefaults:function(t,n){return f(t,n,(function(t,n,r,e){return!(n.search(/[fF]lags$/)<0)&&(r?"string"==typeof r?r=r.split(/[,|]/).map((t=>t.trim())):Array.isArray(r)||(r=[r]):r=[],"string"==typeof e?e=e.split(/[,|]/).map((t=>t.trim())):Array.isArray(e)||(e=[e]),t[n]=e.concat(r),!0)}))},pick:function(t,...n){const r={};return n.forEach((n=>{const e=t[n];void 0!==e&&(r[n]=e)})),r},clearObject:function(t){Object.keys(t).forEach((n=>t[n]=void 0))},ERROR:a,WARN:function(...t){console.warn(...t)},getOpt:function(t,n,r){const e=t[n];return void 0===e?r:e},firstOpt:function(t,...n){for(let r of n){if("object"!=typeof r||Array.isArray(r))return r;if(void 0!==r[t])return r[t]}},arraysIntersect:function(t,n){return t.some((t=>n.includes(t)))},sum:function(t){return t.reduce(((t,n)=>t+n))},chainLength:function(t){let n=0;for(;t;)n+=1,t=t.next;return n},chainIncludes:function(t,n){for(;t&&t!==n;)t=t.next;return t===n},eachChain:function(t,n){let r=0;for(;t;){const e=t.next;n(t,r++),t=e}return r},addToChain:function(t,n,r){return r.next=t[n]||null,t[n]=r,!0},removeFromChain:function(t,n,r){const e=t[n];if(e===r)return t[n]=r.next||null,r.next=null,!0;if(!e)return!1;{let t=e,n=t.next;for(;n&&n!==r;)t=n,n=t.next;if(n===r)return t.next=n.next||null,r.next=null,!0}return!1}};const l={make:()=>Math.random.bind(Math)};function d(t,n){let r,e,i;for(e=0,r=0;r<n.length;r++)e+=n[r];if(e<=0)return console.warn("Lottery Draw - no frequencies",n,n.length),0;for(i=t.range(0,e-1),r=0;r<n.length;r++){if(n[r]>i)return r;i-=n[r]}return console.warn("Lottery Draw failed.",n,n.length),0}class p{constructor(){this._fn=l.make()}seed(t){this._fn=l.make(t)}value(){return this._fn()}float(){return this.value()}number(t=0){return t=t||Number.MAX_SAFE_INTEGER,Math.floor(this._fn()*t)}int(t=0){return this.number(t)}range(t,n){if(n<=t)return n;const r=n-t+1;return t+this.number(r)}dice(t,n,r=0){let e=0,i=1;t<0&&(t=-t,i=-1),r=r||0;for(let r=0;r<t;++r)e+=this.range(1,n);return e*=i,e+r}weighted(t){return Array.isArray(t)?d(this,t):function(t,n){const r=Object.entries(n),e=r.map((([t,n])=>n));return r[d(t,e)][0]}(this,t)}item(t){return Array.isArray(t)||(t=Object.values(t)),t[this.range(0,t.length-1)]}key(t){return this.item(Object.keys(t))}shuffle(t,n=0,r=0){let e,i,o;for(2==arguments.length&&(r=n,n=0),r=r||t.length,e=n=n||0;e<r;e++)i=this.range(n,r-1),e!=i&&(o=t[i],t[i]=t[e],t[e]=o);return t}sequence(t){const n=[];for(let r=0;r<t;r++)n[r]=r;return this.shuffle(n)}chance(t,n=100){return!(t<=0)&&(t>=n||this.range(0,n-1)<t)}clumped(t,n,r){if(n<=t)return t;if(r<=1)return this.range(t,n);let e,i=0,o=Math.floor((n-t)/r);for(e=0;e<(n-t)%r;e++)i+=this.range(0,o+1);for(;e<r;e++)i+=this.range(0,o);return i+t}}const m=new p,g=new p;class y{constructor(t,n=0,r=1,e){this._rng=e||m,Array.isArray(t)?(r=t[2],n=t[1],t=t[0]):t instanceof y&&(r=t.clumps,n=t.hi,t=t.lo),n<t&&([n,t]=[t,n]),this.lo=t||0,this.hi=n||this.lo,this.clumps=r||1}value(){return this._rng.clumped(this.lo,this.hi,this.clumps)}toString(){return this.lo>=this.hi?""+this.lo:`${this.lo}-${this.hi}`}}var w={__proto__:null,Range:y,make:function(t,n){if(!t)return new y(0,0,0,n);if(t instanceof y)return t;if("function"==typeof t)throw new Error("Custom range functions not supported - extend Range");if(null==t)return new y(0,0,0,n);if("number"==typeof t)return new y(t,t,1,n);if(!0===t||!1===t)throw new Error("Invalid random config: "+t);if(Array.isArray(t))return new y(t[0],t[1],t[2],n);if("string"!=typeof t)throw new Error("Calculations must be strings.  Received: "+JSON.stringify(t));if(0==t.length)return new y(0,0,0,n);const r=/^(?:([+-]?\d*)[Dd](\d+)([+-]?\d*)|([+-]?\d+)-(\d+):?(\d+)?|([+-]?\d+)~(\d+)|([+-]?\d+\.?\d*))/g;let e;for(;null!==(e=r.exec(t));){if(e[2]){let t=Number.parseInt(e[1])||1;const r=Number.parseInt(e[2]),i=Number.parseInt(e[3])||0;return new y(i+t,i+t*r,t,n)}if(e[4]&&e[5]){const t=Number.parseInt(e[4]),r=Number.parseInt(e[5]),i=Number.parseInt(e[6]);return new y(t,r,i,n)}if(e[7]&&e[8]){const t=Number.parseInt(e[7]),r=Number.parseInt(e[8]);return new y(t-2*r,t+2*r,3,n)}if(e[9]){const t=Number.parseFloat(e[9]);return new y(t,t,1,n)}}throw new Error("Not a valid range - "+t)}};const b={};var M={__proto__:null,fl:function(t){return 1<<t},toString:function(t,n){const r=Object.entries(t).reduce(((t,n)=>{const[r,e]=n;return e&&(t[e]=r),t}),[]),e=[];for(let t=0;t<32;++t){const i=1<<t;n&i&&e.push(r[i])}return e.join(" | ")},from:function(t,...n){let r=0;for(let e=0;e<n.length;++e){let i=n[e];void 0!==i&&("number"!=typeof i?("string"==typeof i&&(i=i.split(/[,|]/).map((t=>t.trim())).map((t=>{const n=Number.parseInt(t);return n>=0?n:t}))),Array.isArray(i)&&i.forEach((n=>{if("string"==typeof n)if((n=n.trim()).startsWith("!")){const e=t[n.substring(1)];r&=~e}else{const e=t[n];e&&(r|=e)}else 0===n?r=0:r|=n}))):r|=i)}return r},flags:b,install:function(t,n){return b[t]=n,n}};const _=n,A=r;function E(t){return!1===t?" ":!0===t?"T":t<10?""+t:t<36?String.fromCharCode("a".charCodeAt(0)+t-10):t<62?String.fromCharCode("A".charCodeAt(0)+t-10-26):"string"==typeof t?t[0]:"#"}class x extends Array{constructor(t,n,r){super(t);for(let e=0;e<t;++e)this[e]="function"==typeof r?new Array(n).fill(0).map(((t,n)=>r(e,n))):new Array(n).fill(r);this._width=t,this._height=n,this.type=r.constructor.name}get width(){return this._width}get height(){return this._height}resize(t,n,r){const e="function"==typeof r?r:()=>r;for(;this.length<t;)this.push([]);let i=0,o=0;for(i=0;i<t;++i){const t=this[i];for(o=0;o<Math.min(n,t.length);++o)t[o]=e(i,o);for(;t.length<n;)t.push(e(i,t.length))}this._width=t,this._height=n,void 0!==this.x&&(this.x=void 0,this.y=void 0)}forEach(t){let n,r;for(n=0;n<this.width;n++)for(r=0;r<this.height;r++)t(this[n][r],n,r,this)}eachNeighbor(t,n,r,e=!1){const i=e?4:8;for(let e=0;e<i;++e){const i=_[e],o=t+i[0],s=n+i[1];this.hasXY(o,s)&&r(this[o][s],o,s,this)}}forRect(t,n,r,e,i){r=Math.min(this.width-t,r),e=Math.min(this.height-n,e);for(let o=t;o<t+r;++o)for(let t=n;t<n+e;++t)i(this[o][t],o,t,this)}map(t){return super.map(((n,r)=>n.map(((n,e)=>t(n,r,e,this)))))}forCircle(t,n,r,e){let i,o;for(i=Math.max(0,t-r-1);i<Math.min(this.width,t+r+1);i++)for(o=Math.max(0,n-r-1);o<Math.min(this.height,n+r+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-n)*(o-n)<r*r+r&&e(this[i][o],i,o,this)}hasXY(t,n){return t>=0&&n>=0&&t<this.width&&n<this.height}isBoundaryXY(t,n){return this.hasXY(t,n)&&(0==t||t==this.width-1||0==n||n==this.height-1)}calcBounds(){const t={left:this.width,top:this.height,right:0,bottom:0};return this.forEach(((n,r,e)=>{n&&(t.left>r&&(t.left=r),t.right<r&&(t.right=r),t.top>e&&(t.top=e),t.bottom<e&&(t.bottom=e))})),t}update(t){let n,r;for(n=0;n<this.width;n++)for(r=0;r<this.height;r++)this[n][r]=t(this[n][r],n,r,this)}updateRect(t,n,r,e,i){let o,s;for(o=t;o<t+r;o++)for(s=n;s<n+e;s++)this.hasXY(o,s)&&(this[o][s]=i(this[o][s],o,s,this))}updateCircle(t,n,r,e){let i,o;for(i=Math.max(0,t-r-1);i<Math.min(this.width,t+r+1);i++)for(o=Math.max(0,n-r-1);o<Math.min(this.height,n+r+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-n)*(o-n)<r*r+r&&(this[i][o]=e(this[i][o],i,o,this))}fill(t){const n="function"==typeof t?t:()=>t;this.update(n)}fillRect(t,n,r,e,i){const o="function"==typeof i?i:()=>i;this.updateRect(t,n,r,e,o)}fillCircle(t,n,r,e){const i="function"==typeof e?e:()=>e;this.updateCircle(t,n,r,i)}replace(t,n){this.update((r=>r==t?n:r))}copy(t){this.update(((n,r,e)=>t[r][e]))}count(t){const n="function"==typeof t?t:n=>n==t;let r=0;return this.forEach(((t,e,i)=>{n(t,e,i,this)&&++r})),r}dump(t){this.dumpRect(0,0,this.width,this.height,t)}dumpRect(t,n,r,e,o){let s,h;o=o||E,t=i(t,0,this.width-2),n=i(n,0,this.height-2);const u=i(t+r,1,this.width-1),f=i(n+e,1,this.height-1);let a=[];for(h=n;h<=f;h++){let n=(h+"]").padStart(3," ");for(s=t;s<=u;s++){s%10==0&&(n+=" ");n+=o(this[s][h],s,h)[0]}a.push(n)}console.log(a.join("\n"))}dumpAround(t,n,r){this.dumpRect(t-r,n-r,2*r,2*r)}closestMatchingLoc(t,n,r){let e=[-1,-1],i=this.width+this.height;return this.forEach(((o,s,u)=>{if(r(o,s,u,this)){const r=h(t,n,s,u);r<i?(e[0]=s,e[1]=u,i=r):r==i&&m.chance(50)&&(e[0]=s,e[1]=u)}})),e}firstMatchingLoc(t){const n="function"==typeof t?t:n=>n==t;for(let t=0;t<this.width;++t)for(let r=0;r<this.height;++r)if(n(this[t][r],t,r,this))return[t,r];return[-1,-1]}randomMatchingLoc(t,n=!1){let r,e,i,o=0;const s="function"==typeof t?t:n=>n==t;if(o=0,this.forEach(((t,n,r)=>{s(t,n,r,this)&&o++})),0==o)return[-1,-1];for(i=n?Math.floor(o/2):m.range(0,o-1),r=0;r<this.width&&i>=0;r++)for(e=0;e<this.height&&i>=0;e++)if(s(this[r][e],r,e,this)){if(0==i)return[r,e];i--}return[-1,-1]}matchingLocNear(t,n,r,e=!1){let i,o,s,h,u,f=[-1,-1];const a="function"==typeof r?r:t=>t==r;for(h=0,s=0;s<Math.max(this.width,this.height)&&!h;s++)for(i=t-s;i<=t+s;i++)for(o=n-s;o<=n+s;o++)this.hasXY(i,o)&&(i==t-s||i==t+s||o==n-s||o==n+s)&&a(this[i][o],i,o,this)&&h++;if(0==h)return[-1,-1];for(u=e?1+Math.floor(h/2):1+m.number(h),s=0;s<Math.max(this.width,this.height);s++)for(i=t-s;i<=t+s;i++)for(o=n-s;o<=n+s;o++)if(this.hasXY(i,o)&&(i==t-s||i==t+s||o==n-s||o==n+s)&&a(this[i][o],i,o,this)&&0==--u)return f[0]=i,f[1]=o,f;return[-1,-1]}arcCount(t,n,r){let i,o,s,h,u,f;for(r=r||e,i=0,o=0;o<A.length;o++)s=t+A[(o+7)%8][0],h=n+A[(o+7)%8][1],u=t+A[o][0],f=n+A[o][1],(this.hasXY(u,f)&&r(this[u][f],u,f,this))!=(this.hasXY(s,h)&&r(this[s][h],s,h,this))&&i++;return Math.floor(i/2)}}const R=[];class v extends x{static alloc(t,n,r=0){let e=R.pop();return e?(e.resize(t,n,r),e):new v(t,n,r)}static free(t){if(t){if(R.indexOf(t)>=0)return;R.push(t)}}constructor(t,n,r=0){super(t,n,r)}findReplaceRange(t,n,r){this.update((e=>e>=t&&e<=n?r:e))}floodFillRange(t,n,r=0,e=0,i=0){let o,s,h,u=1;if(i>=r&&i<=e)throw new Error("Invalid grid flood fill");for(this[t][n]=i,o=0;o<4;o++)s=t+_[o][0],h=n+_[o][1],this.hasXY(s,h)&&this[s][h]>=r&&this[s][h]<=e&&(u+=this.floodFillRange(s,h,r,e,i));return u}invert(){this.update((t=>t?0:1))}closestLocWithValue(t,n,r=1){return this.closestMatchingLoc(t,n,(t=>t==r))}randomLocWithValue(t=1){return this.randomMatchingLoc((n=>n==t))}getQualifyingLocNear(t,n,r=!1){return this.matchingLocNear(t,n,(t=>!!t),r)}leastPositiveValue(){let t=Number.MAX_SAFE_INTEGER;return this.forEach((n=>{n>0&&n<t&&(t=n)})),t}randomLeastPositiveLoc(t=!1){const n=this.leastPositiveValue();return this.randomMatchingLoc((t=>t==n),t)}floodFill(t,n,r,e){let i,o,s,h=1;const u="function"==typeof r?r:t=>t==r,f="function"==typeof e?e:()=>e;for(this[t][n]=f(this[t][n],t,n,this),i=0;i<4;i++)o=t+_[i][0],s=n+_[i][1],this.hasXY(o,s)&&u(this[o][s],o,s,this)&&(h+=this.floodFill(o,s,u,f));return h}_cellularAutomataRound(t,n){let r,e,i,o,s,h,u;u=v.alloc(this.width,this.height),u.copy(this);let f=!1;for(r=0;r<this.width;r++)for(e=0;e<this.height;e++){for(i=0,h=0;h<_.length;h++)o=r+_[h][0],s=e+_[h][1],this.hasXY(o,s)&&u[o][s]&&i++;u[r][e]||"t"!=t[i]?u[r][e]&&"t"==n[i]||(this[r][e]=0,f=!0):(this[r][e]=1,f=!0)}return v.free(u),f}fillBlob(t,n,r,e,i,o,s,h){let u,f,a,c,l,d,p,g,y,w,b,M,_,A;n>=e&&(n=Math.round(.75*e),e=Math.round(1.25*e)),r>=i&&(r=Math.round(.75*i),i=Math.round(1.25*i));const E=Math.floor((this.width-e)/2),x=Math.floor((this.height-i)/2);do{for(this.fill(0),u=0;u<e;u++)for(f=0;f<i;f++)this[u+E][f+x]=m.chance(o)?1:0;for(a=0;a<t;a++)this._cellularAutomataRound(s,h)||(a=t);for(p=0,d=0,g=this.width,w=0,y=this.height,b=0,c=2,u=0;u<this.width;u++)for(f=0;f<this.height;f++)1==this[u][f]&&(l=this.floodFill(u,f,1,c),l>p&&(p=l,d=c),c++);for(u=0;u<this.width;u++){for(A=!1,f=0;f<this.height;f++)if(this[u][f]==d){A=!0;break}A&&(u<g&&(g=u),u>w&&(w=u))}for(f=0;f<this.height;f++){for(A=!1,u=0;u<this.width;u++)if(this[u][f]==d){A=!0;break}A&&(f<y&&(y=f),f>b&&(b=f))}M=w-g+1,_=b-y+1}while(M<n||_<r||0==d);for(u=0;u<this.width;u++)for(f=0;f<this.height;f++)this[u][f]==d?this[u][f]=1:this[u][f]=0;return{x:g,y:y,width:M,height:_}}}const N=v.alloc.bind(v),I=v.free.bind(v);var O={__proto__:null,makeArray:function(t,n){if(void 0===n)return new Array(t).fill(0);n=n||(()=>0);const r=new Array(t);for(let e=0;e<t;++e)r[e]=n(e);return r},Grid:x,NumGrid:v,alloc:N,free:I,make:function(t,n,r){return void 0===r?new v(t,n,0):"number"==typeof r?new v(t,n,r):new x(t,n,r)},offsetZip:function(t,n,r,e,i){const o="function"==typeof i?i:(n,r,e,o)=>t[e][o]=i||r;n.forEach(((i,s,h)=>{const u=s+r,f=h+e;t.hasXY(u,f)&&i&&o(t[u][f],i,u,f,s,h,t,n)}))},directionOfDoorSite:function(t,n,r,e){let i,o,s,h,u,f;const a="function"==typeof e?e:t=>t==e;for(o=-1,i=0;i<4;i++)if(s=n+_[i][0],h=r+_[i][1],u=n-_[i][0],f=r-_[i][1],t.hasXY(u,f)&&t.hasXY(s,h)&&a(t[u][f],u,f,t)){if(-1!=o)return-1;o=i}return o},intersection:function(t,n,r){r=r||t,t.update(((t,e,i)=>n[e][i]&&r[e][i]))},unite:function(t,n,r){r=r||t,t.update(((t,e,i)=>r[e][i]||n[e][i]))}};t.Random=p,t.configure=function(t){t.random&&function(t){if(t.make){if("function"!=typeof t.make)throw new Error("Random make parameter must be a function.");if("function"!=typeof t.make(12345))throw new Error("Random make function must accept a numeric seed and return a random function.");l.make=t.make,m.seed(),g.seed()}}(t.random)},t.cosmetic=g,t.data={},t.flag=M,t.flags=b,t.grid=O,t.random=m,t.range=w,t.utils=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-core.min.js.map
