!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GWU={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i=function(t,e,i){return t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t},s=/\s/;var n=function(t){for(var e=t.length;e--&&s.test(t.charAt(e)););return e},r=/^\s+/;var h=function(t){return t?t.slice(0,n(t)+1).replace(r,""):t};var o=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},a="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,u=a||l||Function("return this")(),c=u.Symbol,d=c,f=Object.prototype,g=f.hasOwnProperty,p=f.toString,_=d?d.toStringTag:void 0;var b=function(t){var e=g.call(t,_),i=t[_];try{t[_]=void 0;var s=!0}catch(t){}var n=p.call(t);return s&&(e?t[_]=i:delete t[_]),n},m=Object.prototype.toString;var y=b,w=function(t){return m.call(t)},v=c?c.toStringTag:void 0;var x=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":v&&v in Object(t)?y(t):w(t)};var E=x,I=function(t){return null!=t&&"object"==typeof t};var A=function(t){return"symbol"==typeof t||I(t)&&"[object Symbol]"==E(t)},S=h,T=o,C=A,M=/^[-+]0x[0-9a-f]+$/i,L=/^0b[01]+$/i,k=/^0o[0-7]+$/i,R=parseInt;var O=i,D=function(t){if("number"==typeof t)return t;if(C(t))return NaN;if(T(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=T(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=S(t);var i=L.test(t);return i||k.test(t)?R(t.slice(2),i?2:8):M.test(t)?NaN:+t};function N(){}function P(){return!0}function F(){return 1}function B(t){return t}const W=function(t,e,i){return void 0===i&&(i=e,e=void 0),void 0!==i&&(i=(i=D(i))==i?i:0),void 0!==e&&(e=(e=D(e))==e?e:0),O(D(t),e,i)};function j(t){throw new Error(t)}function V(...t){return t.find((t=>void 0!==t))}function Y(t,e){return e.every((e=>t.includes(e)))}function H(t,e){for(let i=t.length-1;i>-1;--i)e(t[i],i,t)}function U(t,e){const i=t.indexOf(e);return!(i<0)&&(t.splice(i,1),!0)}function X(t,e){const i=t.indexOf(e);return!(i<0)&&(t[i]=null,!0)}function G(t,e){for(let i=t.length-1;i>=0;--i){const s=t[i];if(e(s))return s}}function z(t,e,i,s=!0,n=!0){const r=t.length;if(r<=1)return;const h=t.indexOf(e);if(h<0)return;const o=n?1:-1;let a=s?h:n?r:-1;for(let e=s?(r+h+o)%r:h+o;e!==a;e=s?(r+e+o)%r:e+o){const s=t[e];if(i(s))return s}}function K(t,e,i,s=!0){return z(t,e,i,s,!1)}const $=[[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1]],q=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];function Q(t){return t&&"number"==typeof t.x&&"number"==typeof t.y}function Z(t){return Array.isArray(t)?t:[J(t),tt(t)]}function J(t){return t.x||t[0]||0}function tt(t){return t.y||t[1]||0}class et{constructor(t=0,e=0,i=0,s=0){if("number"!=typeof t){const n=t;s=n.height||0,i=n.width||0,e=n.y||0,t=n.x||0}this.x=t,this.y=e,this.width=i,this.height=s}get left(){return this.x}set left(t){this.x=t}get right(){return this.x+this.width}set right(t){this.x=t-this.width}get top(){return this.y}set top(t){this.y=t}get bottom(){return this.y+this.height}set bottom(t){this.y=t-this.height}get center(){return this.x+Math.floor(this.width/2)}set center(t){this.x+=t-this.center}get middle(){return this.y+Math.floor(this.height/2)}set middle(t){this.y+=t-this.middle}clone(){return new et(this.x,this.y,this.width,this.height)}copy(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}contains(...t){let e=t[0],i=t[1];return"number"!=typeof e&&(i=tt(e),e=J(e)),this.x<=e&&this.y<=i&&this.x+this.width>e&&this.y+this.height>i}include(t){const e=Math.min(J(t),this.x),i=Math.min(tt(t),this.y),s=Math.max(t instanceof et?t.right:e,this.right),n=Math.max(t instanceof et?t.bottom:i,this.bottom);this.left=e,this.top=i,this.width=s-e,this.height=n-i}pad(t=1){this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t}forEach(t){dt(this.x,this.y,this.width,this.height,t)}toString(){return`[${this.x},${this.y} -> ${this.right},${this.bottom}]`}}function it(t,e){return!t&&!e||!(!t||!e)&&(J(t)==J(e)&&tt(t)==tt(e))}function st(t){return 0!=J(t)&&0!=tt(t)}function nt(t,e,i,s=!1){const n=s?4:8;for(let s=0;s<n;++s){const n=$[s];i(t+n[0],e+n[1],n)}}function rt(t,e,i,s){const n=Math.abs(t-i),r=Math.abs(e-s);return n+r-.6*Math.min(n,r)}function ht(t,e){return rt(J(t),tt(t),J(e),tt(e))}function ot(t,e){return rt(0,0,t,e)}function at(t,e,i,s){let n=i-t,r=s-e;if(n&&r){const t=Math.abs(n),e=Math.abs(r);t>=2*e?r=0:e>=2*t&&(n=0)}return[Math.sign(n),Math.sign(r)]}const lt=65536;function ut(t,e,i,s,n){let r,h,o=[],a=[],l=[],u=[],c=[],d=[-1,-1],f=[-1,-1];if(t==i&&e==s)return!0;const g=[t,e],p=[i,s];for(h=0;h<=1;h++)o[h]=p[h]-g[h]<<16,o[h]<0?(o[h]*=-1,c[h]=-1):c[h]=1,l[h]=u[h]=a[h]=0,d[h]=g[h];for(r=Math.max(o[0],o[1]),o[0]=Math.floor(o[0]*lt/r),o[1]=Math.floor(o[1]*lt/r);;){for(h=0;h<=1;h++)f[h]=d[h],l[h]+=o[h]>>16,a[h]+=o[h]==lt?0:o[h],a[h]>=Math.floor(32768)&&(l[h]++,a[h]-=lt),d[h]=Math.floor(c[h]*l[h]+g[h]);const t=n(...d);if(!1===t)return!1;if(!0!==t&&d[0]===i&&d[1]===s)return!0}}function ct(t,e,i,s){let n,r;for(n=t-i-1;n<t+i+1;n++)for(r=e-i-1;r<e+i+1;r++)(n-t)*(n-t)+(r-e)*(r-e)<i*i+i&&s(n,r)}function dt(...t){let e=0,i=0;arguments.length>3&&(e=t.shift(),i=t.shift());const s=e+t[0],n=i+t[1],r=t[2];for(let t=e;t<s;++t)for(let e=i;e<n;++e)r(t,e)}function ft(t,e,i,s,n,r=console.log){let h,o;const a=e+s,l=t+i;let u=[];for(o=e;o<a;o++){let e=(o+"]").padStart(3," ");for(h=t;h<l;h++)h%10==0&&(e+=" "),e+=n(h,o);u.push(e)}r(u.join("\n"))}function gt(...t){let e=0,i=0;arguments.length>3&&(e=t.shift(),i=t.shift());const s=e+t[0]-1,n=i+t[1]-1,r=t[2];for(let t=e;t<=s;++t)r(t,i),r(t,n);for(let t=i;t<=n;++t)r(e,t),r(s,t)}function pt(t,e,i){let s,n,r,h,o=0,a=0;for(let l=0;l<q.length;l++){s=t+q[(l+7)%8][0],n=e+q[(l+7)%8][1],r=t+q[l][0],h=e+q[l][1];const u=i(r,h);u&&++a,u!=i(s,n)&&o++}return 0==o&&a?1:Math.floor(o/2)}function _t(t,e,i){const s=[];let n,r,h;for(h=0;h<100&&!s.length;h++)for(n=t-h;n<=t+h;n++)for(r=e-h;r<=e+h;r++)Math.ceil(rt(t,e,n,r))==h&&i(n,r)&&s.push([n,r]);return s.length?s:null}var bt=Object.freeze({__proto__:null,DIRS:$,NO_DIRECTION:-1,UP:0,RIGHT:1,DOWN:2,LEFT:3,RIGHT_UP:4,RIGHT_DOWN:5,LEFT_DOWN:6,LEFT_UP:7,CLOCK_DIRS:q,isLoc:function(t){return Array.isArray(t)&&2==t.length&&"number"==typeof t[0]&&"number"==typeof t[1]},isXY:Q,asLoc:Z,asXY:function(t){return Array.isArray(t)?{x:J(t),y:tt(t)}:t},x:J,y:tt,contains:function(t,e,i){return e>=0&&i>=0&&e<t.width&&i<t.height},Bounds:et,copy:function(t,e){t.x=J(e),t.y=tt(e)},addTo:function(t,e){t.x+=J(e),t.y+=tt(e)},add:function(t,e){return Array.isArray(t)?[t[0]+J(e),t[1]+tt(e)]:{x:t.x+J(e),y:t.y+tt(e)}},equals:it,isDiagonal:st,lerp:function(t,e,i){i>1&&(i/=100),i=W(i,0,1);const s=J(e)-J(t),n=tt(e)-tt(t);return[J(t)+Math.floor(s*i),tt(t)+Math.floor(n*i)]},eachNeighbor:nt,eachNeighborAsync:async function(t,e,i,s=!1){const n=s?4:8;for(let s=0;s<n;++s){const n=$[s],r=t+n[0],h=e+n[1];await i(r,h,n)}},matchingNeighbor:function(t,e,i,s=!1){const n=s?4:8;for(let s=0;s<n;++s){const n=$[s],r=t+n[0],h=e+n[1];if(i(r,h,n))return[r,h]}return[-1,-1]},straightDistanceBetween:function(t,e,i,s){return Math.abs(t-i)+Math.abs(e-s)},maxAxisFromTo:function(t,e){const i=Math.abs(J(t)-J(e)),s=Math.abs(tt(t)-tt(e));return Math.max(i,s)},maxAxisBetween:function(t,e,i,s){const n=Math.abs(t-i),r=Math.abs(e-s);return Math.max(n,r)},distanceBetween:rt,distanceFromTo:ht,calcRadius:ot,dirBetween:at,dirFromTo:function(t,e){return at(J(t),tt(t),J(e),tt(e))},dirIndex:function(t){const e=J(t),i=tt(t);return $.findIndex((t=>t[0]==e&&t[1]==i))},isOppositeDir:function(t,e){return Math.sign(t[0])+Math.sign(e[0])==0&&Math.sign(t[1])+Math.sign(e[1])==0},isSameDir:function(t,e){return Math.sign(t[0])==Math.sign(e[0])&&Math.sign(t[1])==Math.sign(e[1])},dirSpread:function(t){const e=[t];return 0==t[0]?(e.push([1,t[1]]),e.push([-1,t[1]])):0==t[1]?(e.push([t[0],1]),e.push([t[0],-1])):(e.push([t[0],0]),e.push([0,t[1]])),e},stepFromTo:function(t,e,i){const s=J(t),n=tt(t),r=[J(e)-s,tt(e)-n],h=Math.abs(r[0])+Math.abs(r[1]),o=[0,0],a=[99999,99999];for(let t=0;t<=h;++t)o[0]=s+Math.floor(r[0]*t/h),o[1]=n+Math.floor(r[1]*t/h),o[0]==a[0]&&o[1]==a[1]||i(o[0],o[1]),a[0]=o[0],a[1]=o[1]},forLine:function(t,e,i,s,n){for(let r=0;r<s;++r)n(t+r*i[0],e+r*i[1])},forLineBetween:ut,forLineFromTo:function(t,e,i){return ut(J(t),tt(t),J(e),tt(e),i)},getLine:function(t,e,i,s){const n=[];return ut(t,e,i,s,((t,e)=>{n.push([t,e])})),n},getLineThru:function(t,e,i,s,n,r){const h=[];return ut(t,e,i,s,((t,e)=>!(t<0||e<0||t>=n||e>=r)&&(h.push([t,e]),!0))),h},forCircle:ct,forRect:dt,dumpRect:ft,dumpAround:function(t,e,i,s,n=console.log){ft(t-i,e-i,2*i+1,2*i+1,s,n)},forBorder:gt,arcCount:pt,closestMatchingLocs:_t});function mt(t,e){let i=0;for(;t;){const s=t.next;e(t,i++),t=s}return i}var yt=Object.freeze({__proto__:null,length:function(t){let e=0;for(;t;)e+=1,t=t.next;return e},at:function(t,e){for(;t&&e;)t=t.next,--e;return t},includes:function(t,e){for(;t&&t!==e;)t=t.next;return t===e},forEach:mt,push:function(t,e,i){return i.next=t[e]||null,t[e]=i,!0},remove:function(t,e,i){const s=t[e];if(s===i)return t[e]=i.next||null,i.next=null,!0;if(!s)return!1;{let t=s,e=t.next;for(;e&&e!==i;)t=e,e=t.next;if(e===i)return t.next=e.next,i.next=null,!0}return!1},find:function(t,e){for(;t&&!e(t);)t=t.next;return t},insert:function(t,e,i,s){let n=t[e];if(s=s||(()=>-1),!n||s(n,i)<0)return i.next=n,t[e]=i,!0;let r=n,h=n.next;for(;h&&s(h,i)>0;)r=h,h=h.next;return i.next=h,r.next=i,!0},reduce:function(t,e,i){let s=t;if(void 0===i){if(!s)throw new TypeError("Empty list reduce without initial value not allowed.");i=s,s=s.next}for(;s;)i=e(i,s),s=s.next;return i},some:function(t,e){let i=t;for(;i;){if(e(i))return!0;i=i.next}return!1},every:function(t,e){let i=t;for(;i;){if(!e(i))return!1;i=i.next}return!0}}),wt=Array.isArray,vt=wt,xt=A,Et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,It=/^\w*$/;var At=function(t,e){if(vt(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!xt(t))||(It.test(t)||!Et.test(t)||null!=e&&t in Object(e))},St=x,Tt=o;var Ct,Mt=function(t){if(!Tt(t))return!1;var e=St(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Lt=u["__core-js_shared__"],kt=(Ct=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||""))?"Symbol(src)_1."+Ct:"";var Rt=function(t){return!!kt&&kt in t},Ot=Function.prototype.toString;var Dt=Mt,Nt=Rt,Pt=o,Ft=function(t){if(null!=t){try{return Ot.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Bt=/^\[object .+?Constructor\]$/,Wt=Function.prototype,jt=Object.prototype,Vt=Wt.toString,Yt=jt.hasOwnProperty,Ht=RegExp("^"+Vt.call(Yt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ut=function(t){return!(!Pt(t)||Nt(t))&&(Dt(t)?Ht:Bt).test(Ft(t))},Xt=function(t,e){return null==t?void 0:t[e]};var Gt=function(t,e){var i=Xt(t,e);return Ut(i)?i:void 0},zt=Gt(Object,"create"),Kt=zt;var $t=function(){this.__data__=Kt?Kt(null):{},this.size=0};var qt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Qt=zt,Zt=Object.prototype.hasOwnProperty;var Jt=function(t){var e=this.__data__;if(Qt){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return Zt.call(e,t)?e[t]:void 0},te=zt,ee=Object.prototype.hasOwnProperty;var ie=zt;var se=$t,ne=qt,re=Jt,he=function(t){var e=this.__data__;return te?void 0!==e[t]:ee.call(e,t)},oe=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=ie&&void 0===e?"__lodash_hash_undefined__":e,this};function ae(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}ae.prototype.clear=se,ae.prototype.delete=ne,ae.prototype.get=re,ae.prototype.has=he,ae.prototype.set=oe;var le=ae;var ue=function(){this.__data__=[],this.size=0};var ce=function(t,e){return t===e||t!=t&&e!=e},de=ce;var fe=function(t,e){for(var i=t.length;i--;)if(de(t[i][0],e))return i;return-1},ge=fe,pe=Array.prototype.splice;var _e=fe;var be=fe;var me=fe;var ye=ue,we=function(t){var e=this.__data__,i=ge(e,t);return!(i<0)&&(i==e.length-1?e.pop():pe.call(e,i,1),--this.size,!0)},ve=function(t){var e=this.__data__,i=_e(e,t);return i<0?void 0:e[i][1]},xe=function(t){return be(this.__data__,t)>-1},Ee=function(t,e){var i=this.__data__,s=me(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this};function Ie(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}Ie.prototype.clear=ye,Ie.prototype.delete=we,Ie.prototype.get=ve,Ie.prototype.has=xe,Ie.prototype.set=Ee;var Ae=Ie,Se=Gt(u,"Map"),Te=le,Ce=Ae,Me=Se;var Le=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ke=function(t,e){var i=t.__data__;return Le(e)?i["string"==typeof e?"string":"hash"]:i.map},Re=ke;var Oe=ke;var De=ke;var Ne=ke;var Pe=function(){this.size=0,this.__data__={hash:new Te,map:new(Me||Ce),string:new Te}},Fe=function(t){var e=Re(this,t).delete(t);return this.size-=e?1:0,e},Be=function(t){return Oe(this,t).get(t)},We=function(t){return De(this,t).has(t)},je=function(t,e){var i=Ne(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this};function Ve(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}Ve.prototype.clear=Pe,Ve.prototype.delete=Fe,Ve.prototype.get=Be,Ve.prototype.has=We,Ve.prototype.set=je;var Ye=Ve;function He(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],r=i.cache;if(r.has(n))return r.get(n);var h=t.apply(this,s);return i.cache=r.set(n,h)||r,h};return i.cache=new(He.Cache||Ye),i}He.Cache=Ye;var Ue=He;var Xe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ge=/\\(\\)?/g,ze=function(t){var e=Ue(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Xe,(function(t,i,s,n){e.push(s?n.replace(Ge,"$1"):i||t)})),e}));var Ke=function(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n},$e=wt,qe=A,Qe=c?c.prototype:void 0,Ze=Qe?Qe.toString:void 0;var Je=function t(e){if("string"==typeof e)return e;if($e(e))return Ke(e,t)+"";if(qe(e))return Ze?Ze.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i};var ti=wt,ei=At,ii=ze,si=function(t){return null==t?"":Je(t)};var ni=function(t,e){return ti(t)?t:ei(t,e)?[t]:ii(si(t))},ri=A;var hi=function(t){if("string"==typeof t||ri(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},oi=ni,ai=hi;var li=function(t,e){for(var i=0,s=(e=oi(e,t)).length;null!=t&&i<s;)t=t[ai(e[i++])];return i&&i==s?t:void 0};var ui=function(t,e,i){var s=null==t?void 0:li(t,e);return void 0===s?i:s};const ci=ui;function di(t,e,i){const s=t[i],n=e[i];s&&s.copy&&n?s.copy(n):s&&s.clear&&!n?s.clear():s&&s.nullify&&!n?s.nullify():n&&n.clone?t[i]=n.clone():n&&Array.isArray(n)?t[i]=n.slice():s&&Array.isArray(s)?s.length=0:void 0!==n&&(t[i]=n)}function fi(t,e,i=null){let s;e&&Object.keys(e).forEach((n=>{const r=n;let h=e[n];s=t;const o=n.split(".");for(;o.length>1;)n=o.shift(),void 0===s[n]?s=s[n]={}:"object"!=typeof s[n]?j("Trying to set default member on non-object config item: "+r):s=s[n];n=o.shift();let a=s[n];i&&i(s,n,a,h)||void 0===a&&(null===h?s[n]=null:Array.isArray(h)?s[n]=h.slice():s[n]=h)}))}var gi=Object.freeze({__proto__:null,getValue:ci,copyObject:function(t,e){return Object.keys(t).forEach((i=>{di(t,e,i)})),t},assignObject:function(t,e){return Object.keys(e).forEach((i=>{di(t,e,i)})),t},assignOmitting:function(t,e,i){return"string"==typeof t&&(t=t.split(/[,|]/g).map((t=>t.trim()))),Object.keys(i).forEach((s=>{t.includes(s)||di(e,i,s)})),e},setDefault:function(t,e,i){void 0===t[e]&&(t[e]=i)},setDefaults:fi,setOptions:function(t,e){fi(t,e,((t,e,i,s)=>(null===s?t[e]=null:Array.isArray(s)?t[e]=s.slice():t[e]=s,!0)))},kindDefaults:function(t,e){return fi(t,e,(function(t,e,i,s){return!(e.search(/[fF]lags$/)<0)&&(i?"string"==typeof i?i=i.split(/[,|]/).map((t=>t.trim())):Array.isArray(i)||(i=[i]):i=[],"string"==typeof s?s=s.split(/[,|]/).map((t=>t.trim())):Array.isArray(s)||(s=[s]),t[e]=s.concat(i),!0)}))},pick:function(t,...e){const i={};return e.forEach((e=>{const s=t[e];void 0!==s&&(i[e]=s)})),i},clearObject:function(t){Object.keys(t).forEach((e=>t[e]=void 0))},getOpt:function(t,e,i){const s=t[e];return void 0===s?i:s},firstOpt:function(t,...e){for(let i of e){if("object"!=typeof i||Array.isArray(i))return i;if(i&&void 0!==i[t])return i[t]}}});const pi=$;function _i(t){return!1===t?" ":!0===t?"T":t<10?""+t:t<36?String.fromCharCode("a".charCodeAt(0)+t-10):t<62?String.fromCharCode("A".charCodeAt(0)+t-10-26):"string"==typeof t?t[0]:"#"}class bi extends Array{constructor(t,e,i){super(t);const s=this;for(let n=0;n<t;++n)this[n]="function"==typeof i?new Array(e).fill(0).map(((t,e)=>i(n,e,s))):new Array(e).fill(i);this._width=t,this._height=e}get width(){return this._width}get height(){return this._height}get(t,e){if(this.hasXY(t,e))return this[t][e]}set(t,e,i){return!!this.hasXY(t,e)&&(this[t][e]=i,!0)}forEach(t){let e,i;for(e=0;e<this.width;e++)for(i=0;i<this.height;i++)t(this[e][i],e,i,this)}async forEachAsync(t){let e,i;for(e=0;e<this.width;e++)for(i=0;i<this.height;i++)await t(this[e][i],e,i,this)}eachNeighbor(t,e,i,s=!1){nt(t,e,((t,e)=>{this.hasXY(t,e)&&i(this[t][e],t,e,this)}),s)}async eachNeighborAsync(t,e,i,s=!1){const n=s?4:8;for(let s=0;s<n;++s){const n=pi[s],r=t+n[0],h=e+n[1];this.hasXY(r,h)&&await i(this[r][h],r,h,this)}}forRect(t,e,i,s,n){dt(t,e,i,s,((t,e)=>{this.hasXY(t,e)&&n(this[t][e],t,e,this)}))}randomEach(t){const e=Mi.sequence(this.width*this.height);for(let i=0;i<e.length;++i){const s=e[i],n=s%this.width,r=Math.floor(s/this.width);if(!0===t(this[n][r],n,r,this))return!0}return!1}map(t){const e=new this.constructor(this.width,this.height);return e.copy(this),e.update(t),e}some(t){return super.some(((e,i)=>e.some(((e,s)=>t(e,i,s,this)))))}forCircle(t,e,i,s){ct(t,e,i,((t,e)=>{this.hasXY(t,e)&&s(this[t][e],t,e,this)}))}hasXY(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}isBoundaryXY(t,e){return this.hasXY(t,e)&&(0==t||t==this.width-1||0==e||e==this.height-1)}calcBounds(){const t={left:this.width,top:this.height,right:0,bottom:0};return this.forEach(((e,i,s)=>{e&&(t.left>i&&(t.left=i),t.right<i&&(t.right=i),t.top>s&&(t.top=s),t.bottom<s&&(t.bottom=s))})),t}update(t){dt(this.width,this.height,((e,i)=>{this[e][i]=t(this[e][i],e,i,this)}))}updateRect(t,e,i,s,n){dt(t,e,i,s,((t,e)=>{this.hasXY(t,e)&&(this[t][e]=n(this[t][e],t,e,this))}))}updateCircle(t,e,i,s){ct(t,e,i,((t,e)=>{this.hasXY(t,e)&&(this[t][e]=s(this[t][e],t,e,this))}))}fill(t){const e="function"==typeof t?t:()=>t;this.update(e)}fillRect(t,e,i,s,n){const r="function"==typeof n?n:()=>n;this.updateRect(t,e,i,s,r)}fillCircle(t,e,i,s){const n="function"==typeof s?s:()=>s;this.updateCircle(t,e,i,n)}replace(t,e){this.update((i=>i==t?e:i))}copy(t){this.update(((e,i,s)=>t[i][s]))}count(t){const e="function"==typeof t?t:e=>e==t;let i=0;return this.forEach(((t,s,n)=>{e(t,s,n,this)&&++i})),i}find(t){const e="function"==typeof t?t:e=>e==t;for(let t=0;t<this.width;++t)for(let i=0;i<this.height;++i){if(e(this[t][i],t,i,this))return[t,i]}return null}dump(t,e=console.log){this.dumpRect(0,0,this.width,this.height,t,e)}dumpRect(t,e,i,s,n,r=console.log){n=n||_i;return ft(t,e,i,s,((t,e)=>n(this.get(t,e),t,e)),r)}dumpAround(t,e,i,s,n=console.log){this.dumpRect(t-i,e-i,2*i+1,2*i+1,s,n)}closestMatchingLoc(t,e,i){let s=[-1,-1],n=100*(this.width+this.height);const r="function"==typeof i?i:t=>t==i;return this.forEach(((i,h,o)=>{if(r(i,h,o,this)){const i=Math.floor(100*rt(t,e,h,o));i<n?(s[0]=h,s[1]=o,n=i):i==n&&Mi.chance(50)&&(s[0]=h,s[1]=o)}})),s}firstMatchingLoc(t){const e="function"==typeof t?t:e=>e==t;for(let t=0;t<this.width;++t)for(let i=0;i<this.height;++i)if(e(this[t][i],t,i,this))return[t,i];return[-1,-1]}randomMatchingLoc(t){const e="function"==typeof t?(e,i)=>t(this[e][i],e,i,this):(e,i)=>this.get(e,i)===t;return Mi.matchingLoc(this.width,this.height,e)}matchingLocNear(t,e,i){const s="function"==typeof i?(t,e)=>i(this[t][e],t,e,this):(t,e)=>this.get(t,e)===i;return Mi.matchingLocNear(t,e,s)}arcCount(t,e,i){return pt(t,e,((t,e)=>this.hasXY(t,e)&&i(this[t][e],t,e,this)))}}const mi=[],yi={active:0,alloc:0,create:0,free:0};class wi extends bi{constructor(t,e,i=0){super(t,e,i)}static alloc(...t){let e=t[0]||0,i=t[1]||0,s=t[2]||0;if(1==t.length&&(e=t[0].width,i=t[0].height,s=t[0].get.bind(t[0])),!e||!i)throw new Error("Grid alloc requires width and height parameters.");++yi.active,++yi.alloc;let n=mi.pop();return n?(n._resize(e,i,s),n):(++yi.create,new wi(e,i,s))}static free(t){if(t){if(mi.indexOf(t)>=0)return;mi.push(t),++yi.free,--yi.active}}_resize(t,e,i){const s="function"==typeof i?i:()=>i;for(;this.length<t;)this.push([]);this.length=t;let n=0,r=0;for(n=0;n<t;++n){const t=this[n];for(r=0;r<e;++r)t[r]=s(n,r,this);t.length=e}this._width=t,this._height=e,void 0!==this.x&&(this.x=void 0,this.y=void 0)}findReplaceRange(t,e,i){this.update((s=>s>=t&&s<=e?i:s))}floodFillRange(t,e,i,s,n){let r,h,o,a=1;if(n>=i&&n<=s)throw new Error("Invalid grid flood fill");const l=(t,e)=>this.hasXY(t,e)&&this[t][e]>=i&&this[t][e]<=s;if(!l(t,e))return 0;for(this[t][e]=n,r=0;r<4;r++)h=t+pi[r][0],o=e+pi[r][1],l(h,o)&&(a+=this.floodFillRange(h,o,i,s,n));return a}invert(){this.update((t=>t?0:1))}leastPositiveValue(){let t=Number.MAX_SAFE_INTEGER;return this.forEach((e=>{e>0&&e<t&&(t=e)})),t}randomLeastPositiveLoc(){const t=this.leastPositiveValue();return this.randomMatchingLoc(t)}valueBounds(t,e){let i,s,n=!1,r=this.width-1,h=0,o=this.height-1,a=0;for(i=0;i<this.width;i++){for(n=!1,s=0;s<this.height;s++)if(this[i][s]==t){n=!0;break}n&&(i<r&&(r=i),i>h&&(h=i))}for(s=0;s<this.height;s++){for(n=!1,i=0;i<this.width;i++)if(this[i][s]==t){n=!0;break}n&&(s<o&&(o=s),s>a&&(a=s))}return(e=e||new et(0,0,0,0)).x=r,e.y=o,e.width=h-r+1,e.height=a-o+1,e}floodFill(t,e,i,s){const n="function"==typeof i?i:t=>t==i,r="function"==typeof s?s:()=>s;let h,o,a=wi.alloc(this.width,this.height);const l=[[t,e]],u=[];let c=1;for(;l.length;){const i=l.pop();if([t,e]=i,u.push(i),this.hasXY(t,e)&&!a[t][e]&&n(this[t][e],t,e,this)){this[t][e]=r(this[t][e],t,e,this),a[t][e]=1,++c;for(let i=0;i<4;i++){h=t+pi[i][0],o=e+pi[i][1];const s=u.pop()||[-1,-1];s[0]=h,s[1]=o,l.push(s)}}}return wi.free(a),c}}const vi=wi.alloc.bind(wi),xi=wi.free.bind(wi);function Ei(t,e,i){return void 0===i?new wi(t,e,0):"number"==typeof i?new wi(t,e,i):new bi(t,e,i)}var Ii=Object.freeze({__proto__:null,makeArray:function(t,e){if(void 0===e)return new Array(t).fill(0);let i;i="function"!=typeof e?()=>e:e;const s=new Array(t);for(let e=0;e<t;++e)s[e]=i(e);return s},Grid:bi,stats:yi,NumGrid:wi,alloc:vi,free:xi,make:Ei,offsetZip:function(t,e,i,s,n){const r="function"==typeof n?n:(e,i,s,r)=>t[s][r]=n;e.forEach(((n,h,o)=>{const a=h+i,l=o+s;t.hasXY(a,l)&&n&&r(t[a][l],n,a,l,h,o,t,e)}))},intersection:function(t,e,i){i=i||t,t.update(((t,s,n)=>e[s][n]&&i[s][n]||0))},unite:function(t,e,i){i=i||t,t.update(((t,s,n)=>i[s][n]||e[s][n]))}});function Ai(t){t=Math.abs(t||Date.now());const e=2.3283064365386963e-10;let i=0,s=0,n=0,r=0;return i=((t=t<1?1/t:t)>>>0)*e,s=(t=69069*t+1>>>0)*e,n=(t=69069*t+1>>>0)*e,r=1,function(){let t=2091639*i+r*e;return i=s,s=n,r=0|t,n=t-r,n}}const Si={make:Ai};function Ti(t,e){let i,s,n;for(s=0,i=0;i<e.length;i++)s+=e[i];if(s<=0)return-1;for(n=t.range(0,s-1),i=0;i<e.length;i++){if(e[i]>n)return i;n-=e[i]}return console.warn("Lottery Draw failed.",e,e.length),0}class Ci{constructor(t){this._fn=Si.make(t)}seed(t){t=t||Date.now(),this._fn=Si.make(t)}value(){return this._fn()}float(){return this.value()}number(t=Number.MAX_SAFE_INTEGER){return t<=0?0:Math.floor(this.value()*t)}int(t=0){return this.number(t)}range(t,e){if(e<=t)return e;const i=e-t+1;return t+this.number(i)}normal(t=0,e=1){let i,s,n;do{i=2*this.value()-1,s=2*this.value()-1,n=i*i+s*s}while(n>1||0==n);return t+i*Math.sqrt(-2*Math.log(n)/n)*e}dice(t,e,i=0){let s=0,n=1;t<0&&(t=-t,n=-1),i=i||0;for(let i=0;i<t;++i)s+=this.range(1,e);return s*=n,s+i}weighted(t){return Array.isArray(t)?Ti(this,t):function(t,e){const i=Object.entries(e),s=Ti(t,i.map((([t,e])=>e)));return s<0?-1:i[s][0]}(this,t)}item(t){return Array.isArray(t)||(t=Object.values(t)),t[this.range(0,t.length-1)]}key(t){return this.item(Object.keys(t))}shuffle(t,e=0,i=0){let s,n,r;for(2==arguments.length&&(i=e,e=0),i=i||t.length,s=e=e||0;s<i;s++)n=this.range(e,i-1),s!=n&&(r=t[n],t[n]=t[s],t[s]=r);return t}sequence(t){const e=[];for(let i=0;i<t;i++)e[i]=i;return this.shuffle(e)}chance(t,e=100){return!(t<=0)&&(t>=e||this.number(e)<t)}clumped(t,e,i){if(e<=t)return t;if(i<=1)return this.range(t,e);let s,n=0,r=Math.floor((e-t)/i);for(s=0;s<(e-t)%i;s++)n+=this.range(0,r+1);for(;s<i;s++)n+=this.range(0,r);return n+t}matchingLoc(t,e,i){let s,n,r,h=0;const o=vi(t,e);if(h=0,o.update(((t,e,s)=>i(e,s)?(++h,1):0)),h)for(r=this.range(0,h-1),s=0;s<t&&r>=0;s++)for(n=0;n<e&&r>=0;n++)if(o[s][n]){if(0==r)return xi(o),[s,n];r--}return xi(o),[-1,-1]}matchingLocNear(t,e,i){let s,n,r,h,o,a=[-1,-1];for(h=0,r=0;r<50&&!h;r++)for(s=t-r;s<=t+r;s++)for(n=e-r;n<=e+r;n++)Math.ceil(rt(t,e,s,n))==r&&i(s,n)&&h++;if(0==h)return[-1,-1];for(o=1+this.number(h),--r,s=t-r;s<=t+r;s++)for(n=e-r;n<=e+r;n++)if(Math.ceil(rt(t,e,s,n))==r&&i(s,n)&&0==--o)return a[0]=s,a[1]=n,a;return[-1,-1]}}const Mi=new Ci,Li=new Ci;var ki=Object.freeze({__proto__:null,Alea:Ai,configure:function(t={}){t.make&&(Si.make=t.make,Mi.seed(),Li.seed())},Random:Ci,random:Mi,cosmetic:Li,make:function(t){return new Ci(t)}});class Ri{constructor(t,e=0,i=1){Array.isArray(t)&&(i=t[2],e=t[1],t=t[0]),e<t&&([e,t]=[t,e]),this.lo=t||0,this.hi=e||this.lo,this.clumps=i||1}value(t){return(t=t||Mi).clumped(this.lo,this.hi,this.clumps)}max(){return this.hi}contains(t){return this.lo<=t&&this.hi>=t}copy(t){return this.lo=t.lo,this.hi=t.hi,this.clumps=t.clumps,this}toString(){return this.lo>=this.hi?""+this.lo:`${this.lo}-${this.hi}`}}function Oi(t){if(!t)return new Ri(0,0,0);if(t instanceof Ri)return t;if("function"==typeof t)throw new Error("Custom range functions not supported - extend Range");if(null==t)return new Ri(0,0,0);if("number"==typeof t)return new Ri(t,t,1);if(!0===t||!1===t)throw new Error("Invalid random config: "+t);if(Array.isArray(t))return new Ri(t[0],t[1],t[2]);if("string"!=typeof t)throw new Error("Calculations must be strings.  Received: "+JSON.stringify(t));if(0==t.length)return new Ri(0,0,0);const e=/^(?:([+-]?\d*)[Dd](\d+)([+-]?\d*)|([+-]?\d+)-(\d+):?(\d+)?|([+-]?\d+)~(\d+)|([+-]?\d+)\+|([+-]?\d+))$/g;let i;for(;null!==(i=e.exec(t));){if(i[2]){let t=Number.parseInt(i[1])||1;const e=Number.parseInt(i[2]),s=Number.parseInt(i[3])||0;return new Ri(s+t,s+t*e,t)}if(i[4]&&i[5]){const t=Number.parseInt(i[4]),e=Number.parseInt(i[5]),s=Number.parseInt(i[6]);return new Ri(t,e,s)}if(i[7]&&i[8]){const t=Number.parseInt(i[7]),e=Number.parseInt(i[8]);return new Ri(t-2*e,t+2*e,3)}if(i[9]){const t=Number.parseInt(i[9]);return new Ri(t,Number.MAX_SAFE_INTEGER,1)}if(i[10]){const t=Number.parseInt(i[10]);return new Ri(t,t,1)}}throw new Error("Not a valid range - "+t)}const Di=Oi;var Ni=Object.freeze({__proto__:null,Range:Ri,make:Oi,from:Di,asFn:function(t){const e=Oi(t);return()=>e.value()},value:function(t){return Oi(t).value()}});function Pi(t){if(!t)return()=>!0;const e=[];if("string"==typeof t){return t.split(",").map((t=>t.trim())).forEach((t=>{t.split(/[|]/).map((t=>t.trim())).forEach((t=>{const i=t.split(/[&]/).map((t=>t.trim())).map((t=>{if(t.startsWith("!")){const e=t.substring(1);return t=>!t.includes(e)}return e=>e.includes(t)}));e.push((t=>i.every((e=>e(t)))))}))})),t=>e.some((e=>e(t)))}{"string"==typeof t.tags&&(t.tags=t.tags.split(/[:,|]/g).map((t=>t.trim()))),"string"==typeof t.forbidTags&&(t.forbidTags=t.forbidTags.split(/[:,|]/g).map((t=>t.trim())));const e=t.tags,i=t.forbidTags||[];return t=>e.every((e=>t.includes(e)))&&!i.some((e=>t.includes(e)))}}var Fi=Object.freeze({__proto__:null,make:function(t){return t?("string"==typeof t&&(t=t.split(/[|,]/g)),t.map((t=>t.trim())).filter((t=>t&&t.length))):[]},makeMatch:Pi,match:function(t,e){return Pi(e)(t)}});function Bi(t){return 2**t}function Wi(t,e,...i){let s=0;for(let n=0;n<i.length;++n){let r=i[n];void 0!==r&&("number"!=typeof r?("string"==typeof r&&(r=r.split(/[,|]/).map((t=>t.trim())).map((t=>{const e=Number.parseInt(t);return e>=0?e:t}))),Array.isArray(r)&&r.forEach((i=>{if("string"==typeof i){const n=(i=i.trim()).split(/[,|]/);if(n.length>1)s=Wi(t,e,s,n);else if(i.startsWith("!")){const e=t[i.substring(1)];s&=~e}else{const n=Number.parseInt(i);if(n>=0)return void(s|=n);const r=t[i];if(r)s|=r;else if(e)throw new Error(`Unknown flag - ${i}`)}}else 0===i?s=0:s|=i}))):s|=r)}return s}function ji(t,...e){return Wi(t,!0,...e)}function Vi(t){const e={};if("string"==typeof t&&(t=t.split(/[|,]/).map((t=>t.trim()))),Array.isArray(t)){const e={};let i=0,s=[];return t.forEach((t=>{if(t.includes("=")){const[i,n]=t.split("=").map((t=>t.trim())),r=n.split("|").map((t=>t.trim()));let h=0;for(let i=0;i<r.length;++i){const n=r[i];if(e[n])h|=e[n];else{const e=Number.parseInt(n);if(!e)throw new Error(`Failed to parse flag = ${t}`);h|=e;for(let t=0;t<32;++t)h&1<<t&&(s[t]=1)}}e[i]=h}else{for(;s[i];)++i;if(i>31)throw new Error("Flag uses too many bits! [Max=32]");e[t]=Bi(i),s[i]=1}})),e}return Object.entries(t).forEach((([t,i])=>{e[t]=ji(e,i)})),e}var Yi=Object.freeze({__proto__:null,fl:Bi,toString:function(t,e){const i=Object.entries(t).reduce(((t,e)=>{const[i,s]=e;return"number"==typeof s&&(t[s]?t[s]+=" | "+i:t[s]=i),t}),[]),s=[];for(let t=0;t<32;++t){const n=1<<t;e&n&&s.push(i[n])}return s.join(" | ")},from:ji,from_safe:function(t,...e){return Wi(t,!1,...e)},make:Vi});var Hi=Object.freeze({__proto__:null,AsyncQueue:class{constructor(){this._waiting=null,this._data=[]}get length(){return this._data.length}clear(){this._data.length=0}get last(){return this._data[this._data.length-1]}get first(){return this._data[0]}enqueue(t){if(this._waiting){const e=this._waiting;this._waiting=null,e(t)}else this._data.push(t)}prepend(t){this._waiting?(this._waiting(t),this._waiting=null):this._data.unshift(t)}dequeue(){const t=this._data.shift();if(t)return Promise.resolve(t);if(this._waiting)throw new Error("Too many requesters.");return new Promise((t=>{this._waiting=t}))}}});const Ui={};class Xi{constructor(t=-1,e=0,i=0,s=100){this._rand=null,this.dances=!1,t<0&&(s=0,t=0),this._data=[t,e,i,s]}rgb(){return[this.r,this.g,this.b]}rgba(){return[this.r,this.g,this.b,this.a]}get r(){return Math.round(2.550001*this._data[0])}get _r(){return this._data[0]}get _ra(){return Math.round(this._data[0]*this._data[3]/100)}get g(){return Math.round(2.550001*this._data[1])}get _g(){return this._data[1]}get _ga(){return Math.round(this._data[1]*this._data[3]/100)}get b(){return Math.round(2.550001*this._data[2])}get _b(){return this._data[2]}get _ba(){return Math.round(this._data[2]*this._data[3]/100)}get a(){return this._data[3]}get _a(){return this.a}rand(t,e=0,i=0,s=0){return this._rand=[t,e,i,s],this.dances=!1,this}dance(t,e,i,s){return this.rand(t,e,i,s),this.dances=!0,this}isNull(){return 0===this._data[3]}alpha(t){return new Xi(this._data[0],this._data[1],this._data[2],W(t,0,100))}get l(){return Math.round(.5*(Math.min(this._r,this._g,this._b)+Math.max(this._r,this._g,this._b)))}get s(){return this.l>=100?0:Math.round((Math.max(this._r,this._g,this._b)-Math.min(this._r,this._g,this._b))*(100-Math.abs(2*this.l-100))/100)}get h(){let t=0,e=this.r,i=this.g,s=this.b;return t=e>=i&&i>=s?(i-s)/(e-s)*60:i>e&&e>=s?60*(2-(e-s)/(i-s)):i>=s&&s>e?60*(2+(s-e)/(i-e)):s>i&&i>e?60*(4-(i-e)/(s-e)):s>e&&e>=i?60*(4+(e-i)/(s-i)):60*(6-(s-i)/(e-i)),Math.round(t)||0}equals(t){if("string"==typeof t){if(t.startsWith("#"))return(t=Qi(t)).equals(this);if(this.name)return this.name===t}else if("number"==typeof t)return this.toInt()===t;const e=Qi(t);return this.isNull()?e.isNull():!e.isNull()&&this.toInt()===e.toInt()}toInt(t=!0){if(this.isNull())return 0;let e=this._r,i=this._g,s=this._b,n=this._a;if(t&&(this._rand||this.dances)){const t=Li.number(this._rand[0]),r=Li.number(this._rand[1]),h=Li.number(this._rand[2]),o=Li.number(this._rand[3]);e=Math.round((e+t+r)*n/100),i=Math.round((i+t+h)*n/100),s=Math.round((s+t+o)*n/100)}return e=Math.max(0,Math.min(15,Math.round(e/100*15))),i=Math.max(0,Math.min(15,Math.round(i/100*15))),s=Math.max(0,Math.min(15,Math.round(s/100*15))),n=Math.max(0,Math.min(15,Math.round(n/100*15))),(e<<12)+(i<<8)+(s<<4)+n}toLight(){return[this._ra,this._ga,this._ba]}clamp(){return this.isNull()?this:qi(this._data.map((t=>W(t,0,100))))}blend(t){const e=Qi(t);if(e.isNull())return this;if(100===e.a)return e;const i=e.a/100,s=1-i,n=qi(Math.round(this._data[0]*s+e._data[0]*i),Math.round(this._data[1]*s+e._data[1]*i),Math.round(this._data[2]*s+e._data[2]*i),Math.round(e.a+this._data[3]*s));if(this._rand&&(n._rand=this._rand.map((t=>Math.round(t*s))),n.dances=this.dances),e._rand){n._rand||(n._rand=[0,0,0,0]);for(let t=0;t<4;++t)n._rand[t]+=Math.round(e._rand[t]*i);n.dances=n.dances||e.dances}return n}mix(t,e){const i=Qi(t);if(i.isNull())return this;if(e>=100)return i;const s=W(e,0,100)/100,n=1-s,r=qi(Math.round(this._data[0]*n+i._data[0]*s),Math.round(this._data[1]*n+i._data[1]*s),Math.round(this._data[2]*n+i._data[2]*s),(this.isNull()?100:this._data[3])*n+i._data[3]*s);if(this._rand&&(r._rand=this._rand.slice(),r.dances=this.dances),i._rand){if(r._rand)for(let t=0;t<4;++t)r._rand[t]=Math.round(r._rand[t]*n+i._rand[t]*s);else r._rand=i._rand.map((t=>Math.round(t*s)));r.dances=r.dances||i.dances}return r}apply(t){const e=Qi(t);if(e.isNull())return this;if(e.a>=100)return e;if(e.a<=0)return this;const i=W(e.a,0,100)/100,s=(1-i)*this.a/100,n=qi(Math.round(this._data[0]*s+e._data[0]*i),Math.round(this._data[1]*s+e._data[1]*i),Math.round(this._data[2]*s+e._data[2]*i),Math.round(this._data[3]*s+e._data[3]*i));if(this._rand&&(n._rand=this._rand.slice(),n.dances=this.dances),e._rand){if(n._rand)for(let t=0;t<4;++t)n._rand[t]=Math.round(n._rand[t]*s+e._rand[t]*i);else n._rand=e._rand.map((t=>Math.round(t*i)));n.dances=n.dances||e.dances}return n}lighten(t){if(this.isNull())return this;if(t<=0)return this;const e=W(t,0,100)/100,i=1-e;return qi(Math.round(this._data[0]*i+100*e),Math.round(this._data[1]*i+100*e),Math.round(this._data[2]*i+100*e),this._a)}darken(t){if(this.isNull())return this;const e=W(t,0,100)/100,i=1-e;return qi(Math.round(this._data[0]*i+0*e),Math.round(this._data[1]*i+0*e),Math.round(this._data[2]*i+0*e),this._a)}bake(t=!1){if(this.isNull())return this;if(!this._rand)return this;if(this.dances&&!t)return this;const e=this._rand,i=Li.number(e[0]),s=Li.number(e[1]),n=Li.number(e[2]),r=Li.number(e[3]);return qi(this._r+i+s,this._g+i+n,this._b+i+r,this._a)}add(t,e=100){const i=Qi(t);if(i.isNull())return this;const s=i.a/100*(e/100);return qi(Math.round(this._data[0]+i._data[0]*s),Math.round(this._data[1]+i._data[1]*s),Math.round(this._data[2]+i._data[2]*s),W(Math.round(this._a+100*s),0,100))}scale(t){if(this.isNull()||100==t)return this;const e=Math.max(0,t)/100;return qi(Math.round(this._data[0]*e),Math.round(this._data[1]*e),Math.round(this._data[2]*e),this._a)}multiply(t){if(this.isNull())return this;let e;if(Array.isArray(t)){if(t.length<3)throw new Error("requires at least r,g,b values.");e=t}else{if(t.isNull())return this;e=t._data}const i=(e[3]||100)/100;return qi(Math.round(this._ra*(e[0]/100)*i),Math.round(this._ga*(e[1]/100)*i),Math.round(this._ba*(e[2]/100)*i),100)}normalize(){if(this.isNull())return this;const t=Math.max(this._ra,this._ga,this._ba);return t<=100?this:qi(Math.round(100*this._ra/t),Math.round(100*this._ga/t),Math.round(100*this._ba/t),100)}inverse(){return new Xi(100-this.r,100-this.g,100-this.b,this.a)}css(t=!0){if(100!==this.a){const e=this.toInt(t);return e<=0?"transparent":"#"+e.toString(16).padStart(4,"0")}const e=this.toInt(t);return e<=0?"transparent":"#"+e.toString(16).padStart(4,"0").substring(0,3)}toString(){return this.name?this.name:this.isNull()?"null color":this.css()}}function Gi(t,e=!1){for(;t.length<3;)t.push(0);if(e)for(let e=0;e<3;++e)t[e]=Math.round(100*(t[e]||0)/255);return new Xi(...t)}function zi(t){if(!t.startsWith("#"))throw new Error('Color CSS strings must be of form "#abc" or "#abcdef" - received: ['+t+"]");const e=Number.parseInt(t.substring(1),16);let i,s,n,r=100;return 4==t.length?(i=Math.round((e>>8)/15*100),s=Math.round(((240&e)>>4)/15*100),n=Math.round((15&e)/15*100)):5==t.length?(i=Math.round((e>>12)/15*100),s=Math.round(((3840&e)>>8)/15*100),n=Math.round(((240&e)>>4)/15*100),r=Math.round((15&e)/15*100)):7===t.length?(i=Math.round((e>>16)/255*100),s=Math.round(((65280&e)>>8)/255*100),n=Math.round((255&e)/255*100)):9===t.length&&(i=Math.round((e>>24)/255*100),s=Math.round(((16711680&e)>>16)/255*100),n=Math.round(((65280&e)>>8)/255*100),r=Math.round((255&e)/255*100)),new Xi(i,s,n,r)}function Ki(t){const e=Ui[t];if(!e)throw new Error("Unknown color name: "+t);return e}function $i(t,e=!1){return t<0?new Xi:e||t>4095?new Xi(Math.round(100*((16711680&t)>>16)/255),Math.round(100*((65280&t)>>8)/255),Math.round(100*(255&t)/255),100):new Xi(Math.round(100*((3840&t)>>8)/15),Math.round(100*((240&t)>>4)/15),Math.round(100*(15&t)/15),100)}function qi(...t){let e=t[0],i=t[1];if(0==t.length)return new Xi;if(t.length>2&&(e=t,i=!1),null==e)return new Xi;if(e instanceof Xi)return e;if("string"==typeof e)return e.startsWith("#")?zi(e):Ki(e);if(Array.isArray(e))return Gi(e,i);if("number"==typeof e)return $i(e,i);throw new Error("Failed to make color - unknown argument: "+JSON.stringify(e))}function Qi(...t){const e=t[0];if(e instanceof Xi)return e;if(void 0===e)return es;if(null===e)return es;if("string"==typeof e){if(!e.startsWith("#"))return Ki(e)}else if(-1===e)return es;return qi(e,t[1])}function Zi(t,e){if(t.isNull()||e.isNull())return[t,e];const i=t.clamp(),s=e.clamp();let n=Math.abs(i.h-s.h);if(n>180&&(n=360-n),n>45)return[i,s];if(Math.abs(i.l-s.l)>=40)return[i,s];const r=[i,s],h=i.s<=s.s?0:1,o=1-h;for(;r[o].l-r[h].l<40;)r[o]=r[o].mix(ss,5),r[h]=r[h].mix(is,5);return r}function Ji(t,...e){let i=e;1==e.length&&(i=e[0]);const s=i instanceof Xi?i:qi(i);return s._const=!0,Ui[t]=s,s.name=t,s}function ts(t,...e){let i;return i=1==e.length?Ji(t,e[0]):Ji(t,...e),Ji("light_"+t,i.lighten(25)),Ji("lighter_"+t,i.lighten(50)),Ji("lightest_"+t,i.lighten(75)),Ji("dark_"+t,i.darken(25)),Ji("darker_"+t,i.darken(50)),Ji("darkest_"+t,i.darken(75)),i}const es=Ji("NONE",-1),is=Ji("black",0),ss=Ji("white",4095);ts("teal",[30,100,100]),ts("brown",[60,40,0]),ts("tan",[80,70,55]),ts("pink",[100,60,66]),ts("gray",[50,50,50]),ts("yellow",[100,100,0]),ts("purple",[100,0,100]),ts("green",[0,100,0]),ts("orange",[100,50,0]),ts("blue",[0,0,100]),ts("red",[100,0,0]),ts("amber",[100,75,0]),ts("flame",[100,25,0]),ts("fuchsia",[100,0,100]),ts("magenta",[100,0,75]),ts("crimson",[100,0,25]),ts("lime",[75,100,0]),ts("chartreuse",[50,100,0]),ts("sepia",[50,40,25]),ts("violet",[50,0,100]),ts("han",[25,0,100]),ts("cyan",[0,100,100]),ts("turquoise",[0,100,75]),ts("sea",[0,100,50]),ts("sky",[0,75,100]),ts("azure",[0,50,100]),ts("silver",[75,75,75]),ts("gold",[100,85,0]);var ns=Object.freeze({__proto__:null,colors:Ui,Color:Xi,fromArray:Gi,fromCss:zi,fromName:Ki,fromNumber:$i,make:qi,from:Qi,separate:Zi,relativeLuminance:function(t,e){return Math.round(100*((t.r-e.r)*(t.r-e.r)*.2126+(t.g-e.g)*(t.g-e.g)*.7152+(t.b-e.b)*(t.b-e.b)*.0722)/65025)},distance:function(t,e){return Math.round(100*((t.r-e.r)*(t.r-e.r)*.3333+(t.g-e.g)*(t.g-e.g)*.3333+(t.b-e.b)*(t.b-e.b)*.3333)/65025)},smoothScalar:function(t,e=255){return Math.floor(100*Math.sin(Math.PI*t/e))},install:Ji,installSpread:ts,NONE:es,BLACK:is,WHITE:ss});class rs{constructor(t={}){this.ch=V(t.ch,null),this.fg=qi(t.fg),this.bg=qi(t.bg)}_changed(){return this}copy(t){return this.ch=t.ch||null,this.fg=Qi(t.fg),this.bg=Qi(t.bg),this._changed()}fill(t,e,i){return null!==t&&(this.ch=t),null!==e&&(this.fg=Qi(e)),null!==i&&(this.bg=Qi(i)),this._changed()}clone(){const t=new rs;return t.copy(this),t}equals(t){return this.ch==t.ch&&this.fg.equals(t.fg)&&this.bg.equals(t.bg)}get dances(){return this.fg.dances||this.bg.dances}nullify(){return this.ch=null,this.fg=es,this.bg=es,this._changed()}blackOut(){return this.ch=null,this.fg=is,this.bg=is,this._changed()}draw(t=null,e=null,i=null){return null!==t&&(this.ch=t),null!==e&&(e=Qi(e),this.fg=this.fg.blend(e)),null!==i&&(i=Qi(i),this.bg=this.bg.blend(i)),this._changed()}drawSprite(t){if(t===this)return this;if(t.fg&&-1!==t.fg){const e=Qi(t.fg);t.ch&&e.a&&(this.ch=t.ch),this.fg=this.fg.apply(e)}return t.bg&&-1!==t.bg&&(this.bg=this.bg.apply(t.bg)),this._changed()}invert(){return this.bg=this.bg.inverse(),this.fg=this.fg.inverse(),this._changed()}swap(){return[this.bg,this.fg]=[this.fg,this.bg],this._changed()}multiply(t,e=!0,i=!0){return t=Qi(t),e&&(this.fg=this.fg.multiply(t)),i&&(this.bg=this.bg.multiply(t)),this._changed()}scale(t,e=!0,i=!0){return e&&(this.fg=this.fg.scale(t)),i&&(this.bg=this.bg.scale(t)),this._changed()}mix(t,e=50,i=e){return t=Qi(t),e>0&&(this.fg=this.fg.mix(t,e)),i>0&&(this.bg=this.bg.mix(t,i)),this._changed()}add(t,e=100,i=e){return t=Qi(t),e>0&&(this.fg=this.fg.add(t,e)),i>0&&(this.bg=this.bg.add(t,i)),this._changed()}separate(){return[this.fg,this.bg]=Zi(this.fg,this.bg),this._changed()}bake(t=!1){return this.fg=this.fg.bake(t),this.bg=this.bg.bake(t),this._changed()}toString(){return`{ ch: ${this.ch}, fg: ${this.fg.toString()}, bg: ${this.bg.toString()} }`}}var hs={colorStart:"#{",colorEnd:"}",field:"{{",fieldEnd:"}}",defaultFg:null,defaultBg:null},os={default:(t,e,i)=>0===i.length?t:1===i.length?""+ci(e,i[0]):i.map((t=>ci(e,t))).join(" "),debug:(t,e,i)=>i.length?`{{${t} ${i.join(" ")}}}`:`{{${t}}}`};function as(t){if(!t||0==t.length)return 0;let e=0,i=!1,s=!1;for(let n=0;n<t.length;++n){const r=t.charAt(n);s?"}"===r?(s=!1,i=!1):e+=1:i?" "===r?s=!0:"}"===r&&(i=!1):"#"===r?"{"===t.charAt(n+1)?(i=!0,n+=1):e+=1:"\\"===r?("#"===t.charAt(n+1)&&(n+=1),e+=1):e+=1}return e}function ls(t,e,i=0){let s=!1,n=!1,r=i;for(;r<t.length;){let i=t.charAt(r);if(n){if("}"===i)n=!1,s=!1;else if(e(i,r))return r}else if(s)" "===i?n=!0:"}"===i&&(s=!1);else if("#"===i){if("{"===t.charAt(r+1))s=!0,r+=1;else if(e(i,r))return r}else if("\\"===i){if("#"===t.charAt(r+1)&&(r+=1,i=t.charAt(r)),e(i,r))return r}else if(e(i,r))return r;++r}return-1}function us(t){const e=ls(t,P);return e<0?"":t.charAt(e)}function cs(t,e,i=" "){const s=as(t);if(s>=e)return t;const n=t.length-s;return t.padEnd(e+n,i)}function ds(t){const e=ls(t,(t=>" "!==t));if(e<0)return t;const i=t.charAt(e);return t.substring(0,e)+i.toUpperCase()+t.substring(e+1)}function fs(t){let e="",i=!1,s=!1,n=0;for(;n<t.length;){let r=t.charAt(n);s?"}"===r?(s=!1,i=!1):e+=r:i?" "===r?s=!0:"}"===r&&(i=!1):"#"===r?"{"===t.charAt(n+1)?(i=!0,n+=1):e+=r:"\\"===r?("#"===t.charAt(n+1)&&(e+=r,n+=1,r=t.charAt(n)),e+=r):e+=r,++n}return e}function gs(t,e,i,s=""){const n=t.length;if(e>=n)return t;const r=t.substring(0,e);if(e+i>=n)return r;return r+s+t.substring(e+i)}function ps(t){const e=[];let i=0,s=0,n=!1,r=!1;for(;i<t.length;){const h=t.charAt(i);n?'"'===h&&(e.push(t.substring(s,i)),s=i+1,r=!1,n=!1):r?"'"===h&&(e.push(t.substring(s,i)),s=i+1,r=!1,n=!1):" "===h?(s!==i&&e.push(t.substring(s,i)),s=i+1):'"'===h?(s=i+1,n=!0):"'"===h&&(s=i+1,r=!0),++i}return 0===s?e.push(t):s<i&&e.push(t.substring(s)),e}function _s(t,e={}){const i=e.field||hs.field,s=function(t,e={}){const i=[];let s=!1,n=0,r=!1,h=0;for(;h<t.length;){const e=t.charAt(h);if(s){if("}"===e){if("}"!==t.charAt(h+1))throw new Error("Templates cannot contain }");const e=t.slice(n,h);i.push(e),++h,s=!1,n=h+1}}else if("\\"===e)"{"===t.charAt(h+1)&&(++h,r=!0);else if("{"===e&&"{"===t.charAt(h+1)){for(;"{"===t.charAt(h+1);)++h;s=!0;let e=t.slice(n,h-1);r&&(e=e.replace(/\\\{/g,"{")),i.push(e),n=h+1,r=!1}++h}if(n!==t.length){let e=t.slice(n);r&&(e=e.replace(/\\\{/g,"{")),i.push(e)}return i}(t).map(((t,s)=>s%2==0?ms(t):0==t.length?ms(i):function(t,e={}){let i="";const s=t.indexOf("%");s>0&&(i=t.substring(s),t=t.substring(0,s));const n=ps(t);let r="default";n[0]in os&&(r=n[0],n.shift());const h=os[r];function o(t){return h.call(this,r,t,n)}const a=o.bind({get:ci});if(i.length)return i.endsWith("d")?function(t,e){const i=/%([\+-]*)(\d*)d/.exec(t)||["","","0"];let s=Number.parseInt(i[2]||"0");const n=i[1].includes("+"),r=i[1].includes("-");return function(t){const i=Number.parseInt(e(t)||"0");let h=""+i;return i>0&&n&&(h="+"+h),s&&r?h.padEnd(s):s?h.padStart(s):h}}(i,a):i.endsWith("f")?function(t,e){const i=/%([\+-]*)(\d*)(\.(\d+))?f/.exec(t)||["","","0"];let s=Number.parseInt(i[2]||"0");const n=i[1].includes("+"),r=i[1].includes("-"),h=Number.parseInt(i[4])||0;return function(t){const i=Number.parseFloat(e(t)||"0");let o;return o=h?i.toFixed(h):""+i,i>0&&n&&(o="+"+o),s&&r?o.padEnd(s):s?o.padStart(s):o}}(i,a):function(t,e){const i=/%(-?\d*)s/.exec(t)||[],s=Number.parseInt(i[1]||"0");return function(t){let i=""+e(t);return s<0?i=i.padEnd(-s):s&&(i=i.padStart(s)),i}}(i,a);return a||(()=>"!!!")}(t,e)));return function(t={}){return"string"==typeof t&&(t={value:t}),s.map((e=>e(t))).join("")}}function bs(t,e={}){return _s(t)(e)}function ms(t){return()=>t}function ys(t,e,i={}){if(null==t)return;if(!e)return;if(!(t=""+t).length)return;const s=i.eachColor||N,n=i.fg||hs.defaultFg,r=i.bg||hs.defaultBg,h={fg:n,bg:r};s(h);const o=Object.assign({},h);let a=0,l=!1,u=!1,c=0,d="";for(;c<t.length;){const i=t.charAt(c);if(u)"}"===i?(u=!1,l=!1,Object.assign(h,o),s(h)):(e(i,h.fg,h.bg,a,c),++a);else if(l)if(" "===i){u=!0,Object.assign(o,h);const t=d.split(":");t[0].length&&(h.fg=t[0]),t[1]&&(h.bg=t[1]),s(h),d=""}else if("}"===i){l=!1;const t=d.split(":");t[0].length&&(h.fg=t[0]),t[1]&&(h.bg=t[1]),s(h),d=""}else d+=i;else if("#"===i)"{"===t.charAt(c+1)?"}"===t.charAt(c+2)?(c+=2,h.fg=n,h.bg=r,s(h)):(l=!0,c+=1):(e(i,h.fg,h.bg,a,c),++a);else if("\\"===i){c+=1;e(t.charAt(c),h.fg,h.bg,a,c),++a}else e(i,h.fg,h.bg,a,c),++a;++c}u&&console.warn("Ended text without ending inline color!")}function ws(t,e,i={}){if(e<5)return t;let s=e;i.hyphenate&&(!0===i.hyphenate&&(i.hyphenate=Math.floor(e/2)),s=W(i.hyphenate,6,e+1)),i.indent=i.indent||0;const n=" ".repeat(i.indent);let r="",h=null,o=null,a=e;return e-=i.indent,function(t,e,i={}){let s="",n="",r="",h="";ys(t,((t,i,o)=>{i===n&&o===r||(s.length&&(e(s,n,r,h),s="",h=""),n=i,r=o)," "===t?(s.length&&(e(s,n,r,h),s="",h=""),h+=" "):"\n"===t?(s.length&&(e(s,n,r,h),s="",h=""),e("\n",n,r,h),h=""):"-"===t?(s+=t,s.length>3&&(e(s,n,r,h),s="",h="")):s+=t}),i),s&&e(s,n,r,h)}(t,((t,i,l,u)=>{let c=u.length+t.length;if(c>a&&t.length>s){const s=function(t,e,i){let s=0,n=[],r=i||e;for(;s<t.length;){const i=t.length-s;if(r>=i)return n.push(t.substring(s)),n;if(r<4&&(r=e,n.push("")),i<r+e)return n.push(t.substring(s,s+r-1)),n.push(t.substring(s+r-1)),n;const h=Math.min(r-1,Math.floor(i/2)),o=t.substring(s,s+h);n.push(o),s+=h,r=e}return n}(t,e,a-u.length);for(0===s[0].length?(r+="\n",(i||l)&&(r+=`#{${i||""}${l?":"+l:""}}`),a=e,s.shift()):(r+=u,a-=u.length);s.length>1;)r+=s.shift()+"-\n",(i||l)&&(r+=`#{${i||""}${l?":"+l:""}}`),r+=n;return r+=s[0],void(a=e-s[0].length-n.length)}if("\n"===t||c>a){if(r+="\n",(i||l)&&(h="INVALID",o="INVALID"),a=e,r+=n,a-=n.length,"\n"===t)return;u=""}u.length&&(r+=u,a-=u.length),i===h&&l===o||(h=i,o=l,r+=`#{${i||""}${l?":"+l:""}}`),a-=t.length,r+=t})),r}function vs(t,e=200,i={}){if("string"!=typeof t)return[];return ws(t=t.trimEnd(),e,i).split("\n")}const xs=/\[(\w+)(?:\|(\w+))?\]/,Es=/\|(\w+)\|(\w+)\|/;function Is(t){if((t=t.replace("& ","")).includes("~"))return t.replace("~","");let e=xs.exec(t);return e?t.replace(e[0],e[2]||""):(e=Es.exec(t),e?e[1]:t)}function As(t){if((t=t.replace("& ","")).includes("~"))return t.replace("~","s");let e=xs.exec(t);return e?t.replace(e[0],e[1]):(e=Es.exec(t),e?e[2]:t)}var Ss=Object.freeze({__proto__:null,configure:function(t={}){void 0!==t.fg&&(hs.defaultFg=t.fg),void 0!==t.bg&&(hs.defaultBg=t.bg),t.colorStart&&(hs.colorStart=t.colorStart),t.colorEnd&&(hs.colorEnd=t.colorEnd),t.field&&(hs.field=t.field)},compile:_s,apply:bs,eachChar:ys,wordWrap:ws,splitIntoLines:vs,addHelper:function(t,e){os[t]=e},options:hs,length:as,advanceChars:function(t,e,i){let s=0,n=!1,r=!1,h=e||0;for(;s<i;){const e=t.charAt(h);r?"}"===e?(r=!1,n=!1):s+=1:n?" "===e?r=!0:"}"===e&&(n=!1):"#"===e?"{"===t.charAt(h+1)?(n=!0,h+=1):s+=1:"\\"===e?("#"===t.charAt(h+1)&&(h+=1),s+=1):s+=1,++h}return h},findChar:ls,firstChar:us,startsWith:function(t,e){if("string"==typeof e&&1===e.length)return us(t)===e;const i=fs(t);return"string"==typeof e?i.startsWith(e):null!==e.exec(i)},padStart:function(t,e,i=" "){const s=as(t);if(s>=e)return t;const n=t.length-s;return t.padStart(e+n,i)},padEnd:cs,center:function(t,e,i=" "){const s=t.length,n=e-as(t);if(n<=0)return t;const r=Math.floor(n/2);return t.padStart(s+r,i).padEnd(s+n,i)},truncate:function(t,e){let i=0,s=!1,n=!1,r=0,h=0;for(;i<e;){const e=t.charAt(r);n?"}"===e?(n=!1,s=!1,h-=1):i+=1:s?" "===e?n=!0:"}"===e&&(s=!1):"#"===e?"{"===t.charAt(r+1)?"}"===t.charAt(r+2)?(r+=2,h=0):(s=!0,r+=1,h+=1):i+=1:"\\"===e?("#"===t.charAt(r+1)&&(r+=1),i+=1):i+=1,++r}return n?t.substring(0,r)+"}"+(h>1?"#{}":""):t.substring(0,r)+(h?"#{}":"")},capitalize:ds,title_case:function(t){let e=ls(t,(t=>" "!==t));for(;e>=0;){const i=t.charAt(e);let s=ls(t=t.substring(0,e)+i.toUpperCase()+t.substring(e+1),(t=>" "===t),e+1);e=ls(t,(t=>" "!==t),s)}return t},removeColors:fs,spliceRaw:gs,hash:function(t){let e=0;const i=t.length;for(let s=0;s<i;s++)e=(e<<5)-e+t.charCodeAt(s),e|=0;return e},splitArgs:ps,toSingularVerb:function(t){if(t.includes("~"))return t.replace("~","s");let e=xs.exec(t);return e?t.replace(e[0],e[1]):(e=Es.exec(t),e?e[1]:t)},toPluralVerb:function(t){if(t.includes("~"))return t.replace("~","");let e=xs.exec(t);return e?t.replace(e[0],e[2]||""):(e=Es.exec(t),e?e[2]:t)},toSingularNoun:Is,toPluralNoun:As,toQuantity:function(t,e){const i=e>1?""+e:"a";return(t=1==e?Is(t):As(t)).includes("&")?t.replace("&",i):i+" "+t}});class Ts{constructor(t,e){this._clip=null,"number"!=typeof t&&(e=t.height,t=t.width),this._width=t,this._height=e}get width(){return this._width}get height(){return this._height}hasXY(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}drawSprite(t,e,i){const s=i.ch,n=i.fg,r=i.bg;return this.draw(t,e,s,n,r)}blackOut(...t){return 0==t.length?this.fill(" ",0,0):this.draw(t[0],t[1]," ",0,0)}fill(t=" ",e=4095,i=0){return 1==arguments.length&&(i=Qi(t),t=null,e=i),this.fillRect(0,0,this.width,this.height,t,e,i)}drawText(t,e,i,s=4095,n=null,r=0,h="left"){if("number"!=typeof s&&(s=Qi(s)),"number"!=typeof n&&(n=Qi(n)),r=Math.min(r||this.width,this.width-t),"right"==h){const e=as(i);t+=r-e}else if("center"==h){const e=as(i);t+=Math.floor((r-e)/2)}return ys(i,((i,s,n,h)=>{t+h>=this.width||h>=r||this.draw(h+t,e,i,s,n)}),{fg:s,bg:n}),1}wrapText(t,e,i,s,n=4095,r=null,h=0){n=Qi(n),r=Qi(r),s=ws(s,i=Math.min(i,this.width-t),{indent:h});let o=0,a=t;for(ys(s,((s,n,r)=>{if("\n"==s){for(;a<t+i;)this.draw(a++,e+o," ",0,r);return++o,void(a=t+h)}this.draw(a++,e+o,s,n,r)}),{fg:n,bg:r});a<t+i;)this.draw(a++,e+o," ",0,r);return o+1}fillBounds(t,e=null,i=null,s=null){return this.fillRect(t.x,t.y,t.width,t.height,e,i,s)}fillRect(t,e,i,s,n=null,r=null,h=null){r=null!==r?Qi(r):null,h=null!==h?Qi(h):null;const o=Math.min(t+i,this.width),a=Math.min(e+s,this.height);for(let i=t;i<o;++i)for(let t=e;t<a;++t)this.set(i,t,n,r,h);return this}blackOutBounds(t,e=0){return this.blackOutRect(t.x,t.y,t.width,t.height,e)}blackOutRect(t,e,i,s,n="black"){return n=Qi(n),this.fillRect(t,e,i,s," ",n,n)}highlight(t,e,i,s){if(!this.hasXY(t,e))return this;i=Qi(i);const n=new rs,r=this.get(t,e);return n.drawSprite(r),n.fg=n.fg.add(i,s),n.bg=n.bg.add(i,s),this.drawSprite(t,e,n),this}mix(t,e,i=0,s=0,n=0,r=0){if((t=Qi(t)).isNull())return this;const h=new rs;n||(n=i?1:this.width),r||(r=s?1:this.height);const o=Math.min(n+i,this.width),a=Math.min(r+s,this.height);for(let n=i;n<o;++n)for(let i=s;i<a;++i){const s=this.get(n,i);h.drawSprite(s),h.fg=h.fg.mix(t,e),h.bg=h.bg.mix(t,e),this.drawSprite(n,i,h)}return this}blend(t,e=0,i=0,s=0,n=0){if((t=Qi(t)).isNull())return this;const r=new rs;s||(s=e?1:this.width),n||(n=i?1:this.height);const h=Math.min(s+e,this.width),o=Math.min(n+i,this.height);for(let s=e;s<h;++s)for(let e=i;e<o;++e){const i=this.get(s,e);r.drawSprite(i),r.fg=r.fg.blend(t),r.bg=r.bg.blend(t),this.drawSprite(s,e,r)}return this}setClip(...t){return 1==t.length?(this._clip=t[0].clone(),this):(this._clip=new et(t[0],t[1],t[2],t[3]),this)}clearClip(){return this._clip=null,this}}class Cs extends Ts{constructor(...t){super(t[0],t[1]),this.changed=!1,this._data=[],this.resize(this._width,this._height)}clone(){const t=new this.constructor(this._width,this._height);return t.copy(this),t}resize(t,e){if(this._data.length!==t*e){for(this._width=t,this._height=e;this._data.length<t*e;)this._data.push(new rs);this._data.length=t*e,this.changed=!0}}_index(t,e){return e*this.width+t}get(t,e){if(!this.hasXY(t,e))throw new Error(`Invalid loc - ${t},${e}`);let i=e*this.width+t;return this._data[i]}set(t,e,i=null,s=null,n=null){if(this._clip&&!this._clip.contains(t,e))return this;return this.get(t,e).fill(i,s,n),this}info(t,e){if(!this.hasXY(t,e))throw new Error(`Invalid loc - ${t},${e}`);let i=e*this.width+t;const s=this._data[i];return{ch:s.ch,fg:s.fg.toInt(),bg:s.bg.toInt()}}copy(t){return this._data.forEach(((e,i)=>{e.copy(t._data[i])})),this.changed=!0,this._clip=t._clip?t._clip.clone():null,this}apply(t){return this._clip?(this._clip.forEach(((e,i)=>{const s=this.get(e,i),n=t.get(e,i);s.drawSprite(n)})),this):(this._data.forEach(((e,i)=>{e.drawSprite(t._data[i])})),this.changed=!0,this)}draw(t,e,i=null,s=null,n=null){if(this._clip&&!this._clip.contains(t,e))return this;let r=e*this.width+t;return this._data[r].draw(i,s,n),this.changed=!0,this}nullify(...t){if(0==t.length)this._clip?this._clip.forEach(((t,e)=>{this.nullify(t,e)})):this._data.forEach((t=>t.nullify()));else{if(this._clip&&!this._clip.contains(t[0],t[1]))return this;this.get(t[0],t[1]).nullify()}}dump(){const t=[];let e="    ";for(let t=0;t<this.width;++t)t%10==0&&(e+=" "),e+=t%10;t.push(e),t.push("");for(let e=0;e<this.height;++e){let i=`${(""+e).padStart(2)}] `;for(let t=0;t<this.width;++t){t%10==0&&(i+=" ");let s=this.get(t,e).ch;null===s&&(s=" "),i+=s}t.push(i)}console.log(t.join("\n"))}}var Ms=Object.freeze({__proto__:null,BufferBase:Ts,Buffer:Cs,make:function(...t){return new Cs(t[0],t[1])}});const Ls=Vi(["VISIBLE","WAS_VISIBLE","CLAIRVOYANT_VISIBLE","WAS_CLAIRVOYANT_VISIBLE","TELEPATHIC_VISIBLE","WAS_TELEPATHIC_VISIBLE","ITEM_DETECTED","WAS_ITEM_DETECTED","ACTOR_DETECTED","WAS_ACTOR_DETECTED","REVEALED","MAGIC_MAPPED","IN_FOV","WAS_IN_FOV","ALWAYS_VISIBLE","IS_CURSOR","IS_HIGHLIGHTED","ANY_KIND_OF_VISIBLE = VISIBLE | CLAIRVOYANT_VISIBLE | TELEPATHIC_VISIBLE","IS_WAS_ANY_KIND_OF_VISIBLE = VISIBLE | WAS_VISIBLE |CLAIRVOYANT_VISIBLE | WAS_CLAIRVOYANT_VISIBLE |TELEPATHIC_VISIBLE |WAS_TELEPATHIC_VISIBLE","WAS_ANY_KIND_OF_VISIBLE = WAS_VISIBLE | WAS_CLAIRVOYANT_VISIBLE | WAS_TELEPATHIC_VISIBLE","WAS_DETECTED = WAS_ITEM_DETECTED | WAS_ACTOR_DETECTED","IS_DETECTED = ITEM_DETECTED | ACTOR_DETECTED","PLAYER = IN_FOV","CLAIRVOYANT = CLAIRVOYANT_VISIBLE","TELEPATHIC = TELEPATHIC_VISIBLE","VIEWPORT_TYPES = PLAYER | VISIBLE |CLAIRVOYANT |TELEPATHIC |ITEM_DETECTED |ACTOR_DETECTED"]);class ks{constructor(t){this._setVisible=null,this._startX=-1,this._startY=-1,this._maxRadius=100,this._isBlocked=t.isBlocked,this._calcRadius=t.calcRadius||ot,this._hasXY=t.hasXY||P,this._debug=t.debug||N}calculate(t,e,i,s){this._setVisible=s,this._setVisible(t,e,1),this._startX=t,this._startY=e,this._maxRadius=i+1;for(let t=4;t<8;++t){const e=$[t];this._castLight(1,1,0,0,e[0],e[1],0),this._castLight(1,1,0,e[0],0,0,e[1])}}_castLight(t,e,i,s,n,r,h){if(t>=this._maxRadius)return void this._debug("CAST: row=%d, start=%d, end=%d, row >= maxRadius => cancel",t,e.toFixed(2),i.toFixed(2));if(e<i)return void this._debug("CAST: row=%d, start=%d, end=%d, start < end => cancel",t,e.toFixed(2),i.toFixed(2));this._debug("CAST: row=%d, start=%d, end=%d, x=%d,%d, y=%d,%d",t,e.toFixed(2),i.toFixed(2),s,n,r,h);let o,a,l,u,c,d=e,f=!1,g=-t,p=0;for(let _=-t;_<=0;_++){if(o=Math.floor(this._startX+_*s+g*n),a=Math.floor(this._startY+_*r+g*h),l=(_-.5)/(g+.5),u=(_+.5)/(g-.5),c=_/(g+.5),p=(_+.5)/g,!this._hasXY(o,a)){f=!0;continue}if(this._debug("- test %d,%d ... start=%d, min=%d, max=%d, end=%d, dx=%d, dy=%d",o,a,e.toFixed(2),c.toFixed(2),p.toFixed(2),i.toFixed(2),_,g),e<p){f=this._isBlocked(o,a);continue}if(i>c)break;const b=this._calcRadius(_,g);if(b<this._maxRadius){const t=1-b/this._maxRadius;this._setVisible(o,a,t),this._debug("       - visible")}if(f){if(this._isBlocked(o,a)){this._debug("       - blocked ... nextStart: %d",u.toFixed(2)),d=u;continue}f=!1}else this._isBlocked(o,a)&&t<this._maxRadius&&(this._debug("       - blocked ... start:%d, end:%d, nextStart: %d",d.toFixed(2),l.toFixed(2),u.toFixed(2)),f=!0,this._castLight(t+1,d,l,s,n,r,h),d=u)}f||this._castLight(t+1,d,i,s,n,r,h)}}var Rs=Object.freeze({__proto__:null,FovFlags:Ls,FOV:ks,calculate:function(t,e,i,s,n){t.fill(0),new ks({isBlocked:e,hasXY:t.hasXY.bind(t)}).calculate(i,s,n,((e,i,s)=>{t.set(e,i,s)}))},FovSystem:class{constructor(t,e={}){this.changed=!0,this._callback=N,this.follow=null,this.site=t;let i=0;const s=e.visible||e.alwaysVisible;(e.revealed||s&&!1!==e.revealed)&&(i|=Ls.REVEALED),s&&(i|=Ls.VISIBLE),this.flags=Ei(t.width,t.height,i),e.callback&&(this.callback=e.callback),this.fov=new ks({isBlocked:(t,e)=>this.site.blocksVision(t,e),hasXY:(t,e)=>t>=0&&e>=0&&t<this.site.width&&e<this.site.height}),e.alwaysVisible&&this.makeAlwaysVisible(),(e.visible||e.alwaysVisible)&&dt(t.width,t.height,((t,e)=>this._callback(t,e,!0)))}get callback(){return this._callback}set callback(t){this._callback=t?"function"==typeof t?t:t.onFovChange.bind(t):N}getFlag(t,e){return this.flags[t][e]}isVisible(t,e){return!!((this.flags.get(t,e)||0)&Ls.VISIBLE)}isAnyKindOfVisible(t,e){return!!((this.flags.get(t,e)||0)&Ls.ANY_KIND_OF_VISIBLE)}isClairvoyantVisible(t,e){return!!((this.flags.get(t,e)||0)&Ls.CLAIRVOYANT_VISIBLE)}isTelepathicVisible(t,e){return!!((this.flags.get(t,e)||0)&Ls.TELEPATHIC_VISIBLE)}isInFov(t,e){return!!((this.flags.get(t,e)||0)&Ls.IN_FOV)}isDirectlyVisible(t,e){const i=Ls.VISIBLE|Ls.IN_FOV;return((this.flags.get(t,e)||0)&i)===i}isActorDetected(t,e){return!!((this.flags.get(t,e)||0)&Ls.ACTOR_DETECTED)}isItemDetected(t,e){return!!((this.flags.get(t,e)||0)&Ls.ITEM_DETECTED)}isMagicMapped(t,e){return!!((this.flags.get(t,e)||0)&Ls.MAGIC_MAPPED)}isRevealed(t,e){return!!((this.flags.get(t,e)||0)&Ls.REVEALED)}fovChanged(t,e){const i=this.flags.get(t,e)||0;return!!(i&Ls.ANY_KIND_OF_VISIBLE)!==!!(i&Ls.WAS_ANY_KIND_OF_VISIBLE)}wasAnyKindOfVisible(t,e){return!!((this.flags.get(t,e)||0)&Ls.WAS_ANY_KIND_OF_VISIBLE)}makeAlwaysVisible(){this.changed=!0,this.flags.forEach(((t,e,i)=>{this.flags[e][i]|=Ls.ALWAYS_VISIBLE|Ls.REVEALED|Ls.VISIBLE,this.callback(e,i,!0)}))}makeCellAlwaysVisible(t,e){this.changed=!0,this.flags[t][e]|=Ls.ALWAYS_VISIBLE|Ls.REVEALED|Ls.VISIBLE,this.callback(t,e,!0)}revealAll(t=!0){const e=Ls.REVEALED|(t?Ls.VISIBLE:0);this.flags.update((t=>t|e)),this.flags.forEach(((t,e,i)=>{this.callback(e,i,!!(t&Ls.VISIBLE))})),this.changed=!0}revealCell(t,e,i=0,s=!0){const n=Ls.REVEALED|(s?Ls.VISIBLE:0);this.fov.calculate(t,e,i,((t,e)=>{this.flags[t][e]|=n,this.callback(t,e,!!(n&Ls.VISIBLE))})),this.changed=!0}hideCell(t,e){this.flags[t][e]&=~(Ls.MAGIC_MAPPED|Ls.REVEALED|Ls.ALWAYS_VISIBLE),this.flags[t][e]=this.demoteCellVisibility(this.flags[t][e]),this.callback(t,e,!1),this.changed=!0}magicMapCell(t,e){this.flags[t][e]|=Ls.MAGIC_MAPPED,this.changed=!0,this.callback(t,e,!0)}reset(){this.flags.fill(0),this.changed=!0,this.flags.forEach(((t,e,i)=>{this.callback(e,i,!1)}))}setCursor(t,e,i=!1){i||this.flags.update((t=>t&~Ls.IS_CURSOR)),this.flags[t][e]|=Ls.IS_CURSOR,this.changed=!0}clearCursor(t,e){void 0===t||void 0===e?this.flags.update((t=>t&~Ls.IS_CURSOR)):this.flags[t][e]&=~Ls.IS_CURSOR,this.changed=!0}isCursor(t,e){return!!(this.flags[t][e]&Ls.IS_CURSOR)}setHighlight(t,e,i=!1){i||this.flags.update((t=>t&~Ls.IS_HIGHLIGHTED)),this.flags[t][e]|=Ls.IS_HIGHLIGHTED,this.changed=!0}clearHighlight(t,e){void 0===t||void 0===e?this.flags.update((t=>t&~Ls.IS_HIGHLIGHTED)):this.flags[t][e]&=~Ls.IS_HIGHLIGHTED,this.changed=!0}isHighlight(t,e){return!!(this.flags[t][e]&Ls.IS_HIGHLIGHTED)}demoteCellVisibility(t){return(t&=~(Ls.WAS_ANY_KIND_OF_VISIBLE|Ls.WAS_IN_FOV|Ls.WAS_DETECTED))&Ls.IN_FOV&&(t&=~Ls.IN_FOV,t|=Ls.WAS_IN_FOV),t&Ls.VISIBLE&&(t&=~Ls.VISIBLE,t|=Ls.WAS_VISIBLE),t&Ls.CLAIRVOYANT_VISIBLE&&(t&=~Ls.CLAIRVOYANT_VISIBLE,t|=Ls.WAS_CLAIRVOYANT_VISIBLE),t&Ls.TELEPATHIC_VISIBLE&&(t&=~Ls.TELEPATHIC_VISIBLE,t|=Ls.WAS_TELEPATHIC_VISIBLE),t&Ls.ALWAYS_VISIBLE&&(t|=Ls.VISIBLE),t&Ls.ITEM_DETECTED&&(t&=~Ls.ITEM_DETECTED,t|=Ls.WAS_ITEM_DETECTED),t&Ls.ACTOR_DETECTED&&(t&=~Ls.ACTOR_DETECTED,t|=Ls.WAS_ACTOR_DETECTED),t}updateCellVisibility(t,e,i){const s=!!(t&Ls.ANY_KIND_OF_VISIBLE),n=!!(t&Ls.WAS_ANY_KIND_OF_VISIBLE);return s&&n||(s&&!n?(this.flags[e][i]|=Ls.REVEALED,this._callback(e,i,s),this.changed=!0):!s&&n&&(this._callback(e,i,s),this.changed=!0)),s}updateCellDetect(t,e,i){const s=!!(t&Ls.IS_DETECTED),n=!!(t&Ls.WAS_DETECTED);return s&&n||(!s&&n||!n&&s)&&(this._callback(e,i,s),this.changed=!0),s}promoteCellVisibility(t,e,i){t&Ls.IN_FOV&&this.site.hasVisibleLight(e,i)&&(t=this.flags[e][i]|=Ls.VISIBLE),this.updateCellVisibility(t,e,i)||this.updateCellDetect(t,e,i)}updateFor(t){return this.update(t.x,t.y,t.visionDistance)}update(t,e,i){return void 0===t&&this.follow?this.updateFor(this.follow):(void 0===i&&(i=this.site.width+this.site.height),this.changed=!1,this.flags.update(this.demoteCellVisibility.bind(this)),this.site.eachViewport(((t,e,i,s)=>{let n=s&Ls.VIEWPORT_TYPES;n||(n=Ls.VISIBLE),0!=i?this.fov.calculate(t,e,i,((t,e,i)=>{i&&(this.flags[t][e]|=n)})):this.flags[t][e]|=n})),void 0!==t&&void 0!==e&&this.fov.calculate(t,e,i,((t,e,i)=>{i&&(this.flags[t][e]|=Ls.PLAYER)})),this.flags.forEach(this.promoteCellVisibility.bind(this)),this.changed)}}});const Os=$,Ds=1e4,Ns=2e4,Ps=3e4;function Fs(t,e,i=3e4){return{x:t,y:e,distance:i,next:null,prev:null}}class Bs{constructor(t,e){this._data=[],this._todo=Fs(-1,-1),this._width=0,this._height=0,void 0!==t&&void 0!==e&&this.reset(t,e)}get width(){return this._width}get height(){return this._height}copy(t){this.reset(t.width,t.height);const e=t.width*t.height;for(let i=0;i<e;++i)this._data[i].distance=t._data[i].distance}hasXY(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height}reset(t,e,i=3e4){for(this._width=t,this._height=e;this._data.length<t*e;)this._data.push(Fs(-1,-1));for(let t=0;t<this._height;++t)for(let e=0;e<this._width;++e){const s=this._get(e,t);s.x=e,s.y=t,s.distance=i,s.next=s.prev=null}this._todo.next=this._todo.prev=null}_get(...t){if(1==t.length){const e=J(t[0]),i=tt(t[0]);return this._data[e+i*this._width]}return this._data[t[0]+t[1]*this._width]}setGoal(...t){"number"==typeof t[0]?this._add(t[0],t[1],t[2]||0,0):this._add(J(t[0]),tt(t[0]),t[1]||0,0)}setDistance(t,e,i){this._add(t,e,0,i)}_add(t,e,i,s){if(!this.hasXY(t,e))return!1;const n=this._get(t,e);return!(Math.floor(100*n.distance)<=Math.floor(100*(s+i)))&&(n.prev&&(n.prev.next=n.next,n.next&&(n.next.prev=n.prev)),n.prev=n.next=null,s>=Ns?(n.distance=Ns,!1):s>=Ds?(n.distance=Ds,!1):(n.distance=i+s,this._insert(n)))}_insert(t){let e=this._todo,i=e.next;for(;i&&i.distance<t.distance;)e=i,i=e.next;return e.next=t,t.prev=e,t.next=i,i&&(i.prev=t),!0}calculate(t,e=!1){let i=this._todo.next;for(;i;){let s=i.next;i.prev=i.next=null,this._todo.next=s,s&&(s.prev=this._todo),nt(i.x,i.y,((e,s,n)=>{let r=1;if(st(n)&&(r=1.4,t(e,i.y)>=Ns||t(i.x,s)>=Ns))return;const h=t(e,s)*r;this._add(e,s,i.distance,h)}),e),i=this._todo.next}}rescan(t,e=!1){this._data.forEach((t=>{t.next=t.prev=null,t.distance<Ds&&this._insert(t)})),this.calculate(t,e)}getDistance(t,e){return this.hasXY(t,e)?this._get(t,e).distance:Ps}addObstacle(t,e,i,s,n=s){const r=[[t,e]],h=[[t,e]];for(;h.length;){const o=h.shift(),a=rt(t,e,o[0],o[1]);if(a>s)continue;const l=n*((s-a)/s);this._get(o).distance+=l,nt(o[0],o[1],((t,e)=>{const s=i(t,e);r.findIndex((i=>i[0]===t&&i[1]===e))>=0||s>=Ds||(r.push([t,e]),h.push([t,e]))}))}}nextDir(t,e,i,s=!1){let n,r,h,o;h=0;let a=-1;if(!this.hasXY(t,e))throw new Error("Invalid index.");const l=this._get(t,e).distance;for(o=0;o<(s?4:8);++o){const s=Os[o];if(n=t+s[0],r=e+s[1],!this.hasXY(n,r))continue;if(st(s)&&(this._get(n,e).distance>=Ns||this._get(t,r).distance>=Ns))continue;const u=this._get(n,r).distance;if(u<l){const t=l-u;t>h&&(0===u||!i(n,r))&&(a=o,h=t)}}return Os[a]||null}getPath(t,e,i,s=!1){const n=[];return this.forPath(t,e,i,((t,e)=>{n.push([t,e])}),s),n.length?n:null}forPath(t,e,i,s,n=!1){let r,h=t,o=e,a=this._get(h,o).distance||0,l=0;if(0===a)return s(h,o),l;if(a>=Ds){const t=_t(h,o,(t=>t<Ds));if(!t||0===t.length)return 0;const e=t.reduce(((t,e)=>{const i=this._get(t),s=this._get(e);return i.distance<=s.distance?t:e}));h=e[0],o=e[1],s(h,o),++l}do{r=this.nextDir(h,o,i,n),r&&(s(h,o),++l,h+=r[0],o+=r[1])}while(r);return s(h,o),l}update(t){for(let e=0;e<this._height;++e)for(let i=0;i<this._width;++i){const s=this._get(i,e);s.distance=t(s.distance,s.x,s.y)}}add(t){if(this._width!==t._width||this._height!==t._height)throw new Error("Not same size!");for(let e=0;e<this._width*this._height;++e)this._data[e].distance+=t._data[e].distance}forEach(t){for(let e=0;e<this._height;++e)for(let i=0;i<this._width;++i){const s=this._get(i,e);t(s.distance,s.x,s.y)}}dump(t,e=console.log){this.dumpRect(0,0,this.width,this.height,t,e)}dumpRect(t,e,i,s,n,r=console.log){n=n||Ws;return ft(t,e,i,s,((t,e)=>n(this.getDistance(t,e))),r)}dumpAround(t,e,i,s,n=console.log){this.dumpRect(t-i,e-i,2*i,2*i,s,n)}_dumpTodo(){let t=this._todo.next;const e=[];for(;t;)e.push(`${t.x},${t.y}=${t.distance.toFixed(2)}`),t=t.next;return e}}function Ws(t){return t<Ds?t.toFixed(1).padStart(3," ")+" ":t>=Ns?" ## ":t>=Ds?" XX ":" >> "}const js=[];class Vs{constructor(t,e=F){this._todo=[],this._done=[],this.goal=Z(t),this.costFn=e}_add(t,e=1,i=null){const s=ht(t,this.goal);let n={x:J(t),y:tt(t),prev:i,g:i?i.g+e:0,h:s};const r=n.g+n.h,h=this._todo.findIndex((t=>it(t,n)));if(h>-1){const t=this._todo[h];if(t.g+t.h<=r)return;this._todo.splice(h,1)}for(let t=0;t<this._todo.length;t++){const e=this._todo[t],i=e.g+e.h;if(r<i||r==i&&s<e.h)return void this._todo.splice(t,0,n)}this._todo.push(n)}from(t,e=!1){this._add(t);let i=null;for(;this._todo.length&&(i=this._todo.shift()||null,i);)if(!(this._done.findIndex((t=>it(t,i)))>-1)){if(this._done.push(i),it(i,this.goal))break;nt(i.x,i.y,((t,e,s)=>{if(this._done.findIndex((i=>i.x===t&&i.y===e))>-1)return;let n=1;if(st(s)&&(n=1.4,this.costFn(i.x,e)===Ns||this.costFn(t,i.y)===Ns))return;const r=this.costFn(t,e)*n;r<0||r>=1e4||this._add([t,e],r,i)}),e)}if(i&&!it(i,this.goal))return[];let s=[];for(;i;)s.push([i.x,i.y]),i=i.prev;return s.reverse(),s}}var Ys=Object.freeze({__proto__:null,OK:1,AVOIDED:10,BLOCKED:Ds,OBSTRUCTION:Ns,NOT_DONE:Ps,DijkstraMap:Bs,computeDistances:function(t,e,i=F,s=!1){const n=new Bs;n.reset(t.width,t.height),n.setGoal(e),n.calculate(i,s),n.forEach(((e,i,s)=>t[i][s]=e))},alloc:function(){let t=js.pop();return t||(t=new Bs),t},free:function(t){js.push(t)},fromTo:function(t,e,i=F,s=!1){return new Vs(e,i).from(t,s)}});var Hs=Object.freeze({__proto__:null,make:function(t){if(void 0===t)return()=>100;if(null===t)return()=>0;if("number"==typeof t)return()=>t;if("function"==typeof t)return t;let e={};if("string"==typeof t){const i=t.split(/[,|]/).map((t=>t.trim()));e={},i.forEach((t=>{let[i,s]=t.split(":");e[i]=Number.parseInt(s)||100}))}else e=t;const i=Object.entries(e).map((([t,e])=>{let i;if("string"==typeof e){const t=Number.parseInt(e);i=()=>t}else i="number"==typeof e?()=>e:e;if(t.includes("-")){let[e,s]=t.split("-").map((t=>t.trim())).map((t=>Number.parseInt(t)));return t=>t>=e&&t<=s?i(t):0}if(t.endsWith("+")){const e=Number.parseInt(t);return t=>t>=e?i(t):0}{const e=Number.parseInt(t);return t=>t===e?i(t):0}}));return 1==i.length?i[0]:t=>i.reduce(((e,i)=>e||i(t)),0)}});var Us=Object.freeze({__proto__:null,Scheduler:class{constructor(){this.next=null,this.time=0,this.cache=null}clear(){for(;this.next;){const t=this.next;this.next=t.next,t.next=this.cache,this.cache=t}}push(t,e=1){let i;if(this.cache?(i=this.cache,this.cache=i.next,i.next=null):i={item:null,time:0,next:null},i.item=t,i.time=this.time+e,this.next){let t=this,e=t.next;for(;e&&e.time<=i.time;)t=e,e=t.next;i.next=t.next,t.next=i}else this.next=i;return i}pop(){const t=this.next;return t?(this.next=t.next,t.next=this.cache,this.cache=t,this.time=Math.max(t.time,this.time),t.item):null}peek(){const t=this.next;return t?t.item:null}remove(t){if(!t||!this.next)return;if(this.next.item===t)return void(this.next=this.next.next);let e=this.next,i=e.next;for(;i&&i.item!==t;)e=i,i=i.next;i&&i.item===t&&(e.next=i.next)}}});class Xs{constructor(t={}){this._tileWidth=12,this._tileHeight=16,this.needsUpdate=!0,this._toGlyph={},this._toChar=[],t.font=t.font||"monospace",this._node=document.createElement("canvas"),this._ctx=this.node.getContext("2d"),this._configure(t)}static fromImage(t){if("string"==typeof t){if(t.startsWith("data:"))throw new Error("Glyph: You must load a data string into an image element and use that.");const e=document.getElementById(t);if(!e)throw new Error("Glyph: Failed to find image element with id:"+t);t=e}const e=new this({tileWidth:t.width/16,tileHeight:t.height/16});return e._ctx.drawImage(t,0,0),e}static fromFont(t){"string"==typeof t&&(t={font:t});const e=new this(t),i=t.basicOnly||t.basic||!1;return(t.init||Gs)(e,i),e}get node(){return this._node}get ctx(){return this._ctx}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get pxWidth(){return this._node.width}get pxHeight(){return this._node.height}forChar(t){return t&&t.length&&this._toGlyph[t]||-1}toChar(t){return this._toChar[t]||" "}_configure(t){this._tileWidth=t.tileWidth||this.tileWidth,this._tileHeight=t.tileHeight||this.tileHeight,this.node.width=16*this.tileWidth,this.node.height=16*this.tileHeight,this._ctx.fillStyle="black",this._ctx.fillRect(0,0,this.pxWidth,this.pxHeight);const e=t.fontSize||t.size||Math.min(this.tileWidth,this.tileHeight);this._ctx.font=e+"px "+t.font,this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="white"}draw(t,e){if(t>=256)throw new Error("Cannot draw more than 256 glyphs.");const i=t%16*this.tileWidth,s=Math.floor(t/16)*this.tileHeight,n=i+Math.floor(this.tileWidth/2),r=s+Math.floor(this.tileHeight/2);this._ctx.save(),this._ctx.beginPath(),this._ctx.rect(i,s,this.tileWidth,this.tileHeight),this._ctx.clip(),this._ctx.fillStyle="black",this._ctx.fillRect(i,s,this.tileWidth,this.tileHeight),this._ctx.fillStyle="white","function"==typeof e?e(this._ctx,i,s,this.tileWidth,this.tileHeight):(void 0===this._toGlyph[e]&&(this._toGlyph[e]=t),this._toChar[t]=e,this._ctx.fillText(e,n,r)),this._ctx.restore(),this.needsUpdate=!0}}function Gs(t,e=!1){for(let e=32;e<127;++e)t.draw(e,String.fromCharCode(e));[" ","☺","☻","♥","♦","♣","♠","☼","☀","☆","★","‣","∙","⁃","•","☰","☷","☐","☑","☒","⚬","⦿","↑","→","↓","←","↔","↕","▲","▶","▼","◀"].forEach(((e,i)=>{t.draw(i,e)})),e||["⌂","Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","¢","£","¥","₧","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","⌐","¬","½","¼","¡","«","»","░","▒","▓","│","┤","╡","╢","╖","╕","╣","║","╗","╝","╜","╛","┐","└","┴","┬","├","─","┼","╞","╟","╚","╔","╩","╦","╠","═","╬","╧","╨","╤","╥","╙","╘","╒","╓","╫","╪","┘","┌","█","▄","▌","▐","▀","α","ß","Γ","π","Σ","σ","µ","τ","Φ","Θ","Ω","δ","∞","φ","ε","∩","≡","±","≥","≤","⌠","⌡","÷","≈","°","∙","·","√","ⁿ","²","■"," "].forEach(((e,i)=>{t.draw(i+127,e)}))}const zs="\n#version 300 es\n\nin vec2 position;\nin uvec2 offset;\nin uint fg;\nin uint bg;\nin uint glyph;\n\nout vec2 fsOffset;\nout vec4 fgRgb;\nout vec4 bgRgb;\nflat out uvec2 fontPos;\n\nuniform int depth;\n\nvoid main() {\n\tfloat fdepth = float(depth) / 255.0;\n\tgl_Position = vec4(position, fdepth, 1.0);\n\n\tfloat fgr = float((fg & uint(0xF000)) >> 12);\n\tfloat fgg = float((fg & uint(0x0F00)) >> 8);\n\tfloat fgb = float((fg & uint(0x00F0)) >> 4);\n\tfloat fga = float((fg & uint(0x000F)) >> 0);\n\tfgRgb = vec4(fgr, fgg, fgb, fga) / 15.0;\n  \n\tfloat bgr = float((bg & uint(0xF000)) >> 12);\n\tfloat bgg = float((bg & uint(0x0F00)) >> 8);\n\tfloat bgb = float((bg & uint(0x00F0)) >> 4);\n\tfloat bga = float((bg & uint(0x000F)) >> 0);\n\tbgRgb = vec4(bgr, bgg, bgb, bga) / 15.0;\n\n\tuint glyphX = (glyph & uint(0xF));\n\tuint glyphY = (glyph >> 4);\n\tfontPos = uvec2(glyphX, glyphY);\n\n\tfsOffset = vec2(offset);\n}".trim(),Ks="\n#version 300 es\nprecision highp float;\n\nin vec2 fsOffset;\nin vec4 fgRgb;\nin vec4 bgRgb;\nflat in uvec2 fontPos;\n\nout vec4 fragColor;\n\nuniform sampler2D font;\nuniform uvec2 tileSize;\n\nvoid main() {\n\tuvec2 fontPx = (tileSize * fontPos) + uvec2(vec2(tileSize) * fsOffset);\n\tvec4 texel = texelFetch(font, ivec2(fontPx), 0).rgba;\n\n\tfragColor = vec4(mix(bgRgb.rgb, fgRgb.rgb, texel.rgb), mix(bgRgb.a, fgRgb.a, texel.r));\n}".trim();class $s{constructor(t,e){this.target=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.key="",this.code="",this.shiftKey=!1,this.ctrlKey=!1,this.altKey=!1,this.metaKey=!1,this.dir=null,this.x=-1,this.y=-1,this.clientX=-1,this.clientY=-1,this.dt=0,this.reset(t,e)}doDefault(){this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}propagate(){this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}reset(t,e){this.type=t,this.target=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shiftKey=!1,this.ctrlKey=!1,this.altKey=!1,this.metaKey=!1,this.key="",this.code="",this.x=-1,this.y=-1,this.dir=null,this.dt=0,this.target=null,e&&Object.assign(this,e)}clone(){return new $s(this.type,this)}dispatch(t){this.type===Qs&&(this.dir&&t.emit("dir",this),this.propagationStopped||t.emit(this.key,this),this.code!==this.key&&(this.propagationStopped||t.emit(this.code,this)),this.defaultPrevented||this.propagationStopped)||t.emit(this.type,this)}}const qs=[],Qs="keypress",Zs="mousemove",Js="click",tn="tick",en="mouseup",sn="stop",nn=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight","Enter","Delete","Backspace","Tab","CapsLock","Escape"];function rn(t){return"string"==typeof t?nn.includes(t):nn.includes(t.code)}function hn(t){qs.push(t)}function on(t,e){const i=qs.pop()||null;return i?(i.reset(t,e),i):new $s(t,e)}function an(t){let e=t.key,i=t.code;t.shiftKey&&(e=e.toUpperCase()),t.ctrlKey&&(e="^"+e),t.metaKey&&(e="#"+e),t.altKey;const s=qs.pop()||new $s(Qs);return s.shiftKey=t.shiftKey,s.ctrlKey=t.ctrlKey,s.altKey=t.altKey,s.metaKey=t.metaKey,s.type=Qs,s.defaultPrevented=!1,s.key=e,s.code=i,s.x=-1,s.y=-1,s.clientX=-1,s.clientY=-1,s.dir=ln(t.code),s.dt=0,s.target=null,s}function ln(t){const e=t.toLowerCase();return"arrowup"===e?[0,-1]:"arrowdown"===e?[0,1]:"arrowleft"===e?[-1,0]:"arrowright"===e?[1,0]:null}function un(t,e,i){const s=qs.pop()||new $s(t.type);return s.shiftKey=t.shiftKey,s.ctrlKey=t.ctrlKey,s.altKey=t.altKey,s.metaKey=t.metaKey,s.type=t.type||"mousemove",t.buttons&&"mouseup"!==t.type&&(s.type=Js),s.defaultPrevented=!1,s.key="",s.code="",s.x=e,s.y=i,s.clientX=t.clientX,s.clientY=t.clientY,s.dir=null,s.dt=0,s.target=null,s}class cn{constructor(){this.lastClick={x:-1,y:-1},this._events=[]}get length(){return this._events.length}clear(){this._events.length=0}enqueue(t){if(this._events.length){const e=this._events[this._events.length-1];if(e.type===t.type&&e.type===Zs)return e.x=t.x,e.y=t.y,void hn(t)}if(t.type===Js){if(this.lastClick.x==t.x&&this.lastClick.y==t.y&&this._events.findIndex((t=>t.type===Js))>=0)return void hn(t);this.lastClick.x=t.x,this.lastClick.y=t.y}else if(t.type==en)return this.lastClick.x=-1,this.lastClick.y=-1,void hn(t);if(t.type===tn){const e=this._events[0];if(e&&e.type===tn)return e.dt+=t.dt,void hn(t);this._events.unshift(t)}else this._events.push(t)}dequeue(){return this._events.shift()}peek(){return this._events[0]}}class dn extends Error{constructor(...t){super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,dn),this.name="NotSupportedError"}}class gn{constructor(t){if(this.mouse={x:-1,y:-1},this._renderRequested=!1,this._autoRender=!0,this._width=50,this._height=25,this._layers=[],!t.glyphs)throw new Error("You must supply glyphs for the canvas.");this._node=this._createNode(),this._createContext(),this._configure(t)}get node(){return this._node}get width(){return this._width}get height(){return this._height}get tileWidth(){return this._glyphs.tileWidth}get tileHeight(){return this._glyphs.tileHeight}get pxWidth(){return this.node.clientWidth}get pxHeight(){return this.node.clientHeight}get glyphs(){return this._glyphs}set glyphs(t){this._setGlyphs(t)}layer(t=0){let e=this._layers.find((e=>e.depth===t));return e||(e=new bn(this,t),this._layers.push(e),this._layers.sort(((t,e)=>t.depth-e.depth)),e)}clearLayer(t=0){const e=this._layers.find((e=>e.depth===t));e&&e.clear()}removeLayer(t=0){const e=this._layers.findIndex((e=>e.depth===t));e>-1&&this._layers.splice(e,1)}_createNode(){return document.createElement("canvas")}_configure(t){if(this._width=t.width||this._width,this._height=t.height||this._height,this._autoRender=!1!==t.render,this._setGlyphs(t.glyphs),this.bg=Qi(t.bg||is),t.div){let e;"string"==typeof t.div?(e=document.getElementById(t.div),e||console.warn("Failed to find parent element by ID: "+t.div)):e=t.div,e&&e.appendChild&&e.appendChild(this.node)}}_setGlyphs(t){if(t===this._glyphs)return!1;this._glyphs=t,this.resize(this._width,this._height);const e=this._gl,i=this._uniforms;return e.uniform2uiv(i.tileSize,[this.tileWidth,this.tileHeight]),this._uploadGlyphs(),!0}resize(t,e){this._width=t,this._height=e;const i=this.node;i.width=this._width*this.tileWidth,i.height=this._height*this.tileHeight;this._gl.viewport(0,0,this.node.width,this.node.height),this._createGeometry(),this._createData()}_requestRender(){this._renderRequested||(this._renderRequested=!0,this._autoRender&&requestAnimationFrame((()=>this._render())))}hasXY(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}toX(t){return Math.floor(this.width*t/this.node.clientWidth)}toY(t){return Math.floor(this.height*t/this.node.clientHeight)}get onclick(){throw new Error("Write only.")}set onclick(t){this.node.onclick=t?e=>{const i=un(e,this.toX(e.offsetX),this.toY(e.offsetY));t(i),e.preventDefault()}:null}get onmousemove(){throw new Error("write only.")}set onmousemove(t){this.node.onmousemove=t?e=>{const i=this.toX(e.offsetX),s=this.toY(e.offsetY);if(i==this.mouse.x&&s==this.mouse.y)return;this.mouse.x=i,this.mouse.y=s;const n=un(e,i,s);t(n),e.preventDefault()}:null}get onmouseup(){throw new Error("write only.")}set onmouseup(t){this.node.onmouseup=t?e=>{const i=un(e,this.toX(e.offsetX),this.toY(e.offsetY));t(i),e.preventDefault()}:null}get onkeydown(){throw new Error("write only.")}set onkeydown(t){t?(this.node.tabIndex=0,this.node.onkeydown=e=>{e.stopPropagation();const i=an(e);t(i),e.preventDefault()}):this.node.onkeydown=null}_createContext(){let t=this.node.getContext("webgl2");if(!t)throw new dn("WebGL 2 not supported");this._gl=t,this._buffers={},this._attribs={},this._uniforms={};const e=pn(t,zs,Ks);t.useProgram(e);const i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){t.enableVertexAttribArray(s);let i=t.getActiveAttrib(e,s);this._attribs[i.name]=s}const s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<s;i++){let s=t.getActiveUniform(e,i);this._uniforms[s.name]=t.getUniformLocation(e,s.name)}t.uniform1i(this._uniforms.font,0),this._texture=function(t){let e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),e}(t)}_createGeometry(){const t=this._gl;this._buffers.position&&t.deleteBuffer(this._buffers.position),this._buffers.uv&&t.deleteBuffer(this._buffers.uv);let e=function(t,e,i,s){let n=i*s,r=new Float32Array(n*_n.length),h=new Uint8Array(n*_n.length);for(let t=0;t<s;t++)for(let e=0;e<i;e++){const n=(e+t*i)*_n.length;r.set(_n.map(((n,r)=>r%2?1-2*(t+n)/s:2*(e+n)/i-1)),n),h.set(_n,n)}const o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(e.position,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);const a=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribIPointer(e.offset,2,t.UNSIGNED_BYTE,0,0),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW),{position:o,uv:a}}(t,this._attribs,this.width,this.height);Object.assign(this._buffers,e)}_createData(){const t=this._gl,e=this._attribs;this._buffers.fg&&t.deleteBuffer(this._buffers.fg),this._buffers.bg&&t.deleteBuffer(this._buffers.bg),this._buffers.glyph&&t.deleteBuffer(this._buffers.glyph),this._layers.length&&(this._layers.forEach((t=>t.detach())),this._layers.length=0);const i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribIPointer(e.fg,1,t.UNSIGNED_SHORT,0,0);const s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribIPointer(e.bg,1,t.UNSIGNED_SHORT,0,0);const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribIPointer(e.glyph,1,t.UNSIGNED_BYTE,0,0),Object.assign(this._buffers,{fg:i,bg:s,glyph:n})}_uploadGlyphs(){if(!this._glyphs.needsUpdate)return;const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._glyphs.node),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),this._requestRender(),this._glyphs.needsUpdate=!1}draw(t,e,i,s,n){this.layer(0).draw(t,e,i,s,n)}render(t){t&&this.layer().copy(t),this._requestRender()}_render(){const t=this._gl;if(this._glyphs.needsUpdate)this._uploadGlyphs();else if(!this._renderRequested)return;this._renderRequested=!1,t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.clearColor(this.bg.r/100,this.bg.g/100,this.bg.b/100,this.bg.a/100),t.clear(t.COLOR_BUFFER_BIT),this._layers.forEach((e=>{e.empty||(t.uniform1i(this._uniforms.depth,e.depth),t.bindBuffer(t.ARRAY_BUFFER,this._buffers.fg),t.bufferData(t.ARRAY_BUFFER,e.fg,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._buffers.bg),t.bufferData(t.ARRAY_BUFFER,e.bg,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._buffers.glyph),t.bufferData(t.ARRAY_BUFFER,e.glyph,t.DYNAMIC_DRAW),t.drawArrays(t.TRIANGLES,0,this._width*this._height*6))}))}}function pn(t,...e){const i=t.createProgram();if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach(((s,n)=>{const r=t.createShader(s);if(t.shaderSource(r,e[n]),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));t.attachShader(i,r)})),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(i));return i}const _n=[0,0,1,0,0,1,0,1,1,0,1,1];class bn extends Ts{constructor(t,e=0){super(t.width,t.height),this._empty=!0,this.canvas=t,this.resize(t.width,t.height),this._depth=e}get width(){return this.canvas.width}get height(){return this.canvas.height}get depth(){return this._depth}get empty(){return this._empty}detach(){this.canvas=null}resize(t,e){const i=t*e*6;this.fg&&this.fg.length===i||(this.fg=new Uint16Array(i),this.bg=new Uint16Array(i),this.glyph=new Uint8Array(i))}clear(){this.fg.fill(0),this.bg.fill(0),this.glyph.fill(0),this._empty=!0}get(t,e){const i=t*e*6;return{ch:this.fromGlyph(this.glyph[i]),fg:this.fg[i],bg:this.bg[i]}}set(t,e,i=null,s=4095,n=-1){return this.draw(t,e,i,s,n)}draw(t,e,i=null,s=4095,n=-1){const r=t+e*this.canvas.width;return"string"==typeof i?i=this.toGlyph(i):null===i&&(i=this.glyph[r]),s=Qi(s).toInt(),n=Qi(n).toInt(),this._set(r,i,s,n),(i||n||s)&&(this._empty=!1,this.canvas._requestRender()),this}_set(t,e,i,s){t*=6,e&=255,s&=65535,i&=65535;for(let n=0;n<6;++n)this.glyph[t+n]=e,this.fg[t+n]=i,this.bg[t+n]=s}nullify(...t){2===t.length?this._set(t[0]*t[1],0,0,0):(this.glyph.fill(0),this.fg.fill(0),this.bg.fill(0))}dump(){const t=[];let e="    ";for(let t=0;t<this.width;++t)t%10==0&&(e+=" "),e+=t%10;t.push(e),t.push("");for(let e=0;e<this.height;++e){let i=`${(""+e).padStart(2)}] `;for(let t=0;t<this.width;++t){t%10==0&&(i+=" ");let s=this.get(t,e).ch;null===s&&(s=" "),i+=s}t.push(i)}console.log(t.join("\n"))}copy(t){if(t.width===this.width&&t.height===this.height||(console.log("auto resizing buffer"),t.resize(this.width,this.height)),!this.canvas)throw new Error("Layer is detached.  Did you resize the canvas?");t._data.forEach(((t,e)=>{let i=t.ch?this.canvas.glyphs.forChar(t.ch):0;this._set(e,i,t.fg.toInt(),t.bg.toInt())})),this._empty=!1,this.canvas._requestRender()}copyTo(t){t.resize(this.width,this.height);for(let e=0;e<this.height;++e)for(let i=0;i<this.width;++i){const s=6*(i+e*this.width);t.draw(i,e,this.toChar(this.glyph[s]),this.fg[s],this.bg[s])}}toGlyph(t){return this.canvas.glyphs.forChar(t)}fromGlyph(t){return this.canvas.glyphs.toChar(t)}toChar(t){return this.canvas.glyphs.toChar(t)}}function mn(...t){let e,i=t[0],s=t[1],n=t[2];1==t.length&&(n=t[0],s=n.height||34,i=n.width||80),n=n||{font:"monospace"},e=n.image?Xs.fromImage(n.image):Xs.fromFont(n);const r=new gn({width:i,height:s,glyphs:e});if(n.div){let t;"string"==typeof n.div?(t=document.getElementById(n.div),t||console.warn("Failed to find parent element by ID: "+n.div)):t=n.div,t&&t.appendChild&&t.appendChild(r.node)}return r}var yn=Object.freeze({__proto__:null,Glyphs:Xs,initGlyphs:Gs,Layer:bn,Buffer:class extends Cs{constructor(t){super(t.width,t.height),this._layer=t,t.copyTo(this)}toGlyph(t){return"number"==typeof t?t:this._layer.toGlyph(t)}render(){return this._layer.copy(this),this}copyFromLayer(){return this._layer.copyTo(this),this}},VERTICES_PER_TILE:6,NotSupportedError:dn,Canvas:gn,withImage:function(t){let e={};if("string"==typeof t)e.glyphs=Xs.fromImage(t);else if(t instanceof HTMLImageElement)e.glyphs=Xs.fromImage(t);else{if(!t.image)throw new Error("You must supply the image.");Object.assign(e,t),e.glyphs=Xs.fromImage(t.image)}return new gn(e)},withFont:function(t){return"string"==typeof t&&(t={font:t}),t.glyphs=Xs.fromFont(t),new gn(t)},createProgram:pn,QUAD:_n,make:mn});class wn{constructor(t,e,i,s=100){t||(t=null),this.ch=t,this.fg=Qi(e),this.bg=Qi(i),this.opacity=W(s,0,100)}clone(){return new wn(this.ch,this.fg,this.bg,this.opacity)}toString(){const t=[];return this.ch&&t.push("ch: "+this.ch),this.fg.isNull()||t.push("fg: "+this.fg.toString()),this.bg.isNull()||t.push("bg: "+this.bg.toString()),100!==this.opacity&&t.push("opacity: "+this.opacity),"{ "+t.join(", ")+" }"}}const vn={};function xn(...t){let e,i=null,s=-1,n=-1;if(0==t.length)return new wn(null,-1,-1);if(1==t.length&&Array.isArray(t[0])&&(t=t[0]),t.length>3?(e=t[3],t.pop()):2==t.length&&"number"==typeof t[1]&&t[0].length>1&&(e=t.pop()),t.length>1)i=t[0]||null,s=t[1],n=t[2];else if("string"==typeof t[0]&&1==t[0].length)i=t[0],s="white";else if("string"==typeof t[0]&&t[0].length>1||"number"==typeof t[0])n=t[0];else if(t[0]instanceof Xi)n=t[0];else{const r=t[0];i=r.ch||null,s=r.fg||-1,n=r.bg||-1,e=r.opacity}return"string"==typeof s?s=Qi(s):Array.isArray(s)?s=qi(s):null==s&&(s=-1),"string"==typeof n?n=Qi(n):Array.isArray(n)?n=qi(n):null==n&&(n=-1),new wn(i,s,n,e)}var En=Object.freeze({__proto__:null,Sprite:wn,sprites:vn,make:xn,from:function(t){if("string"==typeof t){const e=vn[t];if(!e)throw new Error("Failed to find sprite: "+t);return e}return xn(t)},install:function(t,...e){let i;return i=xn(...e),i.name=t,vn[t]=i,i},Mixer:rs,makeMixer:function(t){return new rs(t)}}),In=Object.freeze({__proto__:null});var An=Object.freeze({__proto__:null,Cache:class{constructor(t={}){this._archive=[],this._confirmed=[],this.archiveLen=30,this.msgWidth=80,this._nextWriteIndex=0,this._combatMsg=null,this.archiveLen=t.length||30,this.msgWidth=t.width||80,this._reverse=t.reverseMultiLine||!1,this.clear()}clear(){for(let t=0;t<this.archiveLen;++t)this._archive[t]=null,this._confirmed[t]=!1;this._nextWriteIndex=0,this._combatMsg=null}_addMessageLine(t){as(t)&&(this._archive[this._nextWriteIndex]=t,this._confirmed[this._nextWriteIndex]=!1,this._nextWriteIndex=(this._nextWriteIndex+1)%this.archiveLen)}add(t){this.commitCombatMessage(),this._addMessage(t)}_addMessage(t){const e=vs(t=ds(t),this.msgWidth);this._reverse&&e.reverse(),e.forEach((t=>this._addMessageLine(t)))}addCombat(t){this._addCombatMessage(t)}_addCombatMessage(t){this._combatMsg?this._combatMsg+=", "+ds(t):this._combatMsg=t}commitCombatMessage(){return!!this._combatMsg&&(this._addMessage(this._combatMsg+"."),this._combatMsg=null,!0)}confirmAll(){for(let t=0;t<this._confirmed.length;t++)this._confirmed[t]=!0}forEach(t){this.commitCombatMessage();for(let e=0;e<this.archiveLen;++e){const i=(this.archiveLen-e+this._nextWriteIndex-1)%this.archiveLen,s=this._archive[i];if(!s)return;if(!1===t(s,this._confirmed[i],e))return}}get length(){let t=0;return this.forEach((()=>++t)),t}}}),Sn=Gt,Tn=function(){try{var t=Sn(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Cn=function(t,e,i){"__proto__"==e&&Tn?Tn(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i},Mn=ce,Ln=Object.prototype.hasOwnProperty;var kn=/^(?:0|[1-9]\d*)$/;var Rn=function(t,e,i){var s=t[e];Ln.call(t,e)&&Mn(s,i)&&(void 0!==i||e in t)||Cn(t,e,i)},On=ni,Dn=function(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&kn.test(t))&&t>-1&&t%1==0&&t<e},Nn=o,Pn=hi;var Fn=function(t,e,i,s){if(!Nn(t))return t;for(var n=-1,r=(e=On(e,t)).length,h=r-1,o=t;null!=o&&++n<r;){var a=Pn(e[n]),l=i;if("__proto__"===a||"constructor"===a||"prototype"===a)return t;if(n!=h){var u=o[a];void 0===(l=s?s(u,a,o):void 0)&&(l=Nn(u)?u:Dn(e[n+1])?[]:{})}Rn(o,a,l),o=o[a]}return t};var Bn=function(t,e,i){return null==t?t:Fn(t,e,i)};class Wn{constructor(t={}){Object.assign(this,t)}get(t){return ui(this,t)}set(t,e){return Bn(this,t,e)}}var jn=Object.freeze({__proto__:null,Data:Wn});class Vn{constructor(t={}){this.options={rng:Mi,rounds:5,minWidth:10,minHeight:10,maxWidth:40,maxHeight:20,percentSeeded:50,birthParameters:"ffffffttt",survivalParameters:"ffffttttt"},Object.assign(this.options,t),this.options.birthParameters=this.options.birthParameters.toLowerCase(),this.options.survivalParameters=this.options.survivalParameters.toLowerCase(),this.options.minWidth>=this.options.maxWidth&&(this.options.minWidth=Math.round(.75*this.options.maxWidth),this.options.maxWidth=Math.round(1.25*this.options.maxWidth)),this.options.minHeight>=this.options.maxHeight&&(this.options.minHeight=Math.round(.75*this.options.maxHeight),this.options.maxHeight=Math.round(1.25*this.options.maxHeight))}carve(t,e,i){let s,n,r,h,o,a,l,u=new et(0,0,0,0);const c=vi(t,e),d=Math.min(t,this.options.maxWidth),f=Math.min(e,this.options.maxHeight),g=Math.min(t,this.options.minWidth),p=Math.min(e,this.options.minHeight),_=Math.floor((c.width-d)/2),b=Math.floor((c.height-f)/2);let m=10;do{for(c.fill(0),s=0;s<d;s++)for(n=0;n<f;n++)c[s+_][n+b]=this.options.rng.chance(this.options.percentSeeded)?1:0;for(r=0;r<this.options.rounds;r++)this._cellularAutomataRound(c)||(r=this.options.rounds);for(l=0,a=0,h=2,s=0;s<c.width;s++)for(n=0;n<c.height;n++)1==c[s][n]&&(o=c.floodFill(s,n,1,h),o>l&&(l=o,a=h),h++);c.valueBounds(a,u)}while((u.width<g||u.height<p||0==a)&&--m);for(s=0;s<c.width;s++)for(n=0;n<c.height;n++)c[s][n]==a&&i(s,n);return xi(c),u}_cellularAutomataRound(t){let e,i,s,n,r,h,o;o=vi(t.width,t.height),o.copy(t);let a=!1;for(e=0;e<t.width;e++)for(i=0;i<t.height;i++){for(s=0,h=0;h<$.length;h++)n=e+$[h][0],r=i+$[h][1],t.hasXY(n,r)&&o[n][r]&&s++;o[e][i]||"t"!=this.options.birthParameters[s]?o[e][i]&&"t"==this.options.survivalParameters[s]||(t[e][i]=0,a=!0):(t[e][i]=1,a=!0)}return xi(o),a}}var Yn=Object.freeze({__proto__:null,Blob:Vn,fillBlob:function(t,e={}){return new Vn(e).carve(t.width,t.height,((e,i)=>t[e][i]=1))},make:function(t={}){return new Vn(t)}});let Hn=qi();class Un{constructor(t,e=1,i=0,s=!1){this.fadeTo=0,this.passThroughActors=!1,this.id=null,this.color=Qi(t),this.radius=Oi(e),this.fadeTo=i,this.passThroughActors=s}copy(t){this.color=t.color,this.radius.copy(t.radius),this.fadeTo=t.fadeTo,this.passThroughActors=t.passThroughActors}get intensity(){return Xn(this.color)}paint(t,e,i,s=!1,n=!1){if(!t)return!1;let r,h=0,o=this.radius.value(),a=Math.ceil(o);if(a<1)return!1;Hn=this.color.bake();const l=!n&&!s&&!Gn(Hn),u=this.fadeTo,c=vi(t.width,t.height,0);t.calcFov(e,i,a,this.passThroughActors,((t,e)=>{c[t][e]=1}));const d=[0,0,0];return c.forCircle(e,i,a,((s,n,a)=>{if(s){for(h=Math.floor(100-(100-u)*(rt(e,i,n,a)/o)),r=0;r<3;++r)d[r]=Math.floor(Hn._data[r]*h/100);t.addCellLight(n,a,d,l)}})),xi(c),!0}}function Xn(t){let e=t;return t instanceof Xi&&(e=t._data),Math.max(e[0],e[1],e[2])}function Gn(t,e=20){return Xn(t)<=e}function zn(t,e=40){return Xn(t)<=e}function Kn(...t){if(1==t.length){const e=t[0];if("string"==typeof e){const t=$n[e];if(t)return t;const[i,s,n,r]=e.split(/[,|]/).map((t=>t.trim()));return new Un(Qi(i),Di(s||1),Number.parseInt(n||"0"),!!r&&"false"!==r)}if(Array.isArray(e)){const[t,i,s,n]=e;return new Un(t,i,s,n)}if(e&&e.color)return new Un(Qi(e.color),Di(e.radius),Number.parseInt(e.fadeTo||"0"),e.pass);throw new Error("Unknown Light config - "+e)}{const[e,i,s,n]=t;return new Un(e,i,s,n)}}const $n={};function qn(...t){1!=t.length&&j("Unknown Light config: "+JSON.stringify(t));const e=t[0];if("string"==typeof e){const t=$n[e];if(t)return t}return e&&e.paint?e:Kn(e)}function Qn(t,...e){let i;return i=1==e.length?Kn(e[0]):Kn(e[0],e[1],e[2],e[3]),$n[t]=i,i.id=t,i}const Zn=Vi(["LIT","IN_SHADOW","DARK","CHANGED"]);var Jn=Object.freeze({__proto__:null,Light:Un,intensity:Xn,isDarkLight:Gn,isShadowLight:zn,make:Kn,lights:$n,from:qn,install:Qn,installAll:function(t){Object.entries(t).forEach((([t,e])=>{Qn(t,e)}))},LightSystem:class{constructor(t,e={}){this.staticLights=null,this.site=t,this.ambient=Qi(e.ambient||"white").toLight(),this.changed=!1,this.glowLightChanged=!1,this.dynamicLightChanged=!1,this.light=Ei(t.width,t.height,(()=>this.ambient.slice())),this.glowLight=Ei(t.width,t.height,(()=>this.ambient.slice())),this.oldLight=Ei(t.width,t.height,(()=>this.ambient.slice())),this.flags=Ei(t.width,t.height),this.finishLightUpdate()}copy(t){this.setAmbient(t.ambient),this.glowLightChanged=!0,this.dynamicLightChanged=!0,this.changed=!0,this.staticLights=null,mt(t.staticLights,(t=>this.addStatic(t.x,t.y,t.light)))}getAmbient(){return this.ambient}setAmbient(t){t instanceof Xi?t=t.toLight():Array.isArray(t)||(t=Qi(t).toLight());for(let e=0;e<3;++e)this.ambient[e]=t[e];this.glowLightChanged=!0}get needsUpdate(){return this.glowLightChanged||this.dynamicLightChanged}getLight(t,e){return this.light[t][e]}setLight(t,e,i){const s=this.light[t][e];for(let t=0;t<3;++t)s[t]=i[t]}isLit(t,e){return!!(this.flags[t][e]&Zn.LIT)}isDark(t,e){return!!(this.flags[t][e]&Zn.DARK)}isInShadow(t,e){return!!(this.flags[t][e]&Zn.IN_SHADOW)}lightChanged(t,e){return!!(this.flags[t][e]&Zn.CHANGED)}get width(){return this.site.width}get height(){return this.site.height}addStatic(t,e,i){const s={x:t,y:e,light:qn(i),next:this.staticLights};return this.staticLights=s,this.glowLightChanged=!0,s}removeStatic(t,e,i){let s=this.staticLights;if(!s)return;function n(s){return s.x==t&&s.y==e&&(!i||i===s.light)}for(this.glowLightChanged=!0;s&&n(s);)s=this.staticLights=s.next;if(!s)return;let r=s.next;for(;r;)n(r)?s.next=r.next:s=r,r=r.next}eachStaticLight(t){mt(this.staticLights,(e=>t(e.x,e.y,e.light))),this.site.eachGlowLight(((e,i,s)=>{t(e,i,s)}))}eachDynamicLight(t){this.site.eachDynamicLight(t)}update(t=!1){return this.changed=!1,!(!t&&!this.needsUpdate)&&(this.startLightUpdate(),this.glowLightChanged?(this.eachStaticLight(((t,e,i)=>{i.paint(this,t,e)})),this.recordGlowLights(),this.glowLightChanged=!1):this.restoreGlowLights(),this.eachDynamicLight(((t,e,i)=>i.paint(this,t,e))),this.finishLightUpdate(),this.site.eachMinersLight(((t,e,i)=>{i.paint(this,t,e,!0,!0)})),this.dynamicLightChanged=!1,this.changed=!0,!0)}startLightUpdate(){let t=0;const e=zn(this.ambient)?Zn.IN_SHADOW:0;this.light.forEach(((i,s,n)=>{for(t=0;t<3;++t)this.oldLight[s][n][t]=i[t],i[t]=this.ambient[t];this.flags[s][n]=e}))}finishLightUpdate(){dt(this.width,this.height,((t,e)=>{const i=this.oldLight[t][e],s=this.light[t][e];s.some(((t,e)=>t!==i[e]))&&(this.flags[t][e]|=Zn.CHANGED),Gn(s)?this.flags[t][e]|=Zn.DARK:zn(s)||(this.flags[t][e]|=Zn.LIT)}))}recordGlowLights(){let t=0;this.light.forEach(((e,i,s)=>{const n=this.glowLight[i][s];for(t=0;t<3;++t)n[t]=e[t]}))}restoreGlowLights(){let t=0;this.light.forEach(((e,i,s)=>{const n=this.glowLight[i][s];for(t=0;t<3;++t)e[t]=n[t]}))}calcFov(t,e,i,s,n){const r=this.site;new ks({isBlocked:(t,e)=>!(!s&&r.hasActor(t,e))&&r.blocksVision(t,e),hasXY:(t,e)=>r.hasXY(t,e)}).calculate(t,e,i,n)}addCellLight(t,e,i,s){const n=this.light[t][e];for(let t=0;t<3;++t)n[t]+=i[t];s&&!zn(i)&&(this.flags[t][e]&=~Zn.IN_SHADOW)}}});class tr{constructor(t,e){this._events={},this.onUnhandled=null,this._ctx=t,e&&this.on(e)}has(t){const e=this._events[t];return!!e&&e.some((t=>t&&t.fn))}on(...t){if(1===t.length){const e=Object.entries(t[0]).map((([t,e])=>this.on(t,e)));return()=>e.forEach((t=>t()))}const e=t[0],i=t[1];if(Array.isArray(e)){const t=e.map((t=>this.on(t,i)));return()=>{t.forEach((t=>t()))}}e in this._events||(this._events[e]=[]);const s={fn:i};return this._events[e].unshift(s),()=>{X(this._events[e],s)}}once(t,e){if(Array.isArray(t)){const i=t.map((t=>this.on(t,e)));return()=>{i.forEach((t=>t()))}}t in this._events||(this._events[t]=[]);const i={fn:e,once:!0};return this._events[t].unshift(i),()=>{X(this._events[t],i)}}off(t,e){if(Array.isArray(t))return void t.forEach((t=>this.off(t,e)));const i=this._events[t];if(!i)return;if(!e){for(let t=0;t<i.length;++t)i[t]=null;return}const s=i.findIndex((t=>t&&t.fn===e));s>-1&&(i[s]=null)}emit(t,...e){if(Array.isArray(t)){let i=!1;for(let s of t)i=this.emit(s,...e)||i;return i}const i=this._events[t];return i&&0!=i.length?(i.forEach((t=>{t&&t.fn.call(this._ctx,...e)})),this._events[t]=i.filter((t=>t&&!t.once)),!0):this._unhandled(t,e)}_unhandled(t,e){return!!this.onUnhandled&&(this.onUnhandled.call(this._ctx,t,...e),!0)}clear(){this._events={},this.onUnhandled=null}clear_event(t){t in this._events&&(this._events[t]=this._events[t].map((()=>null)))}restart(){Object.keys(this._events).forEach((t=>{this._events[t]=this._events[t].filter((t=>t&&!t.once))})),this.onUnhandled=null}}class er{constructor(){this.events=new tr(this),this.children=[]}on(t,e){return this.events.on(t,e),this}once(t,e){return this.events.once(t,e),this}off(t,e){return this.events.off(t,e),this}emit(t,...e){return this.events.emit(t,...e)}addChild(t){return this.children.push(t),this}removeChild(t){return U(this.children,t),this}update(t){this.children.forEach((e=>e.update(t))),this.emit("update",t)}}class ir extends er{constructor(t){super(),this._repeat=0,this._count=0,this._from=!1,this._duration=0,this._delay=0,this._repeatDelay=-1,this._yoyo=!1,this._time=Number.MAX_SAFE_INTEGER,this._startTime=0,this._goal={},this._start={},this._success=!0,this._easing=rr,this._interpolate=hr,this._obj=t}isRunning(){return this._startTime>0||this._time<this._duration||this.children.length>0}onStart(t){return this.on("start",t),this}onUpdate(t){return this.on("update",t),this}onRepeat(t){return this.on("repeat",t),this}onFinish(t){return this.on("stop",t),this}to(t,e){return e?("boolean"==typeof e&&(e=Object.keys(t)),this._goal={},e.forEach((e=>{this._goal[e]=()=>t[e]}))):this._goal=t,0==Object.keys(this._start).length&&Object.keys(this._goal).forEach((t=>{this._start[t]=this._obj[t]})),this}from(t,e){return e?("boolean"==typeof e&&(e=Object.keys(t)),this._start={},e.forEach((e=>{this._start[e]=()=>t[e]}))):this._start=t,0==Object.keys(this._goal).length&&Object.keys(this._start).forEach((t=>{this._goal[t]=this._obj[t]})),this}duration(t){return void 0===t?this._duration:(this._duration=t,this)}repeat(t){return void 0===t?this._repeat:(this._repeat=t,this)}delay(t){return void 0===t?this._delay:(this._delay=t,this)}repeatDelay(t){return void 0===t?this._repeatDelay:(this._repeatDelay=t,this)}yoyo(t){return void 0===t?this._yoyo:(this._yoyo=t,this)}start(t){return this._success=!0,this._time>0&&(this._time=0,this._startTime=this._delay,this._count=0,this._updateProperties(this._obj,this._start,this._goal,0)),t&&t.add(this),this}update(t){if(!this.isRunning())return;if(this.children.forEach((e=>e.update(t))),this.children=this.children.filter((t=>t.isRunning())),this._time+=t,this._startTime){if(this._startTime>this._time)return;this._time-=this._startTime,this._startTime=0,this._count>0&&this._restart()}0===this._count&&this._restart();const e=this._easing(this._time/this._duration);this._updateProperties(this._obj,this._start,this._goal,e)&&this.emit("update",this._obj,e),this._time>=this._duration&&(this._repeat>this._count||this._repeat<0?(this._time=this._time%this._duration,this._startTime=this._repeatDelay>-1?this._repeatDelay:this._delay,this._yoyo&&([this._start,this._goal]=[this._goal,this._start]),this._startTime||this._restart()):this.isRunning()||this.emit("stop",this._obj,this._success))}_restart(){++this._count,this._updateProperties(this._obj,this._start,this._goal,0),1==this._count?this.emit("start",this._obj,0):this.emit("repeat",this._obj,this._count)||this.emit("update",this._obj,0)}stop(t=!1){this._success=t,this._time=Number.MAX_SAFE_INTEGER,this.children.forEach((e=>e.stop(t)))}_updateProperties(t,e,i,s){let n=!1;return Object.entries(i).forEach((([i,r])=>{let h=t[i],o=e[i];"function"==typeof o&&(o=o.call(e)),"function"==typeof r&&(r=r.call(t));const a=this._interpolate(o,r,s);a!==h&&(t[i]=a,n=!0)})),n}}function sr(t,e=1e3){return new ir(t).duration(e)}const nr=sr;function rr(t){return W(t,0,1)}function hr(t,e,i){return"number"!=typeof t||"number"!=typeof e?0==Math.floor(i)?t:e:Math.round((e-t)*i)+t}var or=Object.freeze({__proto__:null,BaseObj:er,Tween:ir,make:sr,move:nr,linear:rr,interpolate:hr});class ar{constructor(t){this._timers=[],this._ctx=t}get length(){return this._timers.length}clear(){this._timers=[]}restart(){this._timers.forEach((t=>{t.delay=t.repeat||0})),this._timers=this._timers.filter((t=>t.delay>0))}setTimeout(t,e){const i={fn:t,delay:e,repeat:0};return this._timers.push(i),()=>U(this._timers,i)}setInterval(t,e){const i={fn:t,delay:e,repeat:e};return this._timers.push(i),()=>U(this._timers,i)}update(t){if(!this._timers.length)return;let e=!1;this._timers.forEach((i=>{if(i.delay-=t,i.delay<=0){const t=i.fn.call(this._ctx);i.repeat&&!1!==t&&(i.delay+=i.repeat,i.delay<0&&(i.delay=i.repeat))}e=e||i.delay<=0})),e&&(this._timers=this._timers.filter((t=>t.delay>0)))}}class lr{constructor(){this._tweens=[]}get length(){return this._tweens.length}clear(){this._tweens=[]}add(t){this._tweens.push(t)}remove(t){U(this._tweens,t)}update(t){this._tweens.forEach((e=>e.update(t))),this._tweens=this._tweens.filter((t=>t.isRunning()))}}class ur{constructor(t){this.priority=0,(t.startsWith(":")||t.startsWith("."))&&(t="*"+t),this.text=t,this.matchFn=this._parse(t)}_parse(t){const e=t.split(/ +/g).map((t=>t.trim())),i=[];for(let t=0;t<e.length;++t){let s=e[t];">"===s?(i.push(this._parentMatch()),++t,s=e[t]):t>0&&i.push(this._ancestorMatch()),i.push(this._matchElement(s))}return i.reduce(((t,e)=>e.bind(void 0,t)),P)}_parentMatch(){return function(t,e){return!!e.parent&&t(e.parent)}}_ancestorMatch(){return function(t,e){let i=e.parent;for(;i;)if(t(i))return!0;return!1}}_matchElement(t){const e=[],i=new RegExp(/(?:(\w+|\*|\$)|#(\w+)|\.([^\.: ]+))|(?::(?:(?:not\(\.([^\)]+)\))|(?:not\(:([^\)]+)\))|([^\.: ]+)))/g,"g");let s=i.exec(t);for(;s;){if(s[1]){const t=this._matchTag(s[1]);t&&e.push(t)}else s[2]?e.push(this._matchId(s[2])):s[3]?e.push(this._matchClass(s[3])):s[4]?e.push(this._matchNot(this._matchClass(s[4]))):s[5]?e.push(this._matchNot(this._matchProp(s[5]))):e.push(this._matchProp(s[6]));s=i.exec(t)}return(t,i)=>!!e.every((t=>t(i)))&&t(i)}_matchTag(t){return"*"===t?null:"$"===t?(this.priority+=1e4,null):(this.priority+=10,e=>e.tag===t)}_matchClass(t){return this.priority+=100,e=>e.classes.includes(t)}_matchProp(t){return t.startsWith("first")?this._matchFirst():t.startsWith("last")?this._matchLast():"invalid"===t?this._matchNot(this._matchProp("valid")):"optional"===t?this._matchNot(this._matchProp("required")):"enabled"===t?this._matchNot(this._matchProp("disabled")):"unchecked"===t?this._matchNot(this._matchProp("checked")):(this.priority+=2,["odd","even"].includes(t)&&(this.priority-=1),e=>!!e.prop(t))}_matchId(t){return this.priority+=1e3,e=>e.attr("id")===t}_matchFirst(){return this.priority+=1,t=>!!t.parent&&!!t.parent.children&&t.parent.children[0]===t}_matchLast(){return this.priority+=1,t=>!!t.parent&&(!!t.parent.children&&t.parent.children[t.parent.children.length-1]===t)}_matchNot(t){return e=>!t(e)}matches(t){return this.matchFn(t)}}class cr{constructor(t="$",e){this._dirty=!1,this.selector=new ur(t),e&&this.set(e),this._dirty=!1}get dirty(){return this._dirty}set dirty(t){this._dirty=t}get fg(){return this._fg}get bg(){return this._bg}get opacity(){return this._opacity}dim(t=25,e=!0,i=!1){return e&&(this._fg=Qi(this._fg).darken(t)),i&&(this._bg=Qi(this._bg).darken(t)),this}bright(t=25,e=!0,i=!1){return e&&(this._fg=Qi(this._fg).lighten(t)),i&&(this._bg=Qi(this._bg).lighten(t)),this}invert(){return[this._fg,this._bg]=[this._bg,this._fg],this}get align(){return this._align}get valign(){return this._valign}get(t){return this["_"+t]}set(t,e,i=!0){if("string"==typeof t){const i="_"+t;"string"==typeof e&&(e.match(/^[+-]?\d+$/)?e=Number.parseInt(e):"true"===e?e=!0:"false"===e&&(e=!1)),this[i]=e}else t instanceof cr?(i=!(!e&&void 0!==e),Object.entries(t).forEach((([t,e])=>{"selector"!==t&&"_dirty"!==t&&(null!=e?this[t]=e:null===e&&this.unset(t))}))):(i=!(!e&&void 0!==e),Object.entries(t).forEach((([t,e])=>{null===e?this.unset(t):this.set(t,e,i)})));return this.dirty||(this.dirty=i),this}unset(t){return delete this[t.startsWith("_")?t:"_"+t],this.dirty=!0,this}clone(){const t=new this.constructor;return t.copy(this),t}copy(t){return Object.assign(this,t),this}}class dr extends cr{constructor(t){super(),this.sources=[],this._baseFg=null,this._baseBg=null,t&&(t.sort(((t,e)=>t.selector.priority-e.selector.priority)),this.sources=t),this.sources.forEach((t=>super.set(t))),this._dirty=!1}get opacity(){var t;return null!==(t=this._opacity)&&void 0!==t?t:100}set opacity(t){if(t=W(t,0,100),this._opacity=t,100===t)return this._fg=this._baseFg||this._fg,void(this._bg=this._baseBg||this._bg);void 0!==this._fg&&(this._baseFg=this._baseFg||Qi(this._fg),this._fg=this._baseFg.alpha(t)),void 0!==this._bg&&(this._baseBg=this._baseBg||Qi(this._bg),this._bg=this._baseBg.alpha(t))}get dirty(){return this._dirty||this.sources.some((t=>t.dirty))}set dirty(t){this._dirty=t}}class fr{constructor(t){this.rules=[],this._dirty=!0,this._parent=t||null}get dirty(){return this._dirty}set dirty(t){this._dirty=t,this._dirty||this.rules.forEach((t=>t.dirty=!1))}setParent(t){this._parent=t}add(t,e){if(t.includes(","))return t.split(",").map((t=>t.trim())).forEach((t=>this.add(t,e))),this;if(t.includes(" "))throw new Error("Hierarchical selectors not supported.");let i=new cr(t,e);return this.rules.push(i),this.dirty=!0,this}get(t){return this.rules.find((e=>e.selector.text===t))||null}load(t){return Object.entries(t).forEach((([t,e])=>{this.add(t,e)})),this}remove(t){const e=this.rules.findIndex((e=>e.selector.text===t));e>-1&&(this.rules.splice(e,1),this.dirty=!0)}_rulesFor(t){let e=this.rules.filter((e=>e.selector.matches(t)));return this._parent&&(e=this._parent._rulesFor(t).concat(e)),e}computeFor(t){const e=this._rulesFor(t),i=t.style();return i&&(e.push(i),i.dirty=!1),new dr(e)}}const gr=new fr(null);gr.add("*",{fg:"white"});class pr{constructor(t,e){this.events=new tr(this),this.tweens=new lr,this.timers=new ar(this),this.all=[],this.children=[],this.focused=null,this.dt=0,this.time=0,this.realTime=0,this.skipTime=!1,this.stopped=!0,this.paused={},this.debug=!1,this.needsDraw=!0,this.bg=is,this.data={},this.id=t,this.styles=new fr,this.app=e,this.buffer=new Cs(e.width,e.height),this.styles.setParent(e.styles)}get width(){return this.buffer.width}get height(){return this.buffer.height}isActive(){return!this.stopped}isPaused(){return this.isPaused}isSleeping(){return this.isSleeping}create(t={}){t.bg&&(this.bg=Qi(t.bg)),t.on&&Object.entries(t.on).forEach((([t,e])=>{this.on(t,e)})),Object.entries(t).forEach((([t,e])=>{"function"==typeof e&&this.on(t,e)})),this.emit("create",t)}destroy(t){this.emit("destroy",t),this.all.forEach((t=>t.destroy())),this.children=[],this.all=[],this.timers.clear(),this.tweens.clear()}start(t={}){this.app.scenes.stop(),this._start(t)}_start(t={}){this.stopped=!1,this.buffer.nullify(),this.needsDraw=!0,this.events.emit("start",t)}run(t={}){this.app.scenes.pause(),this._start(t),this.once("stop",(()=>this.app.scenes.resume()))}stop(t){this.stopped=!0,this.events.emit("stop",t)}pause(t){t=t||{timers:!0,tweens:!0,update:!0,input:!0,draw:!0},Object.assign(this.paused,t),this.events.emit("pause")}resume(t){t=t||{timers:!0,tweens:!0,update:!0,input:!0,draw:!0},Object.entries(t).forEach((([t,e])=>{!0===e&&(this.paused[t]=!1)})),this.needsDraw=!0,this.events.emit("resume")}frameStart(){this.events.emit("frameStart")}input(t){if(!(this.paused.input||this.stopped||(this.emit("input",t),t.defaultPrevented||t.propagationStopped))){if(t.type===Qs){let e=this.focused;e&&(e.hidden||e.disabled)&&(this.nextTabStop(),e=this.focused),e&&e.keypress(t),t.defaultPrevented||("Tab"===t.key?this.nextTabStop():"TAB"===t.key&&this.prevTabStop())}else if(t.type===Zs)this.children.forEach((e=>e.mousemove(t)));else{const e=this.childAt(t);e&&(e.click(t),e.prop("tabStop")&&!t.defaultPrevented&&this.setFocusWidget(e))}t.propagationStopped||t.defaultPrevented||t.dispatch(this.events)}}update(t){this.stopped||(this.paused.timers||this.timers.update(t),this.paused.tweens||this.tweens.update(t),this.paused.update||(this.events.emit("update",t),this.all.forEach((e=>e.update(t)))))}fixed_update(t){this.stopped||this.paused.update||(this.events.emit("fixed_update",t),this.all.forEach((e=>e.fixed_update(t))))}draw(t){this.stopped||(!this.paused.draw&&this.needsDraw&&(this._draw(this.buffer),this.emit("draw",this.buffer),this.children.forEach((t=>t.draw(this.buffer))),this.needsDraw=!1),t.apply(this.buffer),this.buffer.changed=!1)}_draw(t){t.fill(this.bg)}frameDebug(t){this.events.emit("frameDebug",t)}frameEnd(t){this.events.emit("frameEnd",t)}fadeIn(t,e){return this.fadeTo(t,100,e)}fadeOut(t,e){return this.fadeTo(t,0,e)}fadeTo(t,e,i){const s=sr({pct:t.style("opacity")}).to({pct:e}).duration(i).onUpdate((e=>{t.style("opacity",e.pct)}));return this.tweens.add(s),this}fadeToggle(t,e){return this.fadeTo(t,t._used.opacity?0:100,e)}slideIn(t,e,i,s,n){let r={x:e,y:i};return"left"===s?r.x=-t.bounds.width:"right"===s?r.x=this.width+t.bounds.width:"top"===s?r.y=-t.bounds.height:"bottom"===s&&(r.y=this.height+t.bounds.height),this.slide(t,r,{x:e,y:i},n)}slideOut(t,e,i){let s={x:t.bounds.x,y:t.bounds.y};return"left"===e?s.x=-t.bounds.width:"right"===e?s.x=this.width+t.bounds.width:"top"===e?s.y=-t.bounds.height:"bottom"===e&&(s.y=this.height+t.bounds.height),this.slide(t,t.bounds,s,i)}slide(t,e,i,s){const n=sr({x:J(e),y:tt(e)}).to({x:J(i),y:tt(i)}).duration(s).onUpdate((e=>{t.pos(e.x,e.y)}));return this.tweens.add(n),this}get(t){return this.all.find((e=>e.id===t))||null}_attach(t){if(!this.all.includes(t)){if(t.scene)throw new Error("Widget on another scene!");this.all.push(t),t.scene=this,t.children.forEach((t=>this._attach(t))),!t.prop("tabStop")||this.focused||t.hidden||t.disabled||this.setFocusWidget(t)}}_detach(t){const e=this.all.indexOf(t);e<0||(this.all.splice(e,1),t.scene=null,t.children.forEach((t=>this._detach(t))))}addChild(t,e){this.children.includes(t)||(t.setParent(null),this.children.push(t),this._attach(t),e&&(t.updatePos(e),e.focused&&this.setFocusWidget(t)))}removeChild(t){const e=this.children.indexOf(t);e<0||(this.children.splice(e,1),t.setParent(null),this._detach(t))}childAt(t,e){let i=0;return"number"==typeof t?(i=t,e=e||0):(i=t.x,e=t.y),G(this.children,(t=>t.contains(i,e)))||null}widgetAt(t,e){let i=0;return"number"==typeof t?(i=t,e=e||0):(i=t.x,e=t.y),G(this.all,(t=>t.contains(i,e)))||null}setFocusWidget(t,e=!1){if(t===this.focused)return;const i=this.focused,s=t;this.focused=null,i&&i.blur(e),null===this.focused&&(this.focused=s,s&&s.focus(e))}nextTabStop(){if(!this.focused)return this.setFocusWidget(this.all.find((t=>!!t.prop("tabStop")&&!t.disabled&&!t.hidden))||null),!!this.focused;const t=z(this.all,this.focused,(t=>!!t.prop("tabStop")&&!t.disabled&&!t.hidden));return t?(this.setFocusWidget(t),!0):(this.setFocusWidget(null),!1)}prevTabStop(){if(!this.focused)return this.setFocusWidget(this.all.find((t=>!!t.prop("tabStop")&&!t.disabled&&!t.hidden))||null),!!this.focused;const t=K(this.all,this.focused,(t=>!!t.prop("tabStop")&&!t.disabled&&!t.hidden));return t?(this.setFocusWidget(t,!0),!0):(this.setFocusWidget(null,!0),!1)}on(...t){return 1===t.length?this.events.on(t[0]):this.events.on(t[0],t[1])}once(t,e){return this.events.once(t,e)}emit(t,...e){return this.events.emit(t,...e)}wait(t,e,i){if("string"==typeof e){const t=e;i=i||{},e=()=>this.emit(t,i)}return this.timers.setTimeout(e,t)}repeat(t,e,i){if("string"==typeof e){const t=e;i=i||{},e=()=>this.emit(t,i)}return this.timers.setInterval(e,t)}}class _r{constructor(t){this._active=[],this._busy=!1,this._pending=[],this._app=t,this._config=Object.assign({},br)}get isBusy(){return this._busy}config(...t){if(1===t.length){const e=t[0];return void Object.entries(e).forEach((([t,e])=>this.config(t,e)))}let[e,i]=t;const s=this._config[e]||{};"function"==typeof i&&(i={make:i}),Object.assign(s,i),this._config[e]=s}get(t){return void 0===t?this._active[this._active.length-1]:this._active.find((e=>e.id===t))||null}emit(t,...e){this._active.forEach((i=>i.emit(t,...e)))}_create(t,e={}){let i=this._config[t]||{};const s=Object.assign({},i,e);let n;return n=s.make?s.make(t,this._app):new pr(t,this._app),n.on("start",(()=>this._start(n))),n.on("stop",(()=>this._stop(n))),n.create(s),n}start(t,e){let i=this.get(t)||this._create(t,e);return this._app.io.clear(),this.isBusy?this._pending.push({action:"start",scene:i,data:e}):i.start(e),i}run(t,e){let i=this.get(t)||this._create(t,e);return this._app.io.clear(),this.isBusy?this._pending.push({action:"run",scene:i,data:e}):i.run(e),i}_start(t){this._active.push(t)}stop(t,e){if("string"==typeof t){const e=this.get(t);if(!e)throw new Error("Unknown scene:"+t);t=e}t instanceof pr?this.isBusy?this._pending.push({action:"stop",scene:t,data:e}):t.stop(e):this._active.forEach((e=>this.stop(e.id,t)))}_stop(t){this._active=this._active.filter((t=>t.isActive()))}destroy(t,e){const i=this.get(t);i&&(i.isActive()&&i.stop(e),i.destroy(e))}pause(t,e){if("string"==typeof t){const i=this.get(t);if(!i)throw new Error("Unknown scene:"+t);i.pause(e)}else this._active.forEach((e=>e.pause(t)))}resume(t,e){if("string"==typeof t){const i=this.get(t);if(!i)throw new Error("Unknown scene:"+t);i.resume(e)}else this._active.forEach((e=>e.resume(t)))}frameStart(){this._busy=!0,this._active.forEach((t=>t.frameStart()))}input(t){H(this._active,(e=>{t.propagationStopped||e.input(t)}))}update(t){this._active.forEach((e=>e.update(t)))}fixed_update(t){this._active.forEach((e=>e.fixed_update(t)))}draw(t){this._active.forEach((e=>{e.draw(t)}))}frameDebug(t){this._active.length&&this._active.forEach((e=>e.frameDebug(t)))}frameEnd(t){this._active.length&&this._active.forEach((e=>e.frameEnd(t))),this._busy=!1;for(let t=0;t<this._pending.length;++t){const e=this._pending[t];e.scene[e.action](e.data)}this._pending.length=0}}const br={};function mr(t,e){"function"==typeof e&&(e={make:e}),br[t]=e}class yr{constructor(t={}){if(this.parent=null,this.scene=null,this.children=[],this.events=new tr(this),this._style=new cr,this._data={},this.classes=[],this._props={needsDraw:!0,needsStyle:!0,hover:!1},this._attrs={},t.id&&this.attr("id",t.id),this.attr("tag",t.tag||"widget"),this.bounds=new et(t),this._style.set(t),t.class&&(this.classes=t.class.split(/ +/g).map((t=>t.trim()))),t.tabStop&&this.prop("tabStop",!0),t.disabled&&this.prop("disabled",!0),t.hidden&&(this.hidden=!0),t.data&&(this._data=t.data),t.action=t.action||t.id,t.action){if(!0===t.action){if(!t.id)throw new Error("boolean action requires id.");t.action=t.id}this.attr("action",t.action)}["create","input","update","draw","destroy","keypress","mouseenter","mousemove","mouseleave","click"].forEach((e=>{e in t&&this.on(e,t[e])})),t.on&&Object.entries(t.on).forEach((([t,e])=>this.on(t,e))),t.parent?this.setParent(t.parent,t):t.scene&&t.scene.addChild(this,t)}get needsDraw(){return!!this.scene&&this.scene.needsDraw}set needsDraw(t){t&&this.scene&&(this.scene.needsDraw=t)}get tag(){return this._attrStr("tag")}get id(){return this._attrStr("id")}data(...t){if(0==t.length)return this._data;if(2==t.length)return this._setDataItem(t[0],t[1]),this.needsDraw=!0,this;if("string"==typeof t[0]){if(Array.isArray(this._data))throw new Error("Cannot access fields of array data.");return this._data[t[0]]}return this._setData(t[0]),this.needsDraw=!0,this}_setData(t){this._data=t}_setDataItem(t,e){if(Array.isArray(this._data))throw new Error("Cannot set field in array data.");this._data[t]=e}pos(t,e){return void 0===t?this.bounds:("number"==typeof t?(this.bounds.x=t,this.bounds.y=e||0):(this.bounds.x=t.x,this.bounds.y=t.y),this.needsDraw=!0,this)}updatePos(t){(this.parent||this.scene)&&(t.centerX||t.center?this.centerX():t.left?this.left(t.left):t.right?this.right(t.right):t.x&&(this.bounds.x=t.x),t.centerY||t.center?this.centerY():t.top?this.top(t.top):t.bottom?this.bottom(t.bottom):t.y&&(this.bounds.y=t.y))}contains(...t){return!this.hidden&&(!!this.bounds.contains(t[0],t[1])||this.children.some((e=>e.contains(t[0],t[1]))))}center(t){return this.centerX(t).centerY(t)}centerX(t){const e=t||(this.parent?this.parent.bounds:this.scene);if(!e)throw new Error("Need parent or scene to apply center.");if("x"in e){const t=this.bounds.width,i=Math.round((e.width-t)/2);this.bounds.x=e.x+i}else this.bounds.x=Math.round((e.width-this.bounds.width)/2);return this}centerY(t){const e=t||(this.parent?this.parent.bounds:this.scene);if(!e)throw new Error("Need parent or scene to apply center.");if("y"in e){const t=this.bounds.height,i=Math.round((e.height-t)/2);this.bounds.y=e.y+i}else this.bounds.y=Math.round((e.height-this.bounds.height)/2);return this}left(t){const e=this.parent?this.parent.bounds.left:0;return this.bounds.left=e+t,this}right(t){return this.parent?this.bounds.right=this.parent.bounds.right+t:this.scene?this.bounds.right=this.scene.width+t-1:this.bounds.left=0,this}top(t){const e=this.parent?this.parent.bounds.top:0;return this.bounds.top=e+t,this}bottom(t){return this.parent?this.bounds.bottom=this.parent.bounds.bottom+t-1:this.scene?this.bounds.bottom=this.scene.height+t-1:this.bounds.top=0,this}resize(t,e){return this.bounds.width=t||this.bounds.width,this.bounds.height=e||this.bounds.height,this.needsDraw=!0,this}style(...t){if(0==t.length)return this._style;if("string"!=typeof t[0])this._style.set(t[0]);else{if(void 0===t[1]){return(this._used||this._style).get(t[0])}this._style.set(t[0],t[1])}return this.needsStyle=!0,this}addClass(t){return t.split(/ +/g).forEach((t=>{this.classes.includes(t)||this.classes.push(t)})),this}removeClass(t){return t.split(/ +/g).forEach((t=>{U(this.classes,t)})),this}hasClass(t){const e=t.split(/ +/g);return Y(this.classes,e)}toggleClass(t){return t.split(/ +/g).forEach((t=>{this.classes.includes(t)?U(this.classes,t):this.classes.push(t)})),this}attr(t,e){return void 0===e?this._attrs[t]:(this._attrs[t]=e,this)}_attrInt(t){const e=this._attrs[t]||0;return"number"==typeof e?e:"string"==typeof e?Number.parseInt(e):e?1:0}_attrStr(t){const e=this._attrs[t]||"";return"string"==typeof e?e:"number"==typeof e?""+e:e?"true":"false"}_attrBool(t){return!!this._attrs[t]}text(t){return void 0===t?this._attrStr("text"):(this.attr("text",t),this)}prop(t,e){if(void 0===e)return this._props[t];return this._props[t]!==e&&this._setProp(t,e),this}_setProp(t,e){this._props[t]=e,this.needsStyle=!0}_propInt(t){const e=this._props[t]||0;return"number"==typeof e?e:"string"==typeof e?Number.parseInt(e):e?1:0}_propStr(t){const e=this._props[t]||"";return"string"==typeof e?e:"number"==typeof e?""+e:e?"true":"false"}_propBool(t){return!!this._props[t]}toggleProp(t){const e=!!this._props[t];return this.prop(t,!e),this}incProp(t,e=1){let i=this.prop(t)||0;return"boolean"==typeof i?i=i?1:0:"string"==typeof i&&(i=Number.parseInt(i)||0),i+=e,this.prop(t,i),this}get hovered(){return!!this.prop("hover")}set hovered(t){this.prop("hover",t)}get disabled(){let t=this;for(;t;){if(t.prop("disabled"))return!0;t=t.parent}return!1}set disabled(t){this.prop("disabled",t)}get hidden(){let t=this;for(;t;){if(t.prop("hidden"))return!0;t=t.parent}return!1}set hidden(t){this.prop("hidden",t),!t&&this._used&&0==this._used.opacity&&(this._used.opacity=100),t&&this.scene&&this.scene.focused===this?this.scene.nextTabStop():!t&&this.scene&&null===this.scene.focused&&this.scene.setFocusWidget(this),this.emit(t?"hide":"show")}get needsStyle(){return this._propBool("needsStyle")}set needsStyle(t){this._props.needsStyle=t,t&&(this.needsDraw=!0)}get focused(){return!!this.prop("focus")}focus(t=!1){this.prop("focus")||(this.prop("focus",!0),this.emit("focus",{reverse:t}))}blur(t=!1){this.prop("focus")&&(this.prop("focus",!1),this.emit("blur",{reverse:t}))}setParent(t,e){if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);if(t<0)throw new Error("Error in parent/child setup!");this.parent.children.splice(t,1)}if(t){if(this.scene!==t.scene&&(this.scene&&this.scene._detach(this),t.scene&&t.scene._attach(this),e&&e.focused&&this.scene.setFocusWidget(this)),e&&e.first)t.children.unshift(this);else if(e&&e.before){let i=-1;i="string"==typeof e.before?t.children.findIndex((t=>t.id===e.before)):t.children.indexOf(e.before),i<0?t.children.unshift(this):t.children.splice(i,0,this)}else if(e&&e.after){let i=-1;i="string"==typeof e.after?t.children.findIndex((t=>t.id===e.before)):t.children.indexOf(e.after),i<0?t.children.push(this):t.children.splice(i+1,0,this)}else t.children.push(this);this.parent=t}else this.scene&&this.scene._detach(this),this.parent=null;e&&(this.parent||this.scene)&&this.updatePos(e)}}addChild(t){this.children.includes(t)||t.setParent(this)}removeChild(t){this.children.includes(t)&&t.setParent(null)}childAt(t,e){Q(t)||(t={x:t,y:e});for(let e of this.children)if(e.contains(t))return e;return null}getChild(t){return this.children.find((e=>e.id===t))||null}on(t,e){return"keypress"===t&&this.prop("tabStop",!0),this.events.on(t,e)}once(t,e){return"keypress"===t&&this.prop("tabStop",!0),this.events.once(t,e)}off(t,e){this.events.off(t,e)}emit(t,...e){return this.events.emit(t,...e)}action(t){if(t&&t.defaultPrevented)return;this.emit("action")&&(null==t||t.stopPropagation());const e=this._attrStr("action");e&&e.length&&this.scene&&this.scene.emit(e,this)&&(null==t||t.stopPropagation())}input(t){this.emit("input",t),t.defaultPrevented||t.propagationStopped||(t.type===Qs?this.keypress(t):t.type===Zs?this.mousemove(t):t.type===Js&&this.click(t))}_mouseenter(t){this.bounds.contains(t)&&(this.hovered||(this.hovered=!0,this.emit("mouseenter",t)))}mousemove(t){for(let e of this.children)e.mousemove(t);this.bounds.contains(t)&&!this.hidden?(this._mouseenter(t),this._mousemove(t)):this._mouseleave(t)}_mousemove(t){this.emit("mousemove",t)}_mouseleave(t){this.hovered&&(this.bounds.contains(t)||(this.hovered=!1,this.emit("mouseleave",t)))}click(t){if(this.disabled||this.hidden)return;t.target=this;const e=this.childAt(t);e&&e.click(t),this.bounds.contains(t)&&(t.propagationStopped||(this._click(t),t.defaultPrevented||this.action(t)))}_click(t){this.events.emit("click",t)}keypress(t){if(this.hidden||this.disabled)return;let e=this;for(;e&&!t.propagationStopped;)t.dispatch(e.events),e=e.parent}draw(t){this.needsStyle&&this.scene&&(this._used=this.scene.styles.computeFor(this),this.needsStyle=!1),this.hidden||(this._draw(t),this.emit("draw",t),this.children.forEach((e=>e.draw(t))))}_draw(t){this._drawFill(t)}_drawFill(t){const e=this.bounds;t.fillRect(e.x,e.y,e.width,e.height," ",this._used.bg,this._used.bg)}update(t){this.emit("update",t)}fixed_update(t){this.emit("fixed_update",t)}destroy(){this.parent&&this.setParent(null),this.scene&&this.scene._detach(this),this.children.forEach((t=>t.destroy())),this.children=[],this._used=null}}function wr(t,e="left"){if(!(t.children.length<2))if("left"===e){const e=t.children.reduce(((t,e)=>Math.min(t,e.bounds.left)),999);t.children.forEach((t=>t.bounds.left=e))}else if("right"===e){const e=t.children.reduce(((t,e)=>Math.max(t,e.bounds.right)),0);t.children.forEach((t=>t.bounds.right=e))}else{const e=t.children.reduce(((t,e)=>Math.max(t,e.bounds.right)),0),i=t.children.reduce(((t,e)=>Math.min(t,e.bounds.left)),999),s=i+Math.floor((e-i)/2);t.children.forEach((t=>{t.bounds.center=s}))}}function vr(t,e=0){if(t.children.length<2)return;let i=t.children.reduce(((t,e)=>Math.min(t,e.bounds.top)),999);t.children.slice().sort(((t,e)=>t.bounds.top-e.bounds.top)).forEach((t=>{t.bounds.top=i,i=t.bounds.bottom+e}))}function xr(t,e=0){t.children.length<1||(t.bounds.copy(t.children[0].bounds),t.children.forEach((e=>{t.bounds.include(e.bounds)})),t.bounds.pad(e))}class Er extends yr{constructor(t){super(t),this._text="",this._lines=[],this._fixedWidth=!1,this._fixedHeight=!1,this._fixedHeight=!!t.height,this._fixedWidth=!!t.width,this.bounds.width=t.width||0,this.bounds.height=t.height||1,this.text(t.text||"")}text(t){if(void 0===t)return this._text;this._text=t;let e=this._fixedWidth?this.bounds.width:this.scene?this.scene.width:100;return this._lines=vs(this._text,e),this._fixedWidth||(this.bounds.width=this._lines.reduce(((t,e)=>Math.max(t,as(e))),0)),this._fixedHeight?this._lines.length>this.bounds.height&&(this._lines.length=this.bounds.height):this.bounds.height=Math.max(1,this._lines.length),this.needsDraw=!0,this}resize(t,e){return super.resize(t,e),this._fixedWidth=t>0,this._fixedHeight=e>0,this.text(this._text),this}addChild(){throw new Error("Text widgets cannot have children.")}_draw(t){super._draw(t);let e=0;"bottom"===this._used.valign?e=this.bounds.height-this._lines.length:"middle"===this._used.valign&&(e=Math.floor((this.bounds.height-this._lines.length)/2)),this._lines.forEach(((i,s)=>{t.drawText(this.bounds.x,this.bounds.y+s+e,i,this._used.fg,-1,this.bounds.width,this._used.align)}))}}class Ir extends yr{constructor(t){super(t),this.ascii=!1,(t.ascii||t.fg&&!1!==t.ascii)&&(this.ascii=!0)}contains(){return!1}_draw(t){super._draw(t);const e=this.bounds.width,i=this.bounds.height,s=this.bounds.x,n=this.bounds.y,r=this.ascii;return Ar(t,s,n,e,i,this._used,r),!0}}function Ar(t,e,i,s,n,r,h){const o=r.fg,a=r.bg;if(h){for(let r=1;r<s;++r)t.draw(e+r,i,"-",o,a),t.draw(e+r,i+n-1,"-",o,a);for(let r=1;r<n;++r)t.draw(e,i+r,"|",o,a),t.draw(e+s-1,i+r,"|",o,a);t.draw(e,i,"+",o,a),t.draw(e+s-1,i,"+",o,a),t.draw(e,i+n-1,"+",o,a),t.draw(e+s-1,i+n-1,"+",o,a)}else gt(e,i,s,n,((e,i)=>{t.draw(e,i," ",a,a)}))}function Sr(t){if(!t)return[0,0,0,0];if(!0===t)return[1,1,1,1];if("number"==typeof t)return[t,t,t,t];if(1==t.length){const e=t[0];return[e,e,e,e]}if(2==t.length){const[e,i]=t;return[e,i,e,i]}throw new Error("Invalid pad: "+t)}gr.add("dialog",{bg:"darkest_gray",fg:"light_gray"});class Tr extends yr{constructor(t){super((t.tag=t.tag||Tr.default.tag,t)),this.legend=null;let e=t.border||Tr.default.border;this.attr("border",e);const i=Sr(t.pad||Tr.default.pad);if(this.attr("padTop",i[0]),this.attr("padRight",i[1]),this.attr("padBottom",i[2]),this.attr("padLeft",i[3]),"none"!==e)for(let t=0;t<4;++t)i[t]+=1;this._adjustBounds(i),this.attr("legendTag",t.legendTag||Tr.default.legendTag),this.attr("legendClass",t.legendClass||t.class||Tr.default.legendClass),this.attr("legendAlign",t.legendAlign||Tr.default.legendAlign),this._addLegend(t)}_adjustBounds(t){return this.bounds.width+=t[1]+t[3],this.bounds.height+=t[0]+t[2],this.bounds.x-=t[3],this.bounds.y-=t[0],this}get _innerLeft(){const t=this._attrStr("border"),e=this._attrInt("padLeft");return this.bounds.x+e+("none"===t?0:1)}get _innerWidth(){const t=this._attrStr("border"),e=this._attrInt("padLeft")+this._attrInt("padRight");return this.bounds.width-e-("none"===t?0:2)}get _innerTop(){const t=this._attrStr("border"),e=this._attrInt("padTop");return this.bounds.y+e+("none"===t?0:1)}get _innerHeight(){const t=this._attrStr("border"),e=this._attrInt("padTop")+this._attrInt("padBottom");return this.bounds.height-e-("none"===t?0:2)}_addLegend(t){if(!t.legend)return"none"===this._attrStr("border")&&(this.bounds.height=0),this;const e="none"!==this._attrStr("border"),i=as(t.legend),s=this.bounds.width-(e?4:0),n=this._attrStr("legendAlign");let r=this.bounds.x+(e?2:0);return"center"===n?r+=Math.floor((s-i)/2):"right"===n&&(r+=s-i),this.legend=new Er({parent:this,text:t.legend,x:r,y:this.bounds.y,tag:this._attrStr("legendTag"),class:this._attrStr("legendClass")}),this.bounds.height=Math.max(1,this.bounds.height),this}_draw(t){super._draw(t);const e=this._attrStr("border");return"none"!==e&&(Ar(t,this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height,this._used,"ascii"===e),!0)}}Tr.default={tag:"dialog",border:"none",pad:!1,legendTag:"legend",legendClass:"",legendAlign:"left"};const Cr={create(){this.on("mousemove",(t=>{t.stopPropagation()})),this.on("click",(t=>{t.stopPropagation(),this.stop({click:!0})})),this.on("keypress",(t=>{t.stopPropagation(),this.stop({keypress:!0})}))},start(t){t.args&&(t.text=bs(t.text,t.args)),t.class=t.class||"alert",t.border=t.border||"ascii",t.pad=t.pad||1;const e=new Er(t);t.height||(t.height=e.bounds.height),t.width||(t.width=e.bounds.width),t.scene=this,t.center=!0;const i=new Tr(t);e.setParent(i,{center:!0}),t.waitForAck||this.wait(t.duration||3e3,(()=>this.stop({})))},stop(){this.children.forEach((t=>t.destroy())),this.children=[],this.timers.clear()}};mr("alert",Cr);class Mr extends Er{constructor(t){super((()=>{if(t.text=t.text||"",t.tabStop=void 0===t.tabStop||t.tabStop,t.tag=t.tag||"button",!t.text&&!t.width)throw new Error("Buttons must have text or width.");return 0==t.text.length&&(t.width=t.width||2),t})()),this.on("click",this.action.bind(this)),this.on("Enter",this.action.bind(this))}}const Lr={create(){this.on("keypress",(t=>{"Escape"===t.key?this.emit("CANCEL"):"Enter"===t.key&&this.emit("OK")})),this.on("OK",(()=>{this.stop(!0)})),this.on("CANCEL",(()=>{this.stop(!1)}))},start(t){t.class=t.class||"confirm",t.border=t.border||"ascii",t.pad=t.pad||1;const e=void 0!==t.opacity?t.opacity:50;this.bg=is.alpha(e),void 0===t.cancel||!0===t.cancel?t.cancel="Cancel":t.cancel||(t.cancel=""),t.ok=t.ok||"Ok";let i=t.buttonWidth||0;i||(i=Math.max(t.ok.length,t.cancel.length));const s=Math.max(t.width||0,2*i+2),n=new Er({scene:this,text:t.text,class:t.textClass||t.class,width:s,height:t.height}).center();Object.assign(t,{scene:this,width:n.bounds.width+2,height:n.bounds.height+2,x:n.bounds.x,y:n.bounds.y,tag:"confirm"});const r=new Tr(t);if(r.addChild(n),new Mr({parent:r,text:t.ok,class:t.okClass||t.class,width:i,id:"OK",right:-1-r._attrInt("padRight"),bottom:-1-r._attrInt("padBottom")}),t.cancel.length&&new Mr({parent:r,text:t.cancel,class:t.cancelClass||t.class,width:i,id:"CANCEL",left:1+r._attrInt("padLeft"),bottom:-1-r._attrInt("padBottom")}),t.done){const e=t.done;this.once("OK",(()=>{e(!0)})),this.once("CANCEL",(()=>{e(!1)}))}},stop(){this.children.forEach((t=>t.destroy())),this.children=[]}};mr("confirm",Lr),gr.add("input",{bg:"light_gray",fg:"black",align:"left",valign:"top"}),gr.add("input:invalid",{fg:"red"}),gr.add("input:empty",{fg:"darkest_green"}),gr.add("input:focus",{bg:"lighter_gray"});class kr extends Er{constructor(t){super((t.text=t.text||"",t.tag=t.tag||"input",t.tabStop=void 0===t.tabStop||t.tabStop,t.width=t.width||t.maxLength||Math.max(t.minLength||0,10),t)),this.minLength=0,this.maxLength=0,this.numbersOnly=!1,this.min=0,this.max=0,this.attr("default",this._text),this.attr("placeholder",t.placeholder||kr.default.placeholder),t.numbersOnly?(this.numbersOnly=!0,this.min=t.min||0,this.max=t.max||0):(this.minLength=t.minLength||0,this.maxLength=t.maxLength||0),t.required&&(this.attr("required",!0),this.prop("required",!0)),t.disabled&&(this.attr("disabled",!0),this.prop("disabled",!0)),this.prop("valid",this.isValid()),this.on("blur",(()=>this.action())),this.reset()}reset(){this.text(this._attrStr("default"))}_setProp(t,e){super._setProp(t,e),this._props.valid=this.isValid()}isValid(){const t=this._text||"";if(this.numbersOnly){const e=Number.parseInt(t);return!(void 0!==this.min&&e<this.min)&&(!(void 0!==this.max&&e>this.max)&&e>0)}const e=Math.max(this.minLength,this.prop("required")?1:0);return t.length>=e&&(!this.maxLength||t.length<=this.maxLength)}keypress(t){if(!t.key)return;const e=this.numbersOnly?["0","9"]:[" ","~"];return"Enter"===t.key&&this.isValid()?(this.action(),this.scene&&this.scene.nextTabStop(),void t.stopPropagation()):"Delete"==t.key||"Backspace"==t.key?(this._text.length&&(this.text(gs(this._text,this._text.length-1,1)),this.emit("change"),this._used&&this._draw(this.scene.buffer)),void t.stopPropagation()):void(rn(t)||(t.key>=e[0]&&t.key<=e[1]&&(!this.maxLength||this._text.length<this.maxLength)&&(this.text(this._text+t.key),this.emit("change"),this._used&&this._draw(this.scene.buffer)),t.stopPropagation()))}click(t){if(this.disabled||this.hidden)return;t.target=this;const e=this.childAt(t);e&&e.click(t),this.bounds.contains(t)&&(t.propagationStopped||t.dispatch(this.events))}text(t){return void 0===t?this._text:(super.text(t),this.prop("empty",0===this._text.length),this.prop("valid",this.isValid()),this)}_draw(t,e=!1){this._drawFill(t);let i=0;this._used&&("bottom"===this._used.valign?i=this.bounds.height-this._lines.length:"middle"===this._used.valign&&(i=Math.floor((this.bounds.height-this._lines.length)/2)));let s=this._text;0==s.length&&(s=this._attrStr("placeholder")),this._text.length>this.bounds.width&&(s=this._text.slice(this._text.length-this.bounds.width));const n=this._used?this._used.fg:"white",r=this._used?this._used.align:"left";return t.drawText(this.bounds.x,this.bounds.y+i,s,n,-1,this.bounds.width,r),!0}}kr.default={tag:"input",width:10,placeholder:""};const Rr={create(){this.on("mousemove",(t=>{t.stopPropagation()})),this.on("click",(t=>{t.stopPropagation()})),this.on("keypress",(t=>{t.stopPropagation()})),this.on("INPUT",(()=>{const t=this.get("INPUT");this.stop(t?t.text():null)})),this.on("Escape",(()=>{this.stop(null)}))},start(t){t.class=t.class||"confirm",t.border=t.border||"ascii",t.pad=t.pad||0;const e=void 0!==t.opacity?t.opacity:50;this.bg=is.alpha(e);const i=new Er({text:t.prompt,class:t.textClass||t.class,width:t.width,height:t.height});Object.assign(t,{width:i.bounds.width+2,height:i.bounds.height+1,x:i.bounds.x-1,y:i.bounds.y-1,tag:"inputbox",scene:this,center:!0});const s=new Tr(t);i.setParent(s,{top:1,centerX:!0});let n=s._innerWidth-2,r=i.bounds.left;if(t.label){const e=new Er({parent:s,text:t.label,class:t.labelClass||t.class,tag:"label",x:r,bottom:-1});r+=e.bounds.width+1,n-=e.bounds.width+1}const h=new kr({parent:s,class:t.inputClass||t.class,width:n,id:"INPUT",x:r,bottom:-1});this.once("INPUT",(()=>{t.done&&t.done(h.text())})),this.once("Escape",(()=>{t.done&&t.done(null)}))},stop(){this.children.forEach((t=>t.destroy())),this.children=[]}};mr("prompt",Rr);const Or={create(){this.on("click",(()=>{this.stop()})),this.on("Escape",(()=>{this.stop()}))},start(t){if(!t.menu)throw new Error("Must supply a menu to show!");this.addChild(t.menu),this.events.onUnhandled=(e,...i)=>{t.origin.emit(e,...i)}},stop(){this.children=[]}};mr("menu",Or);var Dr=Object.freeze({__proto__:null,AlertScene:Cr,ConfirmScene:Lr,PromptScene:Rr,MenuScene:Or});class Nr extends Tr{constructor(t){super((t.tag=t.tag||Nr.default.tag,t.border=t.border||Nr.default.border,t.legendTag=t.legendTag||Nr.default.legendTag,t.legendClass=t.legendClass||Nr.default.legendClass,t.legendAlign=t.legendAlign||Nr.default.legendAlign,t.width=t.width||0,t.height=t.height||0,t)),this.fields=[],this.attr("separator",t.separator||Nr.default.separator),this.attr("dataTag",t.dataTag||Nr.default.dataTag),this.attr("dataClass",t.dataClass||Nr.default.dataClass),this.attr("dataWidth",t.dataWidth),this.attr("labelTag",t.labelTag||Nr.default.labelTag),this.attr("labelClass",t.labelClass||Nr.default.labelClass),this.attr("labelWidth",this._innerWidth-t.dataWidth),this._addLegend(t)}_adjustBounds(t){return this.bounds.width=Math.max(this.bounds.width,t[1]+t[3]),this.bounds.height=Math.max(this.bounds.height,t[0]+t[2]),this}get _labelLeft(){const t=this._attrStr("border"),e=this._attrInt("padLeft");return this.bounds.x+e+("none"===t?0:1)}get _dataLeft(){return this._labelLeft+this._attrInt("labelWidth")}get _nextY(){let t="none"===this._attrStr("border")?0:1;const e=this._attrInt("padBottom");return this.bounds.bottom-t-e}add(t,e){const i=this._attrStr("separator"),s=cs(t,this._attrInt("labelWidth")-i.length," ")+i;new Er({parent:this,text:s,x:this._labelLeft,y:this._nextY,width:this._attrInt("labelWidth"),tag:this._attrStr("labelTag"),class:this._attrStr("labelClass")}),"string"==typeof e&&(e={format:e}),e.x=this._dataLeft,e.y=this._nextY,e.width=this._attrInt("dataWidth"),e.tag=e.tag||this._attrStr("dataTag"),e.class=e.class||this._attrStr("dataClass"),e.parent=this;const n=new Pr(e);return this.bounds.height+=1,this.fields.push(n),this}_setData(t){super._setData(t),this.fields.forEach((e=>e.format(t)))}_setDataItem(t,e){super._setDataItem(t,e),this.fields.forEach((t=>t.format(e)))}}Nr.default={tag:"fieldset",border:"none",separator:" : ",pad:!1,legendTag:"legend",legendClass:"legend",legendAlign:"left",labelTag:"label",labelClass:"",dataTag:"field",dataClass:""};class Pr extends Er{constructor(t){super((()=>{const e=t;return e.tag=e.tag||"field",e.text="",e})()),"string"==typeof t.format?this._format=_s(t.format):this._format=t.format}format(t){const e=this._format(t)||"";return this.text(e)}}class Fr extends yr{constructor(t){super((t.tag=t.tag||"ol",t)),this._fixedWidth=!1,this._fixedHeight=!1,this._fixedHeight=!!t.height,this._fixedWidth=!!t.width,this.prop("pad",t.pad||Fr.default.pad)}addChild(t){return t.bounds.x=this.bounds.x+2,this._fixedHeight||(t.bounds.y=this.bounds.bottom-2,this.bounds.height+=t.bounds.height),this._fixedWidth?t.bounds.width=Math.min(t.bounds.width,this.bounds.width-4):t.bounds.width>this.bounds.width-4&&(this.bounds.width=t.bounds.width+4),super.addChild(t)}_draw(t){return this._drawFill(t),this.children.forEach(((e,i)=>{this._drawBulletFor(e,t,i)})),!0}_getBullet(t){return""+(t+1)}_drawBulletFor(t,e,i){const s=this._getBullet(i),n=this._attrInt("pad")+s.length,r=t.bounds.x-n,h=t.bounds.y;e.drawText(r,h,s,t._used.fg,t._used.bg,n)}}Fr.default={pad:1};class Br extends Fr{constructor(t){super((t.tag=t.tag||"ul",t)),this.prop("bullet",t.bullet||Br.default.bullet),this.prop("pad",t.pad||Br.default.pad)}_getBullet(t){return this._attrStr("bullet")}}Br.default={bullet:"•",pad:1},gr.add("datatable",{bg:"black"}),gr.add("td:selected",{bg:"gray"});class Wr{constructor(t){this.format=B,this.width=t.width||jr.default.columnWidth,"function"==typeof t.format?this.format=t.format:t.format&&(this.format=_s(t.format)),this.header=t.header||"",this.headerTag=t.headerTag||jr.default.headerTag,this.empty=t.empty||jr.default.empty,this.dataTag=t.dataTag||jr.default.dataTag}addHeader(t,e,i,s){const n=new Er({parent:t,x:e,y:i,class:t.classes.join(" "),tag:t._attrStr("headerTag"),width:this.width,height:t.rowHeight,text:this.header});return n.prop("row",-1),n.prop("col",s),n}addData(t,e,i,s,n,r){let h;h=Array.isArray(e)?""+(e[n]||this.empty):"object"!=typeof e?""+e:this.format(e),""===h&&(h=this.empty);const o=new Er({parent:t,text:h,x:i,y:s,class:t.classes.join(" "),tag:t._attrStr("dataTag"),width:this.width,height:t.rowHeight});return o.on("mouseenter",(()=>{t.select(n,r)})),o.prop(r%2==0?"even":"odd",!0),o.prop("row",r),o.prop("col",n),o}addEmpty(t,e,i,s,n){return this.addData(t,[],e,i,s,n)}}class jr extends yr{constructor(t){super((t.tag=t.tag||jr.default.tag,t.tabStop=void 0===t.tabStop||t.tabStop,t.data?Array.isArray(t.data)||(t.data=[t.data]):t.data=[],t)),this.columns=[],this.showHeader=!1,this.rowHeight=1,this.selectedRow=-1,this.selectedColumn=0,this.size=t.size||(this.parent?this.parent.bounds.height:this.scene?this.scene.height:0),this.bounds.width=0,t.columns.forEach((t=>{const e=new Wr(t);this.columns.push(e),this.bounds.width+=e.width})),t.border?!0===t.border&&(t.border="ascii"):!1===t.border&&(t.border="none"),this.attr("border",t.border||jr.default.border),this.rowHeight=t.rowHeight||1,this.bounds.height=1,this.attr("wrap",void 0===t.wrap?jr.default.wrap:t.wrap),this.attr("header",void 0===t.header?jr.default.header:t.header),this.attr("headerTag",t.headerTag||jr.default.headerTag),this.attr("dataTag",t.dataTag||jr.default.dataTag),this.attr("prefix",t.prefix||jr.default.prefix),this.attr("select",t.select||jr.default.select),this.attr("hover",t.hover||jr.default.hover),this._setData(this._data)}get selectedData(){if(!(this.selectedRow<0))return this._data[this.selectedRow]}select(t,e){if(!this._data||0==this._data.length)return this.selectedRow=this.selectedColumn=0,this;this.attr("wrap")&&((t<0||t>=this.columns.length)&&(t+=this.columns.length,t%=this.columns.length),(e<0||e>=this._data.length)&&(e+=this._data.length,e%=this._data.length)),t=this.selectedColumn=W(t,0,this.columns.length-1),e=this.selectedRow=W(e,0,this._data.length-1);const i=this._attrStr("select");return"none"===i?this.children.forEach((t=>{t.prop("selected",!1)})):"row"===i?this.children.forEach((t=>{const i=e==t.prop("row");t.prop("selected",i)})):"column"===i?this.children.forEach((e=>{const i=t==e.prop("col");e.prop("selected",i)})):"cell"===i&&this.children.forEach((i=>{const s=t==i.prop("col")&&e==i.prop("row");i.prop("selected",s)})),this.emit("change",{row:e,col:t,data:this.selectedData}),this}selectNextRow(){return this.select(this.selectedColumn,this.selectedRow+1)}selectPrevRow(){return this.select(this.selectedColumn,this.selectedRow-1)}selectNextCol(){return this.select(this.selectedColumn+1,this.selectedRow)}selectPrevCol(){return this.select(this.selectedColumn-1,this.selectedRow)}blur(t){return this.emit("change",{col:this.selectedColumn,row:this.selectedRow,data:this.selectedData}),super.blur(t)}_setData(t){this._data=t;for(let t=this.children.length-1;t>=0;--t){const e=this.children[t];e.tag!==this.attr("headerTag")&&this.removeChild(e)}const e="none"!==this.attr("border")?1:0;let i=this.bounds.x+e,s=this.bounds.y+e;return this.attr("header")&&(this.columns.forEach(((t,n)=>{t.addHeader(this,i,s,n),i+=t.width+e})),s+=this.rowHeight+e),this._data.forEach(((t,n)=>{n>=this.size||(i=this.bounds.x+e,this.columns.forEach(((r,h)=>{r.addData(this,t,i,s,h,n),i+=r.width+e})),s+=this.rowHeight+e)})),0==this._data.length?(i=this.bounds.x+e,this.columns.forEach(((t,n)=>{t.addEmpty(this,i,s,n,0),i+=t.width+e})),s+=1,this.select(-1,-1)):this.select(0,0),this.bounds.height=s-this.bounds.y,this.bounds.width=i-this.bounds.x,this.needsStyle=!0,this}_draw(t){return this._drawFill(t),this.children.forEach((e=>{e._propInt("row")>=this.size||"none"!==this.attr("border")&&Ar(t,e.bounds.x-1,e.bounds.y-1,e.bounds.width+2,e.bounds.height+2,this._used,"ascii"==this.attr("border"))})),!0}keypress(t){return!!t.key&&(t.dir?this.dir(t):"Enter"===t.key&&(this.action(t),!0))}dir(t){return!!t.dir&&(1==t.dir[1]?this.selectNextRow():-1==t.dir[1]&&this.selectPrevRow(),1==t.dir[0]?this.selectNextCol():-1==t.dir[0]&&this.selectPrevCol(),!0)}}jr.default={columnWidth:10,header:!0,empty:"",tag:"datatable",headerTag:"th",dataTag:"td",select:"cell",hover:"select",prefix:"none",border:"ascii",wrap:!0};class Vr extends jr{constructor(t){super((()=>{const e=t;return"none"!==t.border&&t.width&&(t.width-=2),e.columns=[Object.assign({},t)],t.header&&t.header.length||(e.header=!1),e})())}}class Yr extends yr{constructor(t){super((t.tag=t.tag||Yr.default.tag,t.class=t.class||Yr.default.class,t.tabStop=void 0===t.tabStop||t.tabStop,t)),this._selectedIndex=0,Array.isArray(t.buttonClass)?this.attr("buttonClass",t.buttonClass.join(" ")):this.attr("buttonClass",t.buttonClass||Yr.default.buttonClass),this.attr("buttonTag",t.buttonTag||Yr.default.buttonTag),this.attr("marker",t.marker||Yr.default.marker),this._initButtons(t),this.bounds.height=this.children.length,this.on("mouseenter",(t=>(this.children.forEach((e=>{e.contains(t)?e.expand():e.collapse()})),!0))),this.on("dir",(t=>{t.dir&&(t.dir[0]<0?this.hide():t.dir[0]>0?this.expandItem():t.dir[1]<0?this.prevItem():t.dir[1]>0&&this.nextItem(),t.stopPropagation())})),this.on(["Enter"," "],(()=>{this.children[this._selectedIndex].action(),this.hide()}))}_initButtons(t){this.children=[];const e=t.buttons,i=this._attrStr("marker"),s=Object.entries(e);this.bounds.width=Math.max(t.minWidth||0,this.bounds.width,s.reduce(((t,[e,s])=>{const n=as(e)+("string"==typeof s?0:i.length);return Math.max(t,n)}),0)),s.forEach((([t,e],s)=>{const n={x:this.bounds.x,y:this.bounds.y+s,class:this._attrStr("buttonClass"),tag:this._attrStr("buttonTag"),width:this.bounds.width,height:1,buttons:e,text:t,parent:this};"string"==typeof e?n.action=e:n.text=cs(t,this.bounds.width-i.length," ")+i;const r=new Hr(n);r.on("mouseenter",(()=>{this.emit("change")})),r.on("click",(()=>{this.hide()})),r.menu&&r.menu.on("hide",(()=>{this.scene.setFocusWidget(this)}))}))}show(){this.hidden=!1,this._selectedIndex=0,this.scene.setFocusWidget(this),this.emit("show")}hide(){this.hidden=!0,this.emit("hide")}nextItem(){++this._selectedIndex,this._selectedIndex>=this.children.length&&(this._selectedIndex=0)}prevItem(){--this._selectedIndex,this._selectedIndex<0&&(this._selectedIndex=this.children.length-1)}expandItem(){return this.children[this._selectedIndex].expand()}selectItemWithKey(t){let e=!1;this.children.forEach((i=>{e||i.text().startsWith(t)&&(e=!0)}))}}Yr.default={tag:"menu",class:"",buttonClass:"",buttonTag:"mi",marker:" ▶",minWidth:4};class Hr extends Er{constructor(t){super((t.tag=t.tag||"mi",t.tabStop=!1,t)),this.menu=null,"string"!=typeof t.buttons&&(this.menu=this._initMenu(t),this.on("mouseenter",(()=>{this.menu.hidden=!1,this.menu.emit("change")})),this.on("mouseleave",((t,e,i)=>{var s;(null===(s=this.parent)||void 0===s?void 0:s.bounds.contains(i))&&(this.menu.hidden=!0)})),this.on("click",(()=>!0))),this.on("click",this.action.bind(this))}collapse(){this.menu&&this.menu.hide()}expand(){return this.menu?(this.menu.show(),this.menu):null}_setMenuPos(t,e){t.x=this.bounds.x+this.bounds.width,t.y=this.bounds.y;const i=Object.keys(e.buttons).length;this.scene&&t.y+i>=this.scene.height&&(t.y=this.scene.height-i-1)}_initMenu(t){if("string"==typeof t.buttons)return null;const e={x:this.bounds.x+this.bounds.width,y:this.bounds.y,class:t.class,tag:t.tag||"mi",buttons:t.buttons};this._setMenuPos(e,t),e.parent=this;const i=new Yr(e);return i.hidden=!0,i}}class Ur extends yr{constructor(t){super((t.tabStop=!1,t.tag=t.tag||"menu",t)),t.buttonClass?Array.isArray(t.buttonClass)?this.attr("buttonClass",t.buttonClass.join(" ")):this.attr("buttonClass",t.buttonClass):this.attr("buttonClass",Ur.default.buttonClass),this.attr("buttonTag",t.buttonTag||Ur.default.buttonTag),t.menuClass?Array.isArray(t.menuClass)?this.attr("menuClass",t.menuClass.join(" ")):this.attr("menuClass",t.menuClass):this.attr("menuClass",Ur.default.menuClass),this.attr("menuTag",t.menuTag||Ur.default.menuTag),this.attr("prefix",t.prefix||Ur.default.prefix),this.attr("separator",t.separator||Ur.default.separator),this.bounds.height=1,this._initButtons(t)}_initButtons(t){const e=Object.entries(t.buttons),i=this._attrStr("buttonTag"),s=this._attrStr("buttonClass");let n=this.bounds.x;const r=this.bounds.y;e.forEach((([t,e],h)=>{const o=0==h?this._attrStr("prefix"):this._attrStr("separator");new Er({parent:this,text:o,x:n,y:r}),n+=o.length,this.bounds.width+=o.length;const a=new Mr({parent:this,id:t,text:t,x:n,y:r,tag:i,class:s});n+=a.bounds.width,this.bounds.width+=a.bounds.width;let l=null;"string"!=typeof e&&(l=new Yr({buttons:e,buttonClass:this._attrStr("menuClass"),buttonTag:this._attrStr("menuTag"),x:a.bounds.x,y:a.bounds.y+1}),a.data("menu",l)),a.on(["click","Enter"," "],(()=>{"string"==typeof e?(this.emit(e),this.scene.emit(e)):this.scene.app.scenes.run("menu",{menu:l,origin:this.scene})}))}))}}Ur.default={buttonClass:"",buttonTag:"mi",menuClass:"",menuTag:"mi",prefix:" ",separator:" | "};class Xr extends yr{constructor(t){super((t.tag=t.tag||Xr.default.tag,t)),this._prompt=null,this._done=null,this.choiceWidth=t.choiceWidth,this.attr("border",t.border||Xr.default.border),this.attr("promptTag",t.promptTag||Xr.default.promptTag),this.attr("promptClass",t.promptClass||Xr.default.promptClass),this.attr("choiceTag",t.choiceTag||Xr.default.choiceTag),this.attr("choiceClass",t.choiceClass||Xr.default.choiceClass),this.attr("infoTag",t.infoTag||Xr.default.infoTag),this.attr("infoClass",t.infoClass||Xr.default.infoClass),this._addLegend(),this._addList(),this._addInfo(),t.prompt&&this.showPrompt(t.prompt)}get prompt(){return this._prompt}showPrompt(t,e){return this._prompt=t,t.choose(0),this._text.text(t.prompt(e)),this._list.data(t.choices()),this._info.text(t.info(e)),this.emit("prompt",this._prompt),new Promise((t=>this._done=t))}_addList(){return this._list=new Vr({parent:this,height:this.bounds.height-2,x:this.bounds.x+1,width:this.choiceWidth,y:this.bounds.y+1,dataTag:this._attrStr("choiceTag"),dataClass:this._attrStr("choiceClass"),tabStop:!0,border:"none",hover:"select"}),this._list.on("change",(()=>{if(!this._prompt)return!1;const t=this._prompt,e=this._list.selectedRow;t.choose(e),this._info.text(t.info()),this.emit("change",t)})),this._list.on("action",(()=>{if(!this._prompt)return!1;const t=this._prompt;t.choose(this._list.selectedRow),this.action(),this._done(t.value())})),this}_addInfo(){return this._info=new Er({parent:this,text:"",x:this.bounds.x+this.choiceWidth+2,y:this.bounds.y+1,width:this.bounds.width-this.choiceWidth-3,height:this.bounds.height-2,tag:this._attrStr("infoTag"),class:this._attrStr("infoClass")}),this}_addLegend(){return this._text=new Er({parent:this,text:"",width:this.bounds.width-4,x:this.bounds.x+2,y:this.bounds.y,tag:this._attrStr("promptTag"),class:this._attrStr("promptClass")}),this}_draw(t){let e=this.choiceWidth+2;const i=this.bounds.height;let s=this.bounds.x;const n=this.bounds.y,r="ascii"===this.attr("border");return Ar(t,s,n,e,i,this._used,r),e=this.bounds.width-this.choiceWidth-1,s=this.bounds.x+this.choiceWidth+1,Ar(t,s,n,e,i,this._used,r),!0}}Xr.default={tag:"choice",border:"ascii",promptTag:"prompt",promptClass:"",choiceTag:"ci",choiceClass:"",infoTag:"info",infoClass:""};class Gr extends Er{constructor(t){var e;super((t.tag=t.tag||"checkbox",t.tabStop=void 0===t.tabStop||t.tabStop,t)),this.attr("uncheck",t.uncheck||Gr.default.uncheck),this.attr("check",t.check||Gr.default.check),this.attr("pad",null!==(e=t.pad)&&void 0!==e?e:Gr.default.pad),this.attr("offValue",""),Array.isArray(t.value)?(this.attr("offValue",t.value[0]||""),this.attr("value",t.value[1]||Gr.default.value)):this.attr("value",t.value||Gr.default.value),this.bounds.width+=this._attrInt("pad"),t.checked&&this.prop("checked",!0),this.on("click",(t=>{t.defaultPrevented||this.toggleProp("checked")}))}value(){return this._propBool("checked")?this._attrStr("value"):this._attrStr("offValue")}text(t){return void 0===t?super.text():(super.text(t),this.bounds.width+=1+this._attrInt("pad"),this)}keypress(t){t.key&&(super.keypress(t),t.defaultPrevented||("Enter"===t.key||" "===t.key?(this.toggleProp("checked"),this.emit("change")):"Backspace"!==t.key&&"Delete"!==t.key||(this.prop("checked",!1),this.emit("change"))))}_draw(t){const e=this._used.fg||ss,i=this._used.bg||es,s=this._used.align;t.fillBounds(this.bounds," ",0,i);const n=this.prop("checked")?"check":"uncheck";let r=""+this._attrs[n];t.drawText(this.bounds.x,this.bounds.y,r,e,i);let h=0;"bottom"===this._used.valign?h=this.bounds.height-this._lines.length:"middle"===this._used.valign&&(h=Math.floor((this.bounds.height-this._lines.length)/2));const o=this._attrInt("pad")+1;return this._lines.forEach(((n,r)=>{t.drawText(this.bounds.x+o,this.bounds.y+r+h,n,e,i,this.bounds.width-o,s)})),!0}}Gr.default={uncheck:"☐",check:"☒",pad:1,value:"on"};var zr=Object.freeze({__proto__:null,Widget:yr,alignChildren:wr,spaceChildren:vr,wrapChildren:xr,Text:Er,Border:Ir,drawBorder:Ar,Button:Mr,toPadArray:Sr,Dialog:Tr,dialog:function(t){return new Tr(t)},Fieldset:Nr,Field:Pr,OrderedList:Fr,UnorderedList:Br,Input:kr,Column:Wr,DataTable:jr,DataList:Vr,Menu:Yr,MenuButton:Hr,Menubar:Ur,Select:class extends yr{constructor(t){super((t.tag=t.tag||"select",t)),this._initText(t),this._initMenu(t),this.bounds.height=1}_initText(t){this.dropdown=new Er({parent:this,text:t.text+" ▼",x:this.bounds.x,y:this.bounds.y,class:t.class,tag:t.tag||"select",width:this.bounds.width,height:1}),this.dropdown.on("click",(()=>(this.menu.toggleProp("hidden"),!1)))}_initMenu(t){this.menu=new Yr({parent:this,x:this.bounds.x,y:this.bounds.y+1,class:t.buttonClass,tag:t.buttonTag||"select",width:t.width,minWidth:this.dropdown.bounds.width,height:t.height,buttons:t.buttons}),this.menu.on("click",(()=>(this.menu.hidden=!0,!1))),this.menu.hidden=!0}},Prompt:class{constructor(t,e={}){this._id=null,this._defaultNext=null,this.selection=-1,"string"==typeof e&&(e={field:e}),this._prompt=t,this._field=e.field||"",this._choices=[],this._infos=[],this._values=[],this._next=[],this._defaultNext=e.next||null,this._id=e.id||e.field||""}reset(){this.selection=-1}field(t){return void 0===t?this._field:(this._field=t,this)}id(t){return void 0===t?this._id:(this._id=t,this)}prompt(t){return"string"==typeof this._prompt?this._prompt:this._prompt(t)}next(t){return void 0===t?this._next[this.selection]||this._defaultNext:(this._defaultNext=t,this)}choices(t,e){if(void 0===t)return this._choices;if(Array.isArray(t)?Array.isArray(e)||(e=new Array(t.length).fill("")):(e=Object.values(t),t=Object.keys(t)),e=e.map((t=>"string"==typeof t?{info:t}:t)),t.length!==e.length)throw new Error("Choices and Infos must have same length.");return t.forEach(((t,i)=>{this.choice(t,e[i])})),this}choice(t,e={}){return"string"==typeof e&&(e={info:e}),this._choices.push(t),this._infos.push(e.info||""),this._next.push(e.next||null),this._values.push(e.value||t),this}info(t){const e=this._infos[this.selection]||"";return"string"==typeof e?e:e(t)}choose(t){return this.selection=t,this}value(){return this._values[this.selection]}updateResult(t){return this.selection<0||(t[this._field]=this.value()),this}},Choice:Xr,Inquiry:class{constructor(t){this._prompts=[],this.events={},this._result={},this._stack=[],this._current=null,this.widget=t,this._keypress=this._keypress.bind(this),this._change=this._change.bind(this)}prompts(t,...e){return Array.isArray(t)?this._prompts=t.slice():(e.unshift(t),this._prompts=e),this}_finish(){this.widget.off("keypress",this._keypress),this.widget.off("change",this._change),this._fireEvent("finish",this.widget,this._result)}_cancel(){this.widget.off("keypress",this._keypress),this.widget.off("change",this._change),this._fireEvent("cancel",this.widget)}start(){this._current=this._prompts[0],this._result={},this.widget.on("keypress",this._keypress),this.widget.on("change",this._change),this.widget.showPrompt(this._current,this._result)}back(){this._current.reset(),this._current=this._stack.pop()||null,this._current?(this._current.reset(),this._result={},this._prompts.forEach((t=>t.updateResult(this._result))),this.widget.showPrompt(this._current,this._result)):this._cancel()}restart(){this._prompts.forEach((t=>t.reset())),this._result={},this._current=this._prompts[0],this.widget.showPrompt(this._current,this._result)}quit(){this._cancel()}_keypress(t,e,i){return!!i.key&&("Escape"===i.key?(this.back(),!0):"R"===i.key?(this.restart(),!0):"Q"===i.key&&(this.quit(),!0))}_change(t,e,i){i.updateResult(this._result);const s=i.next();return s&&(this._current=this._prompts.find((t=>t.id()===s))||null,this._current)?(this._stack.push(i),this.widget.showPrompt(this._current,this._result),this._fireEvent("step",this.widget,{prompt:this._current,data:this._result}),!0):(this._finish(),!0)}on(t,e){let i=this.events[t];return i||(i=this.events[t]=[]),i.includes(e)||i.push(e),this}off(t,e){let i=this.events[t];return i?(e?U(i,e):i.length=0,this):this}_fireEvent(t,e,i){const s=this.events[t]||[];let n=!1;for(let r of s)n=r(t,e||this.widget,i)||n;return n||(n=this.widget.emit(t,i)),n}},Builder:class{constructor(t){this._opts={x:0,y:0},this.scene=t,this._opts.scene=t}reset(){return this._opts={x:0,y:0,scene:this.scene},this}fg(t){return this._opts.fg=t,this}bg(t){return this._opts.bg=t,this}dim(t=25,e=!0,i=!1){return e&&(this._opts.fg=Qi(this._opts.fg||"white").darken(t)),i&&(this._opts.bg=Qi(this._opts.bg||"black").darken(t)),this}bright(t=25,e=!0,i=!1){return e&&(this._opts.fg=Qi(this._opts.fg||"white").lighten(t)),i&&(this._opts.bg=Qi(this._opts.bg||"black").lighten(t)),this}invert(){return[this._opts.fg,this._opts.bg]=[this._opts.bg,this._opts.fg],this}style(t){return Object.assign(this._opts,t),this}class(t){return this._opts.class=this._opts.class||"",this._opts.class+=" "+t,this}pos(t,e){return void 0===t?this._opts:(this._opts.x=W(t,0,this.scene.width),this._opts.y=W(e,0,this.scene.height),this)}moveTo(t,e){return this.pos(t,e)}move(t,e){return this._opts.x=W(this._opts.x+t,0,this.scene.width),this._opts.y=W(this._opts.y+e,0,this.scene.height),this}up(t=1){return this.move(0,-t)}down(t=1){return this.move(0,t)}left(t=1){return this.move(-t,0)}right(t=1){return this.move(t,0)}nextLine(t=1){return this.pos(0,this._opts.y+t)}prevLine(t=1){return this.pos(0,this._opts.y-t)}clear(t){return this.scene.destroy(),this.scene.bg=t?Qi(t):es,this}text(t={},e){"string"==typeof t?(e=e||{}).text=t:e=t;const i=Object.assign({},this._opts,e),s=new Er(i);return this.move(0,1),s}border(t){const e=Object.assign({},this._opts,t),i=new Ir(e);return this.move(1,1),i}button(t){const e=Object.assign({},this._opts,t),i=new Mr(e);return this.move(0,1),i}checkbox(t){const e=Object.assign({},this._opts,t),i=new Gr(e);return this.move(0,1),i}input(t){const e=Object.assign({},this._opts,t),i=new kr(e);return this.move(0,1),i}fieldset(t){const e=Object.assign({},this._opts,t),i=new Nr(e);return this.move(1,1),i}datatable(t){const e=Object.assign({},this._opts,t),i=new jr(e);return this.move(0,i.bounds.height),i}datalist(t){const e=Object.assign({},this._opts,t),i=new Vr(e);return this.move(0,i.bounds.height),i}menubar(t){const e=Object.assign({},this._opts,t),i=new Ur(e);return this.move(0,i.bounds.height),i}},make:function(t){const e=new yr(t);return t.with&&Object.entries(t.with).forEach((([t,i])=>{e[t]=i})),e}});class Kr{constructor(){this._timer=0}get isRunning(){return 0!=this._timer}start(t,e=16){let i=!1;if(this._timer)throw new Error("Cannot start loop twice.");this._timer=setInterval((()=>{i||(i=!0,t(),i=!1)}),e)}stop(){this._timer&&(clearInterval(this._timer),this._timer=0)}}class $r{constructor(t={}){this.dt=16,this.time=0,this.realTime=0,this.skipTime=!1,this.fps=0,this.fpsBuf=[],this.fpsTimer=0,this.numFrames=0,this.loopID=0,this.stopped=!0,this.paused=!1,this.debug=!1,"loop"in t?(this.loop=t.loop,delete t.loop):this.loop=new Kr,this.name=t.name||"Goblinwerks",this.styles=gr,this.canvas=t.canvas||mn(t),this.io=new cn,this.events=new tr(this),this.timers=new ar(this),this.scenes=new _r(this),void 0!==t.dt&&(this.dt=t.dt||16),this.data=new Wn(t.data),this.canvas.onclick=this.io.enqueue.bind(this.io),this.canvas.onmousemove=this.io.enqueue.bind(this.io),this.canvas.onclick=this.io.enqueue.bind(this.io),this.canvas.onkeydown=this.io.enqueue.bind(this.io),this.buffer=new Cs(this.canvas.width,this.canvas.height),t.scenes?(this.scenes.config(t.scenes),"string"==typeof t.start?this.scenes.start(t.start):this.scenes.start(Object.keys(t.scenes)[0])):t.scene&&(!0===t.scene&&(t.scene={}),this.scenes.config("default",t.scene),this.scenes.start("default")),!1!==t.start&&this.start()}get width(){return this.canvas.width}get height(){return this.canvas.height}get node(){return this.canvas.node}get mouseXY(){return this.canvas.mouse}get scene(){return this.scenes.get()}on(t,e){return this.events.on(t,e)}emit(t,...e){this.scenes.emit(t,...e),this.events.emit(t,...e)}wait(...t){if("string"==typeof t[1]){const e=t[1];t[2]=t[2]||{},t[1]=()=>this.emit(e,t[2])}return this.timers.setTimeout(t[1],t[0])}repeat(...t){if("string"==typeof fn){const e=t[1];t[2]=t[2]||{},t[1]=()=>this.emit(e,t[2])}return this.timers.setInterval(t[1],t[0])}start(){this.loop.isRunning||this.loop.start(this._frame.bind(this))}stop(){this.emit("stop",this),this.loop.stop(),this.stopped=!0}_frame(t=0){if(t=t||Date.now(),"undefined"!=typeof document&&"visible"!==document.visibilityState)return;0==this.realTime&&(this.realTime=t,this.time=t);const e=t,i=e-this.realTime;for(this.realTime=e,this.skipTime||(this.fpsBuf.push(1e3/i),this.fpsTimer+=i,this.fpsTimer>=1&&(this.fpsTimer=0,this.fps=Math.round(this.fpsBuf.reduce(((t,e)=>t+e))/this.fpsBuf.length),this.fpsBuf=[])),this.skipTime=!1,this.numFrames++,this._frameStart();this.io.length;){const t=this.io.dequeue();this._input(t)}if(!this.paused&&!0!==this.debug){for(;this.time+this.dt<=e;)this.time+=this.dt,this._fixed_update(this.dt);this._update(i)}this._draw(),!1!==this.debug&&this._frameDebug(),this._frameEnd(),this.io.clear()}_input(t){this.scenes.input(t),t.propagationStopped||t.defaultPrevented||t.dispatch(this.events)}_update(t=0){t=t||this.dt,this.scenes.update(t),this.timers.update(t),this.events.emit("update",t)}_fixed_update(t=0){t=t||this.dt,this.scenes.fixed_update(t),this.events.emit("fixed_update",t)}_frameStart(){this.scenes.frameStart(),this.events.emit("frameStart")}_draw(){this.scenes.draw(this.buffer),this.events.emit("draw",this.buffer)}_frameDebug(){this.scenes.frameDebug(this.buffer),this.events.emit("frameDebug",this.buffer)}_frameEnd(){this.scenes.frameEnd(this.buffer),this.events.emit("frameEnd",this.buffer),this.canvas.render(this.buffer)}alert(t,e={}){return e.text=t,this.scenes.run("alert",e)}confirm(t,e={}){return e.text=t,this.scenes.run("confirm",e)}prompt(t,e={}){e.prompt=t;const i=this.scenes._create("prompt",Rr);return i.run(e),i}}var qr=Object.freeze({__proto__:null,Event:$s,KEYPRESS:Qs,MOUSEMOVE:Zs,CLICK:Js,TICK:tn,MOUSEUP:en,STOP:sn,isControlCode:rn,recycleEvent:hn,makeStopEvent:function(){return on(sn)},makeCustomEvent:on,makeTickEvent:function(t){const e=on(tn);return e.dt=t,e},makeKeyEvent:an,keyCodeDirection:ln,ignoreKeyEvent:function(t){return nn.includes(t.code)},makeMouseEvent:un,Queue:cn,Events:tr,Loop:Kr,Timers:ar,Tweens:lr,Selector:ur,compile:function(t){return new ur(t)},Style:cr,makeStyle:function(t,e="$"){const i={};return t.trim().split(";").map((t=>t.trim())).forEach((t=>{const[e,s]=t.split(":").map((t=>t.trim()));if(!e)return;const n=s.split(/ +/g);1==n.length?i[e]=s:i[e]=n})),new cr(e,i)},ComputedStyle:dr,Sheet:fr,defaultStyle:gr,Widget:yr,alignChildren:wr,spaceChildren:vr,wrapChildren:xr,Scene:pr,Scenes:_r,scenes:br,installScene:mr,App:$r,make:function(t){return new $r(t)}});t.ERROR=j,t.FALSE=function(){return!1},t.IDENTITY=B,t.IS_NONZERO=function(t){return 0!=t},t.IS_ZERO=function(t){return 0==t},t.NOOP=N,t.ONE=F,t.TRUE=P,t.WARN=function(...t){console.warn(...t)},t.ZERO=function(){return 0},t.app=qr,t.arrayDelete=U,t.arrayFindRight=G,t.arrayIncludesAll=Y,t.arrayInsert=function(t,e,i){if(!i)return void t.push(e);const s=t.findIndex(i);s<0?t.push(e):t.splice(s,0,e)},t.arrayNext=z,t.arrayNullify=X,t.arrayPrev=K,t.arrayRevEach=H,t.arraysIntersect=function(t,e){return t.some((t=>e.includes(t)))},t.blob=Yn,t.buffer=Ms,t.canvas=yn,t.clamp=W,t.color=ns,t.colors=Ui,t.cosmetic=Li,t.data=jn,t.first=V,t.flag=Yi,t.fov=Rs,t.frequency=Hs,t.grid=Ii,t.lerp=function(t,e,i){return i>1&&(i=1),i<0&&(i=0),Math.floor(t+(e-t)*i)},t.light=Jn,t.list=yt,t.message=An,t.nextIndex=function(t,e,i=!0){return++t>=e?i?t%e:-1:t},t.object=gi,t.path=Ys,t.prevIndex=function(t,e,i=!0){return t<0?e-1:--t<0?i?e-1:-1:t},t.queue=Hi,t.random=Mi,t.range=Ni,t.rng=ki,t.scheduler=Us,t.sprite=En,t.sum=function(t){return t.reduce(((t,e)=>t+e))},t.tags=Fi,t.text=Ss,t.tween=or,t.types=In,t.ui=Dr,t.valueType=function(t){const e=typeof t;return"object"==e&&Array.isArray(t)?"array":e},t.widget=zr,t.xave=function(t,e,i){return e*t+i*(1-t)},t.xy=bt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-utils.min.js.map
