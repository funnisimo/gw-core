!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).GW=t.GW||{})}(this,(function(t){"use strict";const r=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,-1],[-1,1]],n=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];function e(t){return t}function i(t,r,n){return t<r?r:t>n?n:t}function o(t){return t.x||t[0]||0}function s(t){return t.y||t[1]||0}function h(t,r,n,e){const i=Math.abs(t-n),o=Math.abs(r-e);return i+o-.6*Math.min(i,o)}function u(t,r,n,e){let i=n-t,o=e-r;if(i&&o){const t=Math.abs(i),r=Math.abs(o);t>=2*r?o=0:r>=2*t&&(i=0)}return[Math.sign(i),Math.sign(o)]}function f(t,r,n=null){let e;Object.keys(r).forEach((i=>{const o=i;let s=r[i];e=t;const h=i.split(".");for(;h.length>1;)i=h.shift(),void 0===e[i]?e=e[i]={}:"object"!=typeof e[i]?a("Trying to set default member on non-object config item: "+o):e=e[i];i=h.shift();let u=e[i];n&&n(e,i,u,s)||void 0===u&&(null===s?e[i]=null:Array.isArray(s)?e[i]=s.slice():e[i]=s)}))}function a(t){throw new Error(t)}var c={__proto__:null,DIRS:r,NO_DIRECTION:-1,UP:0,RIGHT:1,DOWN:2,LEFT:3,RIGHT_UP:4,RIGHT_DOWN:5,LEFT_DOWN:6,LEFT_UP:7,CLOCK_DIRS:n,NOOP:function(){},TRUE:function(){return!0},FALSE:function(){return!1},ONE:function(){return 1},ZERO:function(){return 0},IDENTITY:e,clamp:i,x:o,y:s,copyXY:function(t,r){t.x=o(r),t.y=s(r)},addXY:function(t,r){t.x+=o(r),t.y+=s(r)},equalsXY:function(t,r){return t.x==o(r)&&t.y==s(r)},lerpXY:function(t,r,n){n>1&&(n/=100),n=i(n,0,1);const e=o(r)-o(t),h=s(r)-s(t);return[o(t)+Math.floor(e*n),s(t)+Math.floor(h*n)]},distanceBetween:h,distanceFromTo:function(t,r){return h(o(t),s(t),o(r),s(r))},calcRadius:function(t,r){return h(0,0,t,r)},dirBetween:u,dirFromTo:function(t,r){return u(o(t),s(t),o(r),s(r))},dirIndex:function(t){const n=o(t),e=s(t);return r.findIndex((t=>t[0]==n&&t[1]==e))},isOppositeDir:function(t,r){return t[0]+r[0]==0&&t[1]+r[1]==0},isSameDir:function(t,r){return t[0]==r[0]&&t[1]==r[1]},dirSpread:function(t){const r=[t];return 0==t[0]?(r.push([1,t[1]]),r.push([-1,t[1]])):0==t[1]?(r.push([t[0],1]),r.push([t[0],-1])):(r.push([t[0],0]),r.push([0,t[1]])),r},stepFromTo:function(t,r,n){const e=o(t),i=s(t),h=[o(r)-e,s(r)-i],u=Math.abs(h[0])+Math.abs(h[1]),f=[0,0],a=[99999,99999];for(let t=0;t<=u;++t)f[0]=e+Math.floor(h[0]*t/u),f[1]=i+Math.floor(h[1]*t/u),f[0]==a[0]&&f[1]==a[1]||n(f[0],f[1]),a[0]=f[0],a[1]=f[1]},smoothHiliteGradient:function(t,r){return Math.floor(100*Math.sin(Math.PI*t/r))},assignOmitting:function(t,r,n){"string"==typeof t&&(t=t.split(/[,|]/g).map((t=>t.trim()))),Object.keys(n).forEach((e=>{t.includes(e)||function(t,r,n){const e=t[n],i=r[n];e&&e.copy&&i?e.copy(i):e&&e.clear&&!i?e.clear():e&&e.nullify&&!i?e.nullify():i&&i.clone?t[n]=i.clone():i&&Array.isArray(i)?t[n]=i.slice():e&&Array.isArray(e)?e.length=0:t[n]=i}(r,n,e)}))},setDefault:function(t,r,n){void 0===t[r]&&(t[r]=n)},setDefaults:f,kindDefaults:function(t,r){return f(t,r,(function(t,r,n,e){return!(r.search(/[fF]lags$/)<0)&&(n?"string"==typeof n?n=n.split(/[,|]/).map((t=>t.trim())):Array.isArray(n)||(n=[n]):n=[],"string"==typeof e?e=e.split(/[,|]/).map((t=>t.trim())):Array.isArray(e)||(e=[e]),t[r]=e.concat(n),!0)}))},pick:function(t,...r){const n={};return r.forEach((r=>{const e=t[r];void 0!==e&&(n[r]=e)})),n},clearObject:function(t){Object.keys(t).forEach((r=>t[r]=void 0))},ERROR:a,WARN:function(...t){console.warn(...t)},getOpt:function(t,r,n){const e=t[r];return void 0===e?n:e},firstOpt:function(t,...r){for(let n of r){if("object"!=typeof n||Array.isArray(n))return n;if(void 0!==n[t])return n[t]}},arraysIntersect:function(t,r){return t.some((t=>r.includes(t)))},sum:function(t){return t.reduce(((t,r)=>t+r))},chainLength:function(t){let r=0;for(;t;)r+=1,t=t.next;return r},chainIncludes:function(t,r){for(;t&&t!==r;)t=t.next;return t===r},eachChain:function(t,r){let n=0;for(;t;){const e=t.next;r(t,n++),t=e}return n},addToChain:function(t,r,n){return n.next=t[r]||null,t[r]=n,!0},removeFromChain:function(t,r,n){const e=t[r];if(e===n)return t[r]=n.next||null,n.next=null,!0;if(!e)return!1;{let t=e,r=t.next;for(;r&&r!==n;)t=r,r=t.next;if(r===n)return t.next=r.next||null,n.next=null,!0}return!1}};const l={make:()=>Math.random.bind(Math)};function d(t,r){let n,e,i;for(e=0,n=0;n<r.length;n++)e+=r[n];if(e<=0)return console.warn("Lottery Draw - no frequencies",r,r.length),0;for(i=t.range(0,e-1),n=0;n<r.length;n++){if(r[n]>i)return n;i-=r[n]}return console.warn("Lottery Draw failed.",r,r.length),0}class p{constructor(){this._fn=l.make()}seed(t){this._fn=l.make(t)}value(){return this._fn()}float(){return this.value()}number(t=0){return t=t||Number.MAX_SAFE_INTEGER,Math.floor(this._fn()*t)}int(t=0){return this.number(t)}range(t,r){if(r<=t)return r;const n=r-t+1;return t+this.number(n)}dice(t,r,n=0){let e=0,i=1;t<0&&(t=-t,i=-1),n=n||0;for(let n=0;n<t;++n)e+=this.range(1,r);return e*=i,e+n}weighted(t){return Array.isArray(t)?d(this,t):function(t,r){const n=Object.entries(r),e=n.map((([t,r])=>r));return n[d(t,e)][0]}(this,t)}item(t){return Array.isArray(t)||(t=Object.values(t)),t[this.range(0,t.length-1)]}key(t){return this.item(Object.keys(t))}shuffle(t,r=0,n=0){let e,i,o;for(2==arguments.length&&(n=r,r=0),n=n||t.length,e=r=r||0;e<n;e++)i=this.range(r,n-1),e!=i&&(o=t[i],t[i]=t[e],t[e]=o);return t}sequence(t){const r=[];for(let n=0;n<t;n++)r[n]=n;return this.shuffle(r)}chance(t,r=100){return!(t<=0)&&(t>=r||this.range(0,r-1)<t)}clumped(t,r,n){if(r<=t)return t;if(n<=1)return this.range(t,r);let e,i=0,o=Math.floor((r-t)/n);for(e=0;e<(r-t)%n;e++)i+=this.range(0,o+1);for(;e<n;e++)i+=this.range(0,o);return i+t}}const m=new p,g=new p;class y{constructor(t,r=0,n=1,e){this._rng=e||m,Array.isArray(t)?(n=t[2],r=t[1],t=t[0]):t instanceof y&&(n=t.clumps,r=t.hi,t=t.lo),r<t&&([r,t]=[t,r]),this.lo=t||0,this.hi=r||this.lo,this.clumps=n||1}value(){return this._rng.clumped(this.lo,this.hi,this.clumps)}toString(){return this.lo>=this.hi?""+this.lo:`${this.lo}-${this.hi}`}}var w={__proto__:null,Range:y,make:function(t,r){if(!t)return new y(0,0,0,r);if(t instanceof y)return t;if("function"==typeof t)throw new Error("Custom range functions not supported - extend Range");if(null==t)return new y(0,0,0,r);if("number"==typeof t)return new y(t,t,1,r);if(!0===t||!1===t)throw new Error("Invalid random config: "+t);if(Array.isArray(t))return new y(t[0],t[1],t[2],r);if("string"!=typeof t)throw new Error("Calculations must be strings.  Received: "+JSON.stringify(t));if(0==t.length)return new y(0,0,0,r);const n=/^(?:([+-]?\d*)[Dd](\d+)([+-]?\d*)|([+-]?\d+)-(\d+):?(\d+)?|([+-]?\d+)~(\d+)|([+-]?\d+\.?\d*))/g;let e;for(;null!==(e=n.exec(t));){if(e[2]){let t=Number.parseInt(e[1])||1;const n=Number.parseInt(e[2]),i=Number.parseInt(e[3])||0;return new y(i+t,i+t*n,t,r)}if(e[4]&&e[5]){const t=Number.parseInt(e[4]),n=Number.parseInt(e[5]),i=Number.parseInt(e[6]);return new y(t,n,i,r)}if(e[7]&&e[8]){const t=Number.parseInt(e[7]),n=Number.parseInt(e[8]);return new y(t-2*n,t+2*n,3,r)}if(e[9]){const t=Number.parseFloat(e[9]);return new y(t,t,1,r)}}throw new Error("Not a valid range - "+t)}};const b={};var M={__proto__:null,fl:function(t){return 1<<t},toString:function(t,r){const n=Object.entries(t).reduce(((t,r)=>{const[n,e]=r;return e&&(t[e]=n),t}),[]),e=[];for(let t=0;t<32;++t){const i=1<<t;r&i&&e.push(n[i])}return e.join(" | ")},from:function(t,...r){let n=0;for(let e=0;e<r.length;++e){let i=r[e];void 0!==i&&("number"!=typeof i?("string"==typeof i&&(i=i.split(/[,|]/).map((t=>t.trim())).map((t=>{const r=Number.parseInt(t);return r>=0?r:t}))),Array.isArray(i)&&i.forEach((r=>{if("string"==typeof r)if((r=r.trim()).startsWith("!")){const e=t[r.substring(1)];n&=~e}else{const e=t[r];e&&(n|=e)}else 0===r?n=0:n|=r}))):n|=i)}return n},flags:b,install:function(t,r){return b[t]=r,r}};const _=r,A=n;function E(t){return!1===t?" ":!0===t?"T":t<10?""+t:t<36?String.fromCharCode("a".charCodeAt(0)+t-10):t<62?String.fromCharCode("A".charCodeAt(0)+t-10-26):"string"==typeof t?t[0]:"#"}class x extends Array{constructor(t,r,n){super(t);for(let e=0;e<t;++e)this[e]="function"==typeof n?new Array(r).fill(0).map(((t,r)=>n(e,r))):new Array(r).fill(n);this._width=t,this._height=r,this.type=n.constructor.name}get width(){return this._width}get height(){return this._height}resize(t,r,n){const e="function"==typeof n?n:()=>n;for(;this.length<t;)this.push([]);let i=0,o=0;for(i=0;i<t;++i){const t=this[i];for(o=0;o<Math.min(r,t.length);++o)t[o]=e(i,o);for(;t.length<r;)t.push(e(i,t.length))}this._width=t,this._height=r,void 0!==this.x&&(this.x=void 0,this.y=void 0)}forEach(t){let r,n;for(r=0;r<this.width;r++)for(n=0;n<this.height;n++)t(this[r][n],r,n,this)}eachNeighbor(t,r,n,e=!1){const i=e?4:8;for(let e=0;e<i;++e){const i=_[e],o=t+i[0],s=r+i[1];this.hasXY(o,s)&&n(this[o][s],o,s,this)}}forRect(t,r,n,e,i){n=Math.min(this.width-t,n),e=Math.min(this.height-r,e);for(let o=t;o<t+n;++o)for(let t=r;t<r+e;++t)i(this[o][t],o,t,this)}map(t){return super.map(((r,n)=>r.map(((r,e)=>t(r,n,e,this)))))}forCircle(t,r,n,e){let i,o;for(i=Math.max(0,t-n-1);i<Math.min(this.width,t+n+1);i++)for(o=Math.max(0,r-n-1);o<Math.min(this.height,r+n+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-r)*(o-r)<n*n+n&&e(this[i][o],i,o,this)}hasXY(t,r){return t>=0&&r>=0&&t<this.width&&r<this.height}isBoundaryXY(t,r){return this.hasXY(t,r)&&(0==t||t==this.width-1||0==r||r==this.height-1)}calcBounds(){const t={left:this.width,top:this.height,right:0,bottom:0};return this.forEach(((r,n,e)=>{r&&(t.left>n&&(t.left=n),t.right<n&&(t.right=n),t.top>e&&(t.top=e),t.bottom<e&&(t.bottom=e))})),t}update(t){let r,n;for(r=0;r<this.width;r++)for(n=0;n<this.height;n++)this[r][n]=t(this[r][n],r,n,this)}updateRect(t,r,n,e,i){let o,s;for(o=t;o<t+n;o++)for(s=r;s<r+e;s++)this.hasXY(o,s)&&(this[o][s]=i(this[o][s],o,s,this))}updateCircle(t,r,n,e){let i,o;for(i=Math.max(0,t-n-1);i<Math.min(this.width,t+n+1);i++)for(o=Math.max(0,r-n-1);o<Math.min(this.height,r+n+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-r)*(o-r)<n*n+n&&(this[i][o]=e(this[i][o],i,o,this))}fill(t){const r="function"==typeof t?t:()=>t;this.update(r)}fillRect(t,r,n,e,i){const o="function"==typeof i?i:()=>i;this.updateRect(t,r,n,e,o)}fillCircle(t,r,n,e){const i="function"==typeof e?e:()=>e;this.updateCircle(t,r,n,i)}replace(t,r){this.update((n=>n==t?r:n))}copy(t){this.update(((r,n,e)=>t[n][e]))}count(t){const r="function"==typeof t?t:r=>r==t;let n=0;return this.forEach(((t,e,i)=>{r(t,e,i,this)&&++n})),n}dump(t){this.dumpRect(0,0,this.width,this.height,t)}dumpRect(t,r,n,e,o){let s,h;o=o||E,t=i(t,0,this.width-2),r=i(r,0,this.height-2);const u=i(t+n,1,this.width-1),f=i(r+e,1,this.height-1);let a=[];for(h=r;h<=f;h++){let r=(h+"]").padStart(3," ");for(s=t;s<=u;s++){s%10==0&&(r+=" ");r+=o(this[s][h],s,h)[0]}a.push(r)}console.log(a.join("\n"))}dumpAround(t,r,n){this.dumpRect(t-n,r-n,2*n,2*n)}closestMatchingLoc(t,r,n){let e=[-1,-1],i=this.width+this.height;return this.forEach(((o,s,u)=>{if(n(o,s,u,this)){const n=h(t,r,s,u);n<i?(e[0]=s,e[1]=u,i=n):n==i&&m.chance(50)&&(e[0]=s,e[1]=u)}})),e}firstMatchingLoc(t){const r="function"==typeof t?t:r=>r==t;for(let t=0;t<this.width;++t)for(let n=0;n<this.height;++n)if(r(this[t][n],t,n,this))return[t,n];return[-1,-1]}randomMatchingLoc(t,r=!1){let n,e,i,o=0;const s="function"==typeof t?t:r=>r==t;if(o=0,this.forEach(((t,r,n)=>{s(t,r,n,this)&&o++})),0==o)return[-1,-1];for(i=r?Math.floor(o/2):m.range(0,o-1),n=0;n<this.width&&i>=0;n++)for(e=0;e<this.height&&i>=0;e++)if(s(this[n][e],n,e,this)){if(0==i)return[n,e];i--}return[-1,-1]}matchingLocNear(t,r,n,e=!1){let i,o,s,h,u,f=[-1,-1];const a="function"==typeof n?n:t=>t==n;for(h=0,s=0;s<Math.max(this.width,this.height)&&!h;s++)for(i=t-s;i<=t+s;i++)for(o=r-s;o<=r+s;o++)this.hasXY(i,o)&&(i==t-s||i==t+s||o==r-s||o==r+s)&&a(this[i][o],i,o,this)&&h++;if(0==h)return[-1,-1];for(u=e?1+Math.floor(h/2):1+m.number(h),s=0;s<Math.max(this.width,this.height);s++)for(i=t-s;i<=t+s;i++)for(o=r-s;o<=r+s;o++)if(this.hasXY(i,o)&&(i==t-s||i==t+s||o==r-s||o==r+s)&&a(this[i][o],i,o,this)&&0==--u)return f[0]=i,f[1]=o,f;return[-1,-1]}arcCount(t,r,n){let i,o,s,h,u,f;for(n=n||e,i=0,o=0;o<A.length;o++)s=t+A[(o+7)%8][0],h=r+A[(o+7)%8][1],u=t+A[o][0],f=r+A[o][1],(this.hasXY(u,f)&&n(this[u][f],u,f,this))!=(this.hasXY(s,h)&&n(this[s][h],s,h,this))&&i++;return Math.floor(i/2)}}const R=[];class v extends x{static alloc(t,r,n=0){let e=R.pop();return e?(e.resize(t,r,n),e):new v(t,r,n)}static free(t){if(t){if(R.indexOf(t)>=0)return;R.push(t)}}constructor(t,r,n=0){super(t,r,n)}findReplaceRange(t,r,n){this.update((e=>e>=t&&e<=r?n:e))}floodFillRange(t,r,n=0,e=0,i=0){let o,s,h,u=1;if(i>=n&&i<=e)throw new Error("Invalid grid flood fill");for(this[t][r]=i,o=0;o<4;o++)s=t+_[o][0],h=r+_[o][1],this.hasXY(s,h)&&this[s][h]>=n&&this[s][h]<=e&&(u+=this.floodFillRange(s,h,n,e,i));return u}invert(){this.update((t=>t?0:1))}closestLocWithValue(t,r,n=1){return this.closestMatchingLoc(t,r,(t=>t==n))}randomLocWithValue(t=1){return this.randomMatchingLoc((r=>r==t))}getQualifyingLocNear(t,r,n=!1){return this.matchingLocNear(t,r,(t=>!!t),n)}leastPositiveValue(){let t=Number.MAX_SAFE_INTEGER;return this.forEach((r=>{r>0&&r<t&&(t=r)})),t}randomLeastPositiveLoc(t=!1){const r=this.leastPositiveValue();return this.randomMatchingLoc((t=>t==r),t)}floodFill(t,r,n,e){let i,o,s,h=1;const u="function"==typeof n?n:t=>t==n,f="function"==typeof e?e:()=>e;for(this[t][r]=f(this[t][r],t,r,this),i=0;i<4;i++)o=t+_[i][0],s=r+_[i][1],this.hasXY(o,s)&&u(this[o][s],o,s,this)&&(h+=this.floodFill(o,s,u,f));return h}_cellularAutomataRound(t,r){let n,e,i,o,s,h,u;u=v.alloc(this.width,this.height),u.copy(this);let f=!1;for(n=0;n<this.width;n++)for(e=0;e<this.height;e++){for(i=0,h=0;h<_.length;h++)o=n+_[h][0],s=e+_[h][1],this.hasXY(o,s)&&u[o][s]&&i++;u[n][e]||"t"!=t[i]?u[n][e]&&"t"==r[i]||(this[n][e]=0,f=!0):(this[n][e]=1,f=!0)}return v.free(u),f}fillBlob(t,r,n,e,i,o,s,h){let u,f,a,c,l,d,p,g,y,w,b,M,_,A;r>=e&&(r=Math.round(.75*e),e=Math.round(1.25*e)),n>=i&&(n=Math.round(.75*i),i=Math.round(1.25*i));const E=Math.floor((this.width-e)/2),x=Math.floor((this.height-i)/2);do{for(this.fill(0),u=0;u<e;u++)for(f=0;f<i;f++)this[u+E][f+x]=m.chance(o)?1:0;for(a=0;a<t;a++)this._cellularAutomataRound(s,h)||(a=t);for(p=0,d=0,g=this.width,w=0,y=this.height,b=0,c=2,u=0;u<this.width;u++)for(f=0;f<this.height;f++)1==this[u][f]&&(l=this.floodFill(u,f,1,c),l>p&&(p=l,d=c),c++);for(u=0;u<this.width;u++){for(A=!1,f=0;f<this.height;f++)if(this[u][f]==d){A=!0;break}A&&(u<g&&(g=u),u>w&&(w=u))}for(f=0;f<this.height;f++){for(A=!1,u=0;u<this.width;u++)if(this[u][f]==d){A=!0;break}A&&(f<y&&(y=f),f>b&&(b=f))}M=w-g+1,_=b-y+1}while(M<r||_<n||0==d);for(u=0;u<this.width;u++)for(f=0;f<this.height;f++)this[u][f]==d?this[u][f]=1:this[u][f]=0;return{x:g,y:y,width:M,height:_}}}const N=v.alloc.bind(v),I=v.free.bind(v);var O={__proto__:null,makeArray:function(t,r){if(void 0===r)return new Array(t).fill(0);r=r||(()=>0);const n=new Array(t);for(let e=0;e<t;++e)n[e]=r(e);return n},Grid:x,NumGrid:v,alloc:N,free:I,make:function(t,r,n){return void 0===n?new v(t,r,0):"number"==typeof n?new v(t,r,n):new x(t,r,n)},offsetZip:function(t,r,n,e,i){const o="function"==typeof i?i:(r,n,e,o)=>t[e][o]=i||n;r.forEach(((i,s,h)=>{const u=s+n,f=h+e;t.hasXY(u,f)&&i&&o(t[u][f],i,u,f,s,h,t,r)}))},directionOfDoorSite:function(t,r,n,e){let i,o,s,h,u,f;const a="function"==typeof e?e:t=>t==e;for(o=-1,i=0;i<4;i++)if(s=r+_[i][0],h=n+_[i][1],u=r-_[i][0],f=n-_[i][1],t.hasXY(u,f)&&t.hasXY(s,h)&&a(t[u][f],u,f,t)){if(-1!=o)return-1;o=i}return o},intersection:function(t,r,n){n=n||t,t.update(((t,e,i)=>r[e][i]&&n[e][i]))},unite:function(t,r,n){n=n||t,t.update(((t,e,i)=>n[e][i]||r[e][i]))}};var X={Random:p,Range:y,Grid:x,NumGrid:v};t.configure=function(t){t.random&&function(t){if(t.make){if("function"!=typeof t.make)throw new Error("Random make parameter must be a function.");if("function"!=typeof t.make(12345))throw new Error("Random make function must accept a numeric seed and return a random function.");l.make=t.make,m.seed(),g.seed()}}(t.random)},t.cosmetic=g,t.flag=M,t.flags=b,t.grid=O,t.random=m,t.range=w,t.types=X,t.utils=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-core.min.js.map
