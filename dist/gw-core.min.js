!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).GW=t.GW||{})}(this,(function(t){"use strict";const r=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,-1],[-1,1]],n=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];function i(t){return t}function e(t,r,n){return t<r?r:t>n?n:t}function o(t){return t.x||t[0]||0}function s(t){return t.y||t[1]||0}function h(t,r,n,i){const e=Math.abs(t-n),o=Math.abs(r-i);return e+o-.6*Math.min(e,o)}function u(t,r,n,i){let e=n-t,o=i-r;if(e&&o){const t=Math.abs(e),r=Math.abs(o);t>=2*r?o=0:r>=2*t&&(e=0)}return[Math.sign(e),Math.sign(o)]}function f(t,r,n=null){let i;Object.keys(r).forEach((e=>{const o=e;let s=r[e];i=t;const h=e.split(".");for(;h.length>1;)e=h.shift(),void 0===i[e]?i=i[e]={}:"object"!=typeof i[e]?a("Trying to set default member on non-object config item: "+o):i=i[e];e=h.shift();let u=i[e];n&&n(i,e,u,s)||void 0===u&&(null===s?i[e]=null:Array.isArray(s)?i[e]=s.slice():i[e]=s)}))}function a(t){throw new Error(t)}var c={__proto__:null,DIRS:r,NO_DIRECTION:-1,UP:0,RIGHT:1,DOWN:2,LEFT:3,RIGHT_UP:4,RIGHT_DOWN:5,LEFT_DOWN:6,LEFT_UP:7,CLOCK_DIRS:n,NOOP:function(){},TRUE:function(){return!0},FALSE:function(){return!1},ONE:function(){return 1},ZERO:function(){return 0},IDENTITY:i,clamp:e,x:o,y:s,copyXY:function(t,r){t.x=o(r),t.y=s(r)},addXY:function(t,r){t.x+=o(r),t.y+=s(r)},equalsXY:function(t,r){return t.x==o(r)&&t.y==s(r)},lerpXY:function(t,r,n){n>1&&(n/=100),n=e(n,0,1);const i=o(r)-o(t),h=s(r)-s(t);return[o(t)+Math.floor(i*n),s(t)+Math.floor(h*n)]},distanceBetween:h,distanceFromTo:function(t,r){return h(o(t),s(t),o(r),s(r))},calcRadius:function(t,r){return h(0,0,t,r)},dirBetween:u,dirFromTo:function(t,r){return u(o(t),s(t),o(r),s(r))},dirIndex:function(t){const n=o(t),i=s(t);return r.findIndex((t=>t[0]==n&&t[1]==i))},isOppositeDir:function(t,r){return t[0]+r[0]==0&&t[1]+r[1]==0},isSameDir:function(t,r){return t[0]==r[0]&&t[1]==r[1]},dirSpread:function(t){const r=[t];return 0==t[0]?(r.push([1,t[1]]),r.push([-1,t[1]])):0==t[1]?(r.push([t[0],1]),r.push([t[0],-1])):(r.push([t[0],0]),r.push([0,t[1]])),r},stepFromTo:function(t,r,n){const i=o(t),e=s(t),h=[o(r)-i,s(r)-e],u=Math.abs(h[0])+Math.abs(h[1]),f=[0,0],a=[99999,99999];for(let t=0;t<=u;++t)f[0]=i+Math.floor(h[0]*t/u),f[1]=e+Math.floor(h[1]*t/u),f[0]==a[0]&&f[1]==a[1]||n(f[0],f[1]),a[0]=f[0],a[1]=f[1]},smoothHiliteGradient:function(t,r){return Math.floor(100*Math.sin(Math.PI*t/r))},assignOmitting:function(t,r,n){"string"==typeof t&&(t=t.split(/[,|]/g).map((t=>t.trim()))),Object.keys(n).forEach((i=>{t.includes(i)||function(t,r,n){const i=t[n],e=r[n];i&&i.copy&&e?i.copy(e):i&&i.clear&&!e?i.clear():i&&i.nullify&&!e?i.nullify():e&&e.clone?t[n]=e.clone():e&&Array.isArray(e)?t[n]=e.slice():i&&Array.isArray(i)?i.length=0:t[n]=e}(r,n,i)}))},setDefault:function(t,r,n){void 0===t[r]&&(t[r]=n)},setDefaults:f,kindDefaults:function(t,r){return f(t,r,(function(t,r,n,i){return!(r.search(/[fF]lags$/)<0)&&(n?"string"==typeof n?n=n.split(/[,|]/).map((t=>t.trim())):Array.isArray(n)||(n=[n]):n=[],"string"==typeof i?i=i.split(/[,|]/).map((t=>t.trim())):Array.isArray(i)||(i=[i]),t[r]=i.concat(n),!0)}))},pick:function(t,...r){const n={};return r.forEach((r=>{const i=t[r];void 0!==i&&(n[r]=i)})),n},clearObject:function(t){Object.keys(t).forEach((r=>t[r]=void 0))},ERROR:a,WARN:function(...t){console.warn(...t)},getOpt:function(t,r,n){const i=t[r];return void 0===i?n:i},firstOpt:function(t,...r){for(let n of r){if("object"!=typeof n||Array.isArray(n))return n;if(void 0!==n[t])return n[t]}},arraysIntersect:function(t,r){return t.some((t=>r.includes(t)))},sum:function(t){return t.reduce(((t,r)=>t+r))},chainLength:function(t){let r=0;for(;t;)r+=1,t=t.next;return r},chainIncludes:function(t,r){for(;t&&t!==r;)t=t.next;return t===r},eachChain:function(t,r){let n=0;for(;t;){const i=t.next;r(t,n++),t=i}return n},addToChain:function(t,r,n){return n.next=t[r]||null,t[r]=n,!0},removeFromChain:function(t,r,n){const i=t[r];if(i===n)return t[r]=n.next||null,n.next=null,!0;if(!i)return!1;{let t=i,r=t.next;for(;r&&r!==n;)t=r,r=t.next;if(r===n)return t.next=r.next||null,n.next=null,!0}return!1}};const l=()=>Math.random.bind(Math);function d(t,r){let n,i,e;for(i=0,n=0;n<r.length;n++)i+=r[n];if(i<=0)return console.warn("Lottery Draw - no frequencies",r,r.length),0;for(e=t.range(0,i-1),n=0;n<r.length;n++){if(r[n]>e)return n;e-=r[n]}return console.warn("Lottery Draw failed.",r,r.length),0}class p{constructor(){this._fn=l()}seed(t){this._fn=l(t)}value(){return this._fn()}float(){return this.value()}number(t=0){return t=t||Number.MAX_SAFE_INTEGER,Math.floor(this._fn()*t)}int(t=0){return this.number(t)}range(t,r){if(r<=t)return r;const n=r-t+1;return t+this.number(n)}dice(t,r,n=0){let i=0,e=1;t<0&&(t=-t,e=-1),n=n||0;for(let n=0;n<t;++n)i+=this.range(1,r);return i*=e,i+n}weighted(t){return Array.isArray(t)?d(this,t):function(t,r){const n=Object.entries(r),i=n.map((([t,r])=>r));return n[d(t,i)][0]}(this,t)}item(t){return Array.isArray(t)||(t=Object.values(t)),t[this.range(0,t.length-1)]}key(t){return this.item(Object.keys(t))}shuffle(t,r=0,n=0){let i,e,o;for(2==arguments.length&&(n=r,r=0),n=n||t.length,i=r=r||0;i<n;i++)e=this.range(r,n-1),i!=e&&(o=t[e],t[e]=t[i],t[i]=o);return t}sequence(t){const r=[];for(let n=0;n<t;n++)r[n]=n;return this.shuffle(r)}chance(t,r=100){return!(t<=0)&&(t>=r||this.range(0,r-1)<t)}clumped(t,r,n){if(r<=t)return t;if(n<=1)return this.range(t,r);let i,e=0,o=Math.floor((r-t)/n);for(i=0;i<(r-t)%n;i++)e+=this.range(0,o+1);for(;i<n;i++)e+=this.range(0,o);return e+t}}const g=new p,m=new p;class y{constructor(t,r=0,n=1,i){this._rng=i||g,Array.isArray(t)?(n=t[2],r=t[1],t=t[0]):t instanceof y&&(n=t.clumps,r=t.hi,t=t.lo),r<t&&([r,t]=[t,r]),this.lo=t||0,this.hi=r||this.lo,this.clumps=n||1}value(){return this._rng.clumped(this.lo,this.hi,this.clumps)}toString(){return this.lo>=this.hi?""+this.lo:`${this.lo}-${this.hi}`}}var w={__proto__:null,Range:y,make:function(t,r){if(!t)return new y(0,0,0,r);if(t instanceof y)return t;if("function"==typeof t)throw new Error("Custom range functions not supported - extend Range");if(null==t)return new y(0,0,0,r);if("number"==typeof t)return new y(t,t,1,r);if(!0===t||!1===t)throw new Error("Invalid random config: "+t);if(Array.isArray(t))return new y(t[0],t[1],t[2],r);if("string"!=typeof t)throw new Error("Calculations must be strings.  Received: "+JSON.stringify(t));if(0==t.length)return new y(0,0,0,r);const n=/^(?:([+-]?\d*)[Dd](\d+)([+-]?\d*)|([+-]?\d+)-(\d+):?(\d+)?|([+-]?\d+)~(\d+)|([+-]?\d+\.?\d*))/g;let i;for(;null!==(i=n.exec(t));){if(i[2]){let t=Number.parseInt(i[1])||1;const n=Number.parseInt(i[2]),e=Number.parseInt(i[3])||0;return new y(e+t,e+t*n,t,r)}if(i[4]&&i[5]){const t=Number.parseInt(i[4]),n=Number.parseInt(i[5]),e=Number.parseInt(i[6]);return new y(t,n,e,r)}if(i[7]&&i[8]){const t=Number.parseInt(i[7]),n=Number.parseInt(i[8]);return new y(t-2*n,t+2*n,3,r)}if(i[9]){const t=Number.parseFloat(i[9]);return new y(t,t,1,r)}}throw new Error("Not a valid range - "+t)}};const b={};var M={__proto__:null,fl:function(t){return 1<<t},toString:function(t,r){const n=Object.entries(t).reduce(((t,r)=>{const[n,i]=r;return i&&(t[i]=n),t}),[]),i=[];for(let t=0;t<32;++t){const e=1<<t;r&e&&i.push(n[e])}return i.join(" | ")},from:function(t,...r){let n=0;for(let i=0;i<r.length;++i){let e=r[i];void 0!==e&&("number"!=typeof e?("string"==typeof e&&(e=e.split(/[,|]/).map((t=>t.trim())).map((t=>{const r=Number.parseInt(t);return r>=0?r:t}))),Array.isArray(e)&&e.forEach((r=>{if("string"==typeof r)if((r=r.trim()).startsWith("!")){const i=t[r.substring(1)];n&=~i}else{const i=t[r];i&&(n|=i)}else 0===r?n=0:n|=r}))):n|=e)}return n},flags:b,install:function(t,r){return b[t]=r,r}};const _=r,A=n;function x(t){return!1===t?" ":!0===t?"T":t<10?""+t:t<36?String.fromCharCode("a".charCodeAt(0)+t-10):t<62?String.fromCharCode("A".charCodeAt(0)+t-10-26):"string"==typeof t?t[0]:"#"}class E extends Array{constructor(t,r,n){super(t);for(let i=0;i<t;++i)this[i]="function"==typeof n?new Array(r).fill(0).map(((t,r)=>n(i,r))):new Array(r).fill(n);this._width=t,this._height=r,this.type=n.constructor.name}get width(){return this._width}get height(){return this._height}resize(t,r,n){const i="function"==typeof n?n:()=>n;for(;this.length<t;)this.push([]);let e=0,o=0;for(e=0;e<t;++e){const t=this[e];for(o=0;o<Math.min(r,t.length);++o)t[o]=i(e,o);for(;t.length<r;)t.push(i(e,t.length))}this._width=t,this._height=r,void 0!==this.x&&(this.x=void 0,this.y=void 0)}forEach(t){let r,n;for(r=0;r<this.width;r++)for(n=0;n<this.height;n++)t(this[r][n],r,n,this)}eachNeighbor(t,r,n,i=!1){const e=i?4:8;for(let i=0;i<e;++i){const e=_[i],o=t+e[0],s=r+e[1];this.hasXY(o,s)&&n(this[o][s],o,s,this)}}forRect(t,r,n,i,e){n=Math.min(this.width-t,n),i=Math.min(this.height-r,i);for(let o=t;o<t+n;++o)for(let t=r;t<r+i;++t)e(this[o][t],o,t,this)}map(t){return super.map(((r,n)=>r.map(((r,i)=>t(r,n,i,this)))))}forCircle(t,r,n,i){let e,o;for(e=Math.max(0,t-n-1);e<Math.min(this.width,t+n+1);e++)for(o=Math.max(0,r-n-1);o<Math.min(this.height,r+n+1);o++)this.hasXY(e,o)&&(e-t)*(e-t)+(o-r)*(o-r)<n*n+n&&i(this[e][o],e,o,this)}hasXY(t,r){return t>=0&&r>=0&&t<this.width&&r<this.height}isBoundaryXY(t,r){return this.hasXY(t,r)&&(0==t||t==this.width-1||0==r||r==this.height-1)}calcBounds(){const t={left:this.width,top:this.height,right:0,bottom:0};return this.forEach(((r,n,i)=>{r&&(t.left>n&&(t.left=n),t.right<n&&(t.right=n),t.top>i&&(t.top=i),t.bottom<i&&(t.bottom=i))})),t}update(t){let r,n;for(r=0;r<this.width;r++)for(n=0;n<this.height;n++)this[r][n]=t(this[r][n],r,n,this)}updateRect(t,r,n,i,e){let o,s;for(o=t;o<t+n;o++)for(s=r;s<r+i;s++)this.hasXY(o,s)&&(this[o][s]=e(this[o][s],o,s,this))}updateCircle(t,r,n,i){let e,o;for(e=Math.max(0,t-n-1);e<Math.min(this.width,t+n+1);e++)for(o=Math.max(0,r-n-1);o<Math.min(this.height,r+n+1);o++)this.hasXY(e,o)&&(e-t)*(e-t)+(o-r)*(o-r)<n*n+n&&(this[e][o]=i(this[e][o],e,o,this))}fill(t){const r="function"==typeof t?t:()=>t;this.update(r)}fillRect(t,r,n,i,e){const o="function"==typeof e?e:()=>e;this.updateRect(t,r,n,i,o)}fillCircle(t,r,n,i){const e="function"==typeof i?i:()=>i;this.updateCircle(t,r,n,e)}replace(t,r){this.update((n=>n==t?r:n))}copy(t){this.update(((r,n,i)=>t[n][i]))}count(t){const r="function"==typeof t?t:r=>r==t;let n=0;return this.forEach(((t,i,e)=>{r(t,i,e,this)&&++n})),n}dump(t){this.dumpRect(0,0,this.width,this.height,t)}dumpRect(t,r,n,i,o){let s,h;o=o||x,t=e(t,0,this.width-2),r=e(r,0,this.height-2);const u=e(t+n,1,this.width-1),f=e(r+i,1,this.height-1);let a=[];for(h=r;h<=f;h++){let r=(h+"]").padStart(3," ");for(s=t;s<=u;s++){s%10==0&&(r+=" ");r+=o(this[s][h],s,h)[0]}a.push(r)}console.log(a.join("\n"))}dumpAround(t,r,n){this.dumpRect(t-n,r-n,2*n,2*n)}closestMatchingLoc(t,r,n){let i=[-1,-1],e=this.width+this.height;return this.forEach(((o,s,u)=>{if(n(o,s,u,this)){const n=h(t,r,s,u);n<e?(i[0]=s,i[1]=u,e=n):n==e&&g.chance(50)&&(i[0]=s,i[1]=u)}})),i}firstMatchingLoc(t){const r="function"==typeof t?t:r=>r==t;for(let t=0;t<this.width;++t)for(let n=0;n<this.height;++n)if(r(this[t][n],t,n,this))return[t,n];return[-1,-1]}randomMatchingLoc(t,r=!1){let n,i,e,o=0;const s="function"==typeof t?t:r=>r==t;if(o=0,this.forEach(((t,r,n)=>{s(t,r,n,this)&&o++})),0==o)return[-1,-1];for(e=r?Math.floor(o/2):g.range(0,o-1),n=0;n<this.width&&e>=0;n++)for(i=0;i<this.height&&e>=0;i++)if(s(this[n][i],n,i,this)){if(0==e)return[n,i];e--}return[-1,-1]}matchingLocNear(t,r,n,i=!1){let e,o,s,h,u,f=[-1,-1];const a="function"==typeof n?n:t=>t==n;for(h=0,s=0;s<Math.max(this.width,this.height)&&!h;s++)for(e=t-s;e<=t+s;e++)for(o=r-s;o<=r+s;o++)this.hasXY(e,o)&&(e==t-s||e==t+s||o==r-s||o==r+s)&&a(this[e][o],e,o,this)&&h++;if(0==h)return[-1,-1];for(u=i?1+Math.floor(h/2):1+g.number(h),s=0;s<Math.max(this.width,this.height);s++)for(e=t-s;e<=t+s;e++)for(o=r-s;o<=r+s;o++)if(this.hasXY(e,o)&&(e==t-s||e==t+s||o==r-s||o==r+s)&&a(this[e][o],e,o,this)&&0==--u)return f[0]=e,f[1]=o,f;return[-1,-1]}arcCount(t,r,n){let e,o,s,h,u,f;for(n=n||i,e=0,o=0;o<A.length;o++)s=t+A[(o+7)%8][0],h=r+A[(o+7)%8][1],u=t+A[o][0],f=r+A[o][1],(this.hasXY(u,f)&&n(this[u][f],u,f,this))!=(this.hasXY(s,h)&&n(this[s][h],s,h,this))&&e++;return Math.floor(e/2)}}const R=[];class v extends E{static alloc(t,r,n=0){let i=R.pop();return i?(i.resize(t,r,n),i):new v(t,r,n)}static free(t){if(t){if(R.indexOf(t)>=0)return;R.push(t)}}constructor(t,r,n=0){super(t,r,n)}findReplaceRange(t,r,n){this.update((i=>i>=t&&i<=r?n:i))}floodFillRange(t,r,n=0,i=0,e=0){let o,s,h,u=1;if(e>=n&&e<=i)throw new Error("Invalid grid flood fill");for(this[t][r]=e,o=0;o<4;o++)s=t+_[o][0],h=r+_[o][1],this.hasXY(s,h)&&this[s][h]>=n&&this[s][h]<=i&&(u+=this.floodFillRange(s,h,n,i,e));return u}invert(){this.update((t=>t?0:1))}closestLocWithValue(t,r,n=1){return this.closestMatchingLoc(t,r,(t=>t==n))}randomLocWithValue(t=1){return this.randomMatchingLoc((r=>r==t))}getQualifyingLocNear(t,r,n=!1){return this.matchingLocNear(t,r,(t=>!!t),n)}leastPositiveValue(){let t=Number.MAX_SAFE_INTEGER;return this.forEach((r=>{r>0&&r<t&&(t=r)})),t}randomLeastPositiveLoc(t=!1){const r=this.leastPositiveValue();return this.randomMatchingLoc((t=>t==r),t)}floodFill(t,r,n,i){let e,o,s,h=1;const u="function"==typeof n?n:t=>t==n,f="function"==typeof i?i:()=>i;for(this[t][r]=f(this[t][r],t,r,this),e=0;e<4;e++)o=t+_[e][0],s=r+_[e][1],this.hasXY(o,s)&&u(this[o][s],o,s,this)&&(h+=this.floodFill(o,s,u,f));return h}_cellularAutomataRound(t,r){let n,i,e,o,s,h,u;u=v.alloc(this.width,this.height),u.copy(this);let f=!1;for(n=0;n<this.width;n++)for(i=0;i<this.height;i++){for(e=0,h=0;h<_.length;h++)o=n+_[h][0],s=i+_[h][1],this.hasXY(o,s)&&u[o][s]&&e++;u[n][i]||"t"!=t[e]?u[n][i]&&"t"==r[e]||(this[n][i]=0,f=!0):(this[n][i]=1,f=!0)}return v.free(u),f}fillBlob(t,r,n,i,e,o,s,h){let u,f,a,c,l,d,p,m,y,w,b,M,_,A;r>=i&&(r=Math.round(.75*i),i=Math.round(1.25*i)),n>=e&&(n=Math.round(.75*e),e=Math.round(1.25*e));const x=Math.floor((this.width-i)/2),E=Math.floor((this.height-e)/2);do{for(this.fill(0),u=0;u<i;u++)for(f=0;f<e;f++)this[u+x][f+E]=g.chance(o)?1:0;for(a=0;a<t;a++)this._cellularAutomataRound(s,h)||(a=t);for(p=0,d=0,m=this.width,w=0,y=this.height,b=0,c=2,u=0;u<this.width;u++)for(f=0;f<this.height;f++)1==this[u][f]&&(l=this.floodFill(u,f,1,c),l>p&&(p=l,d=c),c++);for(u=0;u<this.width;u++){for(A=!1,f=0;f<this.height;f++)if(this[u][f]==d){A=!0;break}A&&(u<m&&(m=u),u>w&&(w=u))}for(f=0;f<this.height;f++){for(A=!1,u=0;u<this.width;u++)if(this[u][f]==d){A=!0;break}A&&(f<y&&(y=f),f>b&&(b=f))}M=w-m+1,_=b-y+1}while(M<r||_<n||0==d);for(u=0;u<this.width;u++)for(f=0;f<this.height;f++)this[u][f]==d?this[u][f]=1:this[u][f]=0;return{x:m,y:y,width:M,height:_}}}const N=v.alloc.bind(v),I=v.free.bind(v);var O={__proto__:null,makeArray:function(t,r){if(void 0===r)return new Array(t).fill(0);r=r||(()=>0);const n=new Array(t);for(let i=0;i<t;++i)n[i]=r(i);return n},Grid:E,NumGrid:v,alloc:N,free:I,make:function(t,r,n){return void 0===n?new v(t,r,0):"number"==typeof n?new v(t,r,n):new E(t,r,n)},offsetZip:function(t,r,n,i,e){const o="function"==typeof e?e:(r,n,i,o)=>t[i][o]=e||n;r.forEach(((e,s,h)=>{const u=s+n,f=h+i;t.hasXY(u,f)&&e&&o(t[u][f],e,u,f,s,h,t,r)}))},directionOfDoorSite:function(t,r,n,i){let e,o,s,h,u,f;const a="function"==typeof i?i:t=>t==i;for(o=-1,e=0;e<4;e++)if(s=r+_[e][0],h=n+_[e][1],u=r-_[e][0],f=n-_[e][1],t.hasXY(u,f)&&t.hasXY(s,h)&&a(t[u][f],u,f,t)){if(-1!=o)return-1;o=e}return o},intersection:function(t,r,n){n=n||t,t.update(((t,i,e)=>r[i][e]&&n[i][e]))},unite:function(t,r,n){n=n||t,t.update(((t,i,e)=>n[i][e]||r[i][e]))}};t.Random=p,t.cosmetic=m,t.data={},t.flag=M,t.flags=b,t.grid=O,t.random=g,t.range=w,t.utils=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-core.min.js.map
