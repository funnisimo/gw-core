!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).GW=t.GW||{})}(this,(function(t){"use strict";const r=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,-1],[-1,1]],e=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];function n(t){return t}function i(t,r,e){return t<r?r:t>e?e:t}function o(t){return t.x||t[0]||0}function s(t){return t.y||t[1]||0}function h(t,r,e,n){const i=Math.abs(t-e),o=Math.abs(r-n);return i+o-.6*Math.min(i,o)}function u(t,r,e,n){let i=e-t,o=n-r;if(i&&o){const t=Math.abs(i),r=Math.abs(o);t>=2*r?o=0:r>=2*t&&(i=0)}return[Math.sign(i),Math.sign(o)]}function f(t,r,e=null){let n;Object.keys(r).forEach((i=>{const o=i;let s=r[i];n=t;const h=i.split(".");for(;h.length>1;)i=h.shift(),void 0===n[i]?n=n[i]={}:"object"!=typeof n[i]?a("Trying to set default member on non-object config item: "+o):n=n[i];i=h.shift();let u=n[i];e&&e(n,i,u,s)||void 0===u&&(null===s?n[i]=null:Array.isArray(s)?n[i]=s.slice():n[i]=s)}))}function a(t){throw new Error(t)}var c={__proto__:null,DIRS:r,NO_DIRECTION:-1,UP:0,RIGHT:1,DOWN:2,LEFT:3,RIGHT_UP:4,RIGHT_DOWN:5,LEFT_DOWN:6,LEFT_UP:7,CLOCK_DIRS:e,NOOP:function(){},TRUE:function(){return!0},FALSE:function(){return!1},ONE:function(){return 1},ZERO:function(){return 0},IDENTITY:n,clamp:i,x:o,y:s,copyXY:function(t,r){t.x=o(r),t.y=s(r)},addXY:function(t,r){t.x+=o(r),t.y+=s(r)},equalsXY:function(t,r){return t.x==o(r)&&t.y==s(r)},lerpXY:function(t,r,e){e>1&&(e/=100),e=i(e,0,1);const n=o(r)-o(t),h=s(r)-s(t);return[o(t)+Math.floor(n*e),s(t)+Math.floor(h*e)]},distanceBetween:h,distanceFromTo:function(t,r){return h(o(t),s(t),o(r),s(r))},calcRadius:function(t,r){return h(0,0,t,r)},dirBetween:u,dirFromTo:function(t,r){return u(o(t),s(t),o(r),s(r))},dirIndex:function(t){const e=o(t),n=s(t);return r.findIndex((t=>t[0]==e&&t[1]==n))},isOppositeDir:function(t,r){return t[0]+r[0]==0&&t[1]+r[1]==0},isSameDir:function(t,r){return t[0]==r[0]&&t[1]==r[1]},dirSpread:function(t){const r=[t];return 0==t[0]?(r.push([1,t[1]]),r.push([-1,t[1]])):0==t[1]?(r.push([t[0],1]),r.push([t[0],-1])):(r.push([t[0],0]),r.push([0,t[1]])),r},stepFromTo:function(t,r,e){const n=o(t),i=s(t),h=[o(r)-n,s(r)-i],u=Math.abs(h[0])+Math.abs(h[1]),f=[0,0],a=[99999,99999];for(let t=0;t<=u;++t)f[0]=n+Math.floor(h[0]*t/u),f[1]=i+Math.floor(h[1]*t/u),f[0]==a[0]&&f[1]==a[1]||e(f[0],f[1]),a[0]=f[0],a[1]=f[1]},smoothHiliteGradient:function(t,r){return Math.floor(100*Math.sin(Math.PI*t/r))},assignOmitting:function(t,r,e){"string"==typeof t&&(t=t.split(/[,|]/g).map((t=>t.trim()))),Object.keys(e).forEach((n=>{t.includes(n)||function(t,r,e){const n=t[e],i=r[e];n&&n.copy&&i?n.copy(i):n&&n.clear&&!i?n.clear():n&&n.nullify&&!i?n.nullify():i&&i.clone?t[e]=i.clone():i&&Array.isArray(i)?t[e]=i.slice():n&&Array.isArray(n)?n.length=0:t[e]=i}(r,e,n)}))},setDefault:function(t,r,e){void 0===t[r]&&(t[r]=e)},setDefaults:f,kindDefaults:function(t,r){return f(t,r,(function(t,r,e,n){return!(r.search(/[fF]lags$/)<0)&&(e?"string"==typeof e?e=e.split(/[,|]/).map((t=>t.trim())):Array.isArray(e)||(e=[e]):e=[],"string"==typeof n?n=n.split(/[,|]/).map((t=>t.trim())):Array.isArray(n)||(n=[n]),t[r]=n.concat(e),!0)}))},pick:function(t,...r){const e={};return r.forEach((r=>{const n=t[r];void 0!==n&&(e[r]=n)})),e},clearObject:function(t){Object.keys(t).forEach((r=>t[r]=void 0))},ERROR:a,WARN:function(...t){console.warn(...t)},getOpt:function(t,r,e){const n=t[r];return void 0===n?e:n},firstOpt:function(t,...r){for(let e of r){if("object"!=typeof e||Array.isArray(e))return e;if(void 0!==e[t])return e[t]}},arraysIntersect:function(t,r){return t.some((t=>r.includes(t)))},sum:function(t){return t.reduce(((t,r)=>t+r))},chainLength:function(t){let r=0;for(;t;)r+=1,t=t.next;return r},chainIncludes:function(t,r){for(;t&&t!==r;)t=t.next;return t===r},eachChain:function(t,r){let e=0;for(;t;){const n=t.next;r(t,e++),t=n}return e},addToChain:function(t,r,e){return e.next=t[r]||null,t[r]=e,!0},removeFromChain:function(t,r,e){const n=t[r];if(n===e)return t[r]=e.next||null,e.next=null,!0;if(!n)return!1;{let t=n,r=t.next;for(;r&&r!==e;)t=r,r=t.next;if(r===e)return t.next=r.next||null,e.next=null,!0}return!1}};const l={make:()=>Math.random.bind(Math)};function d(t,r){let e,n,i;for(n=0,e=0;e<r.length;e++)n+=r[e];if(n<=0)return console.warn("Lottery Draw - no frequencies",r,r.length),0;for(i=t.range(0,n-1),e=0;e<r.length;e++){if(r[e]>i)return e;i-=r[e]}return console.warn("Lottery Draw failed.",r,r.length),0}class p{constructor(){this._fn=l.make()}static configure(t){if(t.make){if("function"!=typeof t.make)throw new Error("Random make parameter must be a function.");if("function"!=typeof t.make(12345))throw new Error("Random make function must accept a numeric seed and return a random function.");l.make=t.make,m.seed(),g.seed()}}seed(t){this._fn=l.make(t)}value(){return this._fn()}float(){return this.value()}number(t=0){return t=t||Number.MAX_SAFE_INTEGER,Math.floor(this._fn()*t)}int(t=0){return this.number(t)}range(t,r){if(r<=t)return r;const e=r-t+1;return t+this.number(e)}dice(t,r,e=0){let n=0,i=1;t<0&&(t=-t,i=-1),e=e||0;for(let e=0;e<t;++e)n+=this.range(1,r);return n*=i,n+e}weighted(t){return Array.isArray(t)?d(this,t):function(t,r){const e=Object.entries(r),n=e.map((([t,r])=>r));return e[d(t,n)][0]}(this,t)}item(t){return Array.isArray(t)||(t=Object.values(t)),t[this.range(0,t.length-1)]}key(t){return this.item(Object.keys(t))}shuffle(t,r=0,e=0){let n,i,o;for(2==arguments.length&&(e=r,r=0),e=e||t.length,n=r=r||0;n<e;n++)i=this.range(r,e-1),n!=i&&(o=t[i],t[i]=t[n],t[n]=o);return t}sequence(t){const r=[];for(let e=0;e<t;e++)r[e]=e;return this.shuffle(r)}chance(t,r=100){return!(t<=0)&&(t>=r||this.number(r)<t)}clumped(t,r,e){if(r<=t)return t;if(e<=1)return this.range(t,r);let n,i=0,o=Math.floor((r-t)/e);for(n=0;n<(r-t)%e;n++)i+=this.range(0,o+1);for(;n<e;n++)i+=this.range(0,o);return i+t}}const m=new p,g=new p;class y{constructor(t,r=0,e=1,n){this._rng=n||m,Array.isArray(t)?(e=t[2],r=t[1],t=t[0]):t instanceof y&&(e=t.clumps,r=t.hi,t=t.lo),r<t&&([r,t]=[t,r]),this.lo=t||0,this.hi=r||this.lo,this.clumps=e||1}value(){return this._rng.clumped(this.lo,this.hi,this.clumps)}toString(){return this.lo>=this.hi?""+this.lo:`${this.lo}-${this.hi}`}}var w={__proto__:null,Range:y,make:function(t,r){if(!t)return new y(0,0,0,r);if(t instanceof y)return t;if("function"==typeof t)throw new Error("Custom range functions not supported - extend Range");if(null==t)return new y(0,0,0,r);if("number"==typeof t)return new y(t,t,1,r);if(!0===t||!1===t)throw new Error("Invalid random config: "+t);if(Array.isArray(t))return new y(t[0],t[1],t[2],r);if("string"!=typeof t)throw new Error("Calculations must be strings.  Received: "+JSON.stringify(t));if(0==t.length)return new y(0,0,0,r);const e=/^(?:([+-]?\d*)[Dd](\d+)([+-]?\d*)|([+-]?\d+)-(\d+):?(\d+)?|([+-]?\d+)~(\d+)|([+-]?\d+\.?\d*))/g;let n;for(;null!==(n=e.exec(t));){if(n[2]){let t=Number.parseInt(n[1])||1;const e=Number.parseInt(n[2]),i=Number.parseInt(n[3])||0;return new y(i+t,i+t*e,t,r)}if(n[4]&&n[5]){const t=Number.parseInt(n[4]),e=Number.parseInt(n[5]),i=Number.parseInt(n[6]);return new y(t,e,i,r)}if(n[7]&&n[8]){const t=Number.parseInt(n[7]),e=Number.parseInt(n[8]);return new y(t-2*e,t+2*e,3,r)}if(n[9]){const t=Number.parseFloat(n[9]);return new y(t,t,1,r)}}throw new Error("Not a valid range - "+t)}};const b={};var M={__proto__:null,fl:function(t){return 1<<t},toString:function(t,r){const e=Object.entries(t).reduce(((t,r)=>{const[e,n]=r;return n&&(t[n]=e),t}),[]),n=[];for(let t=0;t<32;++t){const i=1<<t;r&i&&n.push(e[i])}return n.join(" | ")},from:function(t,...r){let e=0;for(let n=0;n<r.length;++n){let i=r[n];void 0!==i&&("number"!=typeof i?("string"==typeof i&&(i=i.split(/[,|]/).map((t=>t.trim())).map((t=>{const r=Number.parseInt(t);return r>=0?r:t}))),Array.isArray(i)&&i.forEach((r=>{if("string"==typeof r)if((r=r.trim()).startsWith("!")){const n=t[r.substring(1)];e&=~n}else{const n=t[r];n&&(e|=n)}else 0===r?e=0:e|=r}))):e|=i)}return e},flags:b,install:function(t,r){return b[t]=r,r}};const _=r,A=e;function E(t){return!1===t?" ":!0===t?"T":t<10?""+t:t<36?String.fromCharCode("a".charCodeAt(0)+t-10):t<62?String.fromCharCode("A".charCodeAt(0)+t-10-26):"string"==typeof t?t[0]:"#"}class x extends Array{constructor(t,r,e){super(t);for(let n=0;n<t;++n)this[n]="function"==typeof e?new Array(r).fill(0).map(((t,r)=>e(n,r))):new Array(r).fill(e);this._width=t,this._height=r,this.type=e.constructor.name}get width(){return this._width}get height(){return this._height}forEach(t){let r,e;for(r=0;r<this.width;r++)for(e=0;e<this.height;e++)t(this[r][e],r,e,this)}eachNeighbor(t,r,e,n=!1){const i=n?4:8;for(let n=0;n<i;++n){const i=_[n],o=t+i[0],s=r+i[1];this.hasXY(o,s)&&e(this[o][s],o,s,this)}}forRect(t,r,e,n,i){e=Math.min(this.width-t,e),n=Math.min(this.height-r,n);for(let o=t;o<t+e;++o)for(let t=r;t<r+n;++t)i(this[o][t],o,t,this)}map(t){return super.map(((r,e)=>r.map(((r,n)=>t(r,e,n,this)))))}forCircle(t,r,e,n){let i,o;for(i=Math.max(0,t-e-1);i<Math.min(this.width,t+e+1);i++)for(o=Math.max(0,r-e-1);o<Math.min(this.height,r+e+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-r)*(o-r)<e*e+e&&n(this[i][o],i,o,this)}hasXY(t,r){return t>=0&&r>=0&&t<this.width&&r<this.height}isBoundaryXY(t,r){return this.hasXY(t,r)&&(0==t||t==this.width-1||0==r||r==this.height-1)}calcBounds(){const t={left:this.width,top:this.height,right:0,bottom:0};return this.forEach(((r,e,n)=>{r&&(t.left>e&&(t.left=e),t.right<e&&(t.right=e),t.top>n&&(t.top=n),t.bottom<n&&(t.bottom=n))})),t}update(t){let r,e;for(r=0;r<this.width;r++)for(e=0;e<this.height;e++)this[r][e]=t(this[r][e],r,e,this)}updateRect(t,r,e,n,i){let o,s;for(o=t;o<t+e;o++)for(s=r;s<r+n;s++)this.hasXY(o,s)&&(this[o][s]=i(this[o][s],o,s,this))}updateCircle(t,r,e,n){let i,o;for(i=Math.max(0,t-e-1);i<Math.min(this.width,t+e+1);i++)for(o=Math.max(0,r-e-1);o<Math.min(this.height,r+e+1);o++)this.hasXY(i,o)&&(i-t)*(i-t)+(o-r)*(o-r)<e*e+e&&(this[i][o]=n(this[i][o],i,o,this))}fill(t){const r="function"==typeof t?t:()=>t;this.update(r)}fillRect(t,r,e,n,i){const o="function"==typeof i?i:()=>i;this.updateRect(t,r,e,n,o)}fillCircle(t,r,e,n){const i="function"==typeof n?n:()=>n;this.updateCircle(t,r,e,i)}replace(t,r){this.update((e=>e==t?r:e))}copy(t){this.update(((r,e,n)=>t[e][n]))}count(t){const r="function"==typeof t?t:r=>r==t;let e=0;return this.forEach(((t,n,i)=>{r(t,n,i,this)&&++e})),e}dump(t){this.dumpRect(0,0,this.width,this.height,t)}dumpRect(t,r,e,n,o){let s,h;o=o||E,t=i(t,0,this.width-2),r=i(r,0,this.height-2);const u=i(t+e,1,this.width-1),f=i(r+n,1,this.height-1);let a=[];for(h=r;h<=f;h++){let r=(h+"]").padStart(3," ");for(s=t;s<=u;s++){s%10==0&&(r+=" ");r+=o(this[s][h],s,h)[0]}a.push(r)}console.log(a.join("\n"))}dumpAround(t,r,e){this.dumpRect(t-e,r-e,2*e,2*e)}closestMatchingLoc(t,r,e){let n=[-1,-1],i=this.width+this.height;return this.forEach(((o,s,u)=>{if(e(o,s,u,this)){const e=h(t,r,s,u);e<i?(n[0]=s,n[1]=u,i=e):e==i&&m.chance(50)&&(n[0]=s,n[1]=u)}})),n}firstMatchingLoc(t){const r="function"==typeof t?t:r=>r==t;for(let t=0;t<this.width;++t)for(let e=0;e<this.height;++e)if(r(this[t][e],t,e,this))return[t,e];return[-1,-1]}randomMatchingLoc(t,r=!1){let e,n,i,o=0;const s="function"==typeof t?t:r=>r==t;if(o=0,this.forEach(((t,r,e)=>{s(t,r,e,this)&&o++})),0==o)return[-1,-1];for(i=r?Math.floor(o/2):m.range(0,o-1),e=0;e<this.width&&i>=0;e++)for(n=0;n<this.height&&i>=0;n++)if(s(this[e][n],e,n,this)){if(0==i)return[e,n];i--}return[-1,-1]}matchingLocNear(t,r,e,n=!1){let i,o,s,h,u,f=[-1,-1];const a="function"==typeof e?e:t=>t==e;for(h=0,s=0;s<Math.max(this.width,this.height)&&!h;s++)for(i=t-s;i<=t+s;i++)for(o=r-s;o<=r+s;o++)this.hasXY(i,o)&&(i==t-s||i==t+s||o==r-s||o==r+s)&&a(this[i][o],i,o,this)&&h++;if(0==h)return[-1,-1];for(u=n?1+Math.floor(h/2):1+m.number(h),s=0;s<Math.max(this.width,this.height);s++)for(i=t-s;i<=t+s;i++)for(o=r-s;o<=r+s;o++)if(this.hasXY(i,o)&&(i==t-s||i==t+s||o==r-s||o==r+s)&&a(this[i][o],i,o,this)&&0==--u)return f[0]=i,f[1]=o,f;return[-1,-1]}arcCount(t,r,e){let i,o,s,h,u,f;for(e=e||n,i=0,o=0;o<A.length;o++)s=t+A[(o+7)%8][0],h=r+A[(o+7)%8][1],u=t+A[o][0],f=r+A[o][1],(this.hasXY(u,f)&&e(this[u][f],u,f,this))!=(this.hasXY(s,h)&&e(this[s][h],s,h,this))&&i++;return Math.floor(i/2)}}const R=[];class v extends x{constructor(t,r,e=0){super(t,r,e)}static alloc(t,r,e=0){if(!t||!r)throw new Error("Grid alloc requires width and height parameters.");let n=R.pop();return n?(n.resize(t,r,e),n):new v(t,r,e)}static free(t){if(t){if(R.indexOf(t)>=0)return;R.push(t)}}resize(t,r,e=0){const n="function"==typeof e?e:()=>e;for(;this.length<t;)this.push([]);this.length=t;let i=0,o=0;for(i=0;i<t;++i){const t=this[i];for(o=0;o<r;++o)t[o]=n(i,o);t.length=r}this._width=t,this._height=r,void 0!==this.x&&(this.x=void 0,this.y=void 0)}findReplaceRange(t,r,e){this.update((n=>n>=t&&n<=r?e:n))}floodFillRange(t,r,e=0,n=0,i=0){let o,s,h,u=1;if(i>=e&&i<=n)throw new Error("Invalid grid flood fill");for(this[t][r]=i,o=0;o<4;o++)s=t+_[o][0],h=r+_[o][1],this.hasXY(s,h)&&this[s][h]>=e&&this[s][h]<=n&&(u+=this.floodFillRange(s,h,e,n,i));return u}invert(){this.update((t=>t?0:1))}closestLocWithValue(t,r,e=1){return this.closestMatchingLoc(t,r,(t=>t==e))}randomLocWithValue(t=1){return this.randomMatchingLoc((r=>r==t))}getQualifyingLocNear(t,r,e=!1){return this.matchingLocNear(t,r,(t=>!!t),e)}leastPositiveValue(){let t=Number.MAX_SAFE_INTEGER;return this.forEach((r=>{r>0&&r<t&&(t=r)})),t}randomLeastPositiveLoc(t=!1){const r=this.leastPositiveValue();return this.randomMatchingLoc((t=>t==r),t)}floodFill(t,r,e,n){let i,o,s,h=1;const u="function"==typeof e?e:t=>t==e,f="function"==typeof n?n:()=>n;for(this[t][r]=f(this[t][r],t,r,this),i=0;i<4;i++)o=t+_[i][0],s=r+_[i][1],this.hasXY(o,s)&&u(this[o][s],o,s,this)&&(h+=this.floodFill(o,s,u,f));return h}_cellularAutomataRound(t,r){let e,n,i,o,s,h,u;u=v.alloc(this.width,this.height),u.copy(this);let f=!1;for(e=0;e<this.width;e++)for(n=0;n<this.height;n++){for(i=0,h=0;h<_.length;h++)o=e+_[h][0],s=n+_[h][1],this.hasXY(o,s)&&u[o][s]&&i++;u[e][n]||"t"!=t[i]?u[e][n]&&"t"==r[i]||(this[e][n]=0,f=!0):(this[e][n]=1,f=!0)}return v.free(u),f}fillBlob(t,r,e,n,i,o,s,h){let u,f,a,c,l,d,p,g,y,w,b,M,_,A;r>=n&&(r=Math.round(.75*n),n=Math.round(1.25*n)),e>=i&&(e=Math.round(.75*i),i=Math.round(1.25*i));const E=Math.floor((this.width-n)/2),x=Math.floor((this.height-i)/2);do{for(this.fill(0),u=0;u<n;u++)for(f=0;f<i;f++)this[u+E][f+x]=m.chance(o)?1:0;for(a=0;a<t;a++)this._cellularAutomataRound(s,h)||(a=t);for(p=0,d=0,g=this.width,w=0,y=this.height,b=0,c=2,u=0;u<this.width;u++)for(f=0;f<this.height;f++)1==this[u][f]&&(l=this.floodFill(u,f,1,c),l>p&&(p=l,d=c),c++);for(u=0;u<this.width;u++){for(A=!1,f=0;f<this.height;f++)if(this[u][f]==d){A=!0;break}A&&(u<g&&(g=u),u>w&&(w=u))}for(f=0;f<this.height;f++){for(A=!1,u=0;u<this.width;u++)if(this[u][f]==d){A=!0;break}A&&(f<y&&(y=f),f>b&&(b=f))}M=w-g+1,_=b-y+1}while(M<r||_<e||0==d);for(u=0;u<this.width;u++)for(f=0;f<this.height;f++)this[u][f]==d?this[u][f]=1:this[u][f]=0;return{x:g,y:y,width:M,height:_}}}const N=v.alloc.bind(v),I=v.free.bind(v);var O={__proto__:null,makeArray:function(t,r){if(void 0===r)return new Array(t).fill(0);r=r||(()=>0);const e=new Array(t);for(let n=0;n<t;++n)e[n]=r(n);return e},Grid:x,NumGrid:v,alloc:N,free:I,make:function(t,r,e){return void 0===e?new v(t,r,0):"number"==typeof e?new v(t,r,e):new x(t,r,e)},offsetZip:function(t,r,e,n,i){const o="function"==typeof i?i:(r,e,n,o)=>t[n][o]=i||e;r.forEach(((i,s,h)=>{const u=s+e,f=h+n;t.hasXY(u,f)&&i&&o(t[u][f],i,u,f,s,h,t,r)}))},directionOfDoorSite:function(t,r,e,n){let i,o,s,h,u,f;const a="function"==typeof n?n:t=>t==n;for(o=-1,i=0;i<4;i++)if(s=r+_[i][0],h=e+_[i][1],u=r-_[i][0],f=e-_[i][1],t.hasXY(u,f)&&t.hasXY(s,h)&&a(t[u][f],u,f,t)){if(-1!=o)return-1;o=i}return o},intersection:function(t,r,e){e=e||t,t.update(((t,n,i)=>r[n][i]&&e[n][i]))},unite:function(t,r,e){e=e||t,t.update(((t,n,i)=>e[n][i]||r[n][i]))}};t.Random=p,t.cosmetic=g,t.data={},t.flag=M,t.flags=b,t.grid=O,t.random=m,t.range=w,t.utils=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-core.min.js.map
